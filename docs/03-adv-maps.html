<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brianna Heggeseth and Leslie Myint (with contributions from Erin Franke and Vivian Powell)">

<title>STAT/COMP 212 - Advanced Spatial Visualizations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STAT/COMP 212</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-syallbus" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Syallbus</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-syallbus">    
        <li>
    <a class="dropdown-item" href="./syllabus_final.html" rel="" target="">
 <span class="dropdown-text">Final Syllabus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./syllabus_prelim.html" rel="" target="">
 <span class="dropdown-text">Preliminary Syllabus</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-activities" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Activities</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-activities">    
        <li>
    <a class="dropdown-item" href="./01-introductions.html" rel="" target="">
 <span class="dropdown-text">Welcome to the course!</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02-adv-ggplot.html" rel="" target="">
 <span class="dropdown-text">Advanced Data Visualization in ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-adv-maps.html" rel="" target="">
 <span class="dropdown-text">Advanced Spatial Visualizations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./workflow_files_rstudio.html" rel="" target="">
 <span class="dropdown-text">Workflow: Files and RStudio setup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-interactive-viz.html" rel="" target="">
 <span class="dropdown-text">Interactive visualization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05-data-types-1.html" rel="" target="">
 <span class="dropdown-text">Wrangling: numerics, logicals, dates</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./06-data-types-2.html" rel="" target="">
 <span class="dropdown-text">Wrangling: strings</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./07-data-types-3.html" rel="" target="">
 <span class="dropdown-text">Wrangling: factors</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./08-functions-control-structs.html" rel="" target="">
 <span class="dropdown-text">Functions and control structures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./09-iteration.html" rel="" target="">
 <span class="dropdown-text">Loops and iteration</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10-apis.html" rel="" target="">
 <span class="dropdown-text">Data acquisition: APIs</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-homework" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Homework</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-homework">    
        <li>
    <a class="dropdown-item" href="./homework0.html" rel="" target="">
 <span class="dropdown-text">Homework 0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./homework1.html" rel="" target="">
 <span class="dropdown-text">Homework 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./homework2.html" rel="" target="">
 <span class="dropdown-text">Homework 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./homework3.html" rel="" target="">
 <span class="dropdown-text">Homework 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./homework4.html" rel="" target="">
 <span class="dropdown-text">Homework 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./reflection1.html" rel="" target="">
 <span class="dropdown-text">Reflection 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./homework5.html" rel="" target="">
 <span class="dropdown-text">Homework 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./project.html" rel="" target="">
 <span class="menu-text">Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./tech_setup.html" rel="" target="">
 <span class="menu-text">Tech Setup</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">Learning goals</a></li>
  <li><a href="#spatial-visualization-review" id="toc-spatial-visualization-review" class="nav-link" data-scroll-target="#spatial-visualization-review">Spatial Visualization Review</a></li>
  <li><a href="#whats-next" id="toc-whats-next" class="nav-link" data-scroll-target="#whats-next">What’s next?</a></li>
  <li><a href="#coordinate-reference-system" id="toc-coordinate-reference-system" class="nav-link" data-scroll-target="#coordinate-reference-system">Coordinate Reference System</a>
  <ul class="collapse">
  <li><a href="#ellipsoid" id="toc-ellipsoid" class="nav-link" data-scroll-target="#ellipsoid">Ellipsoid</a></li>
  <li><a href="#datum" id="toc-datum" class="nav-link" data-scroll-target="#datum">Datum</a>
  <ul class="collapse">
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise 1</a></li>
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise 2</a></li>
  </ul></li>
  <li><a href="#projection" id="toc-projection" class="nav-link" data-scroll-target="#projection">Projection</a>
  <ul class="collapse">
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise 3</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#spatial-data" id="toc-spatial-data" class="nav-link" data-scroll-target="#spatial-data">Spatial Data</a>
  <ul class="collapse">
  <li><a href="#data-models" id="toc-data-models" class="nav-link" data-scroll-target="#data-models">Data Models</a>
  <ul class="collapse">
  <li><a href="#vector" id="toc-vector" class="nav-link" data-scroll-target="#vector">Vector</a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4">Exercise 4</a></li>
  <li><a href="#raster" id="toc-raster" class="nav-link" data-scroll-target="#raster">Raster</a></li>
  </ul></li>
  <li><a href="#working-with-spatial-data-in-r" id="toc-working-with-spatial-data-in-r" class="nav-link" data-scroll-target="#working-with-spatial-data-in-r">Working with Spatial Data in R</a>
  <ul class="collapse">
  <li><a href="#read-data-into-r" id="toc-read-data-into-r" class="nav-link" data-scroll-target="#read-data-into-r">Read data into R</a></li>
  <li><a href="#data-classes-in-r" id="toc-data-classes-in-r" class="nav-link" data-scroll-target="#data-classes-in-r">Data classes in R</a></li>
  <li><a href="#exercise-5" id="toc-exercise-5" class="nav-link" data-scroll-target="#exercise-5">Exercise 5</a></li>
  <li><a href="#exercise-6" id="toc-exercise-6" class="nav-link" data-scroll-target="#exercise-6">Exercise 6</a></li>
  <li><a href="#exercise-7" id="toc-exercise-7" class="nav-link" data-scroll-target="#exercise-7">Exercise 7</a></li>
  <li><a href="#converting-between-data-classes" id="toc-converting-between-data-classes" class="nav-link" data-scroll-target="#converting-between-data-classes">Converting between data classes</a></li>
  <li><a href="#exercise-8" id="toc-exercise-8" class="nav-link" data-scroll-target="#exercise-8">Exercise 8</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#spatial-maps" id="toc-spatial-maps" class="nav-link" data-scroll-target="#spatial-maps">Spatial Maps</a>
  <ul class="collapse">
  <li><a href="#hexbin-choropleth" id="toc-hexbin-choropleth" class="nav-link" data-scroll-target="#hexbin-choropleth">Hexbin Choropleth</a>
  <ul class="collapse">
  <li><a href="#exercise-9" id="toc-exercise-9" class="nav-link" data-scroll-target="#exercise-9">Exercise 9</a></li>
  <li><a href="#exercise-10" id="toc-exercise-10" class="nav-link" data-scroll-target="#exercise-10">Exercise 10</a></li>
  <li><a href="#bonus-challenge" id="toc-bonus-challenge" class="nav-link" data-scroll-target="#bonus-challenge">Bonus Challenge</a></li>
  </ul></li>
  <li><a href="#mn-citycounty-example" id="toc-mn-citycounty-example" class="nav-link" data-scroll-target="#mn-citycounty-example">MN City/County example</a>
  <ul class="collapse">
  <li><a href="#unifying-crss-across-different-spatial-datasets" id="toc-unifying-crss-across-different-spatial-datasets" class="nav-link" data-scroll-target="#unifying-crss-across-different-spatial-datasets">Unifying CRSs across different spatial datasets</a></li>
  <li><a href="#initial-map-counties-and-cities" id="toc-initial-map-counties-and-cities" class="nav-link" data-scroll-target="#initial-map-counties-and-cities">Initial map: counties and cities</a></li>
  <li><a href="#updated-map-counties-and-cities-plus-elevation" id="toc-updated-map-counties-and-cities-plus-elevation" class="nav-link" data-scroll-target="#updated-map-counties-and-cities-plus-elevation">Updated map: counties and cities plus elevation</a></li>
  <li><a href="#updated-map-zoom-in-to-twin-cities" id="toc-updated-map-zoom-in-to-twin-cities" class="nav-link" data-scroll-target="#updated-map-zoom-in-to-twin-cities">Updated map: zoom in to Twin Cities</a></li>
  <li><a href="#twin-cities-leaflet" id="toc-twin-cities-leaflet" class="nav-link" data-scroll-target="#twin-cities-leaflet">Twin Cities Leaflet</a></li>
  </ul></li>
  <li><a href="#open-ended-exercise-homework" id="toc-open-ended-exercise-homework" class="nav-link" data-scroll-target="#open-ended-exercise-homework">Open-ended Exercise (Homework)</a>
  <ul class="collapse">
  <li><a href="#exercise-joining-and-aggregation" id="toc-exercise-joining-and-aggregation" class="nav-link" data-scroll-target="#exercise-joining-and-aggregation">Exercise: Joining and aggregation</a></li>
  <li><a href="#exercise-adding-layers" id="toc-exercise-adding-layers" class="nav-link" data-scroll-target="#exercise-adding-layers">Exercise: Adding layers</a></li>
  </ul></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Advanced Spatial Visualizations</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brianna Heggeseth and Leslie Myint (with contributions from Erin Franke and Vivian Powell) </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="learning-goals" class="level1">
<h1>Learning goals</h1>
<p>After this lesson, you should be able to:</p>
<ul>
<li>Understand the basics of a CRS (coordinate reference system)</li>
<li>Understand and recognize different spatial file types and data types in R</li>
<li>Implement some of the basic plotting with the <code>sf</code> package</li>
<li>Understand foundational ideas in working with spatial data (aggregating spatial point data to a spatial region, joining spatial data sets)</li>
</ul>
<p><br></p>
<p>Slides for today are available <a href="./slides/03-adv-maps.html">here</a>. (For our main activity, we will be using the rest of the webpage below.)</p>
<p><br></p>
<p>You can download a template Quarto file to start from <a href="activity_templates/03-adv-maps.qmd">here</a>. Put this file in an <code>activities</code> folder within a folder for this course.</p>
<p><br><br><br></p>
</section>
<section id="spatial-visualization-review" class="level1">
<h1>Spatial Visualization Review</h1>
<p>In STAT/COMP 112, you learned about basic spatial visualizations. To review,</p>
<ul>
<li><strong>Background Maps in ggplot</strong>. The <code>ggmap</code> package includes tools to create a plot with a map background. In particular, <code>get_stamenmap()</code> accesses map image tiles from Stamen Maps (<a href="http://maps.stamen.com/" class="uri">http://maps.stamen.com/</a>) based on a provided bounding box (bbox) and <code>ggmap()</code> can be used instead of <code>ggplot()</code> to use a background map image as the plotting frame.
<ul>
<li><a href="http://Openstreetmap.org" class="uri">http://Openstreetmap.org</a> is an excellent tool to find longitude/latitude values for a desired bbox.</li>
<li><em>Technical note: The bounding box of the ggmap object has a CRS of WGS84 (EPSG:4326), but the actual raster is in EPSG:3857. We’ll talk about CRS in this activity</em></li>
</ul></li>
<li><strong>Contour Plots</strong>. The <code>geom_density_2d()</code> function in <code>ggplot2</code> package displays contours of intensity of points in a spatial area.</li>
<li><strong>Choropleth</strong>. The <code>geom_map(data, map, aes(map_id))</code> function in <code>ggplot2</code> package displays choropleth maps (filled polygons/regions) based on a data frame of coordinates (long/x,lat/y,region/id) and an attribute data frame with properties for each region or id.</li>
<li><strong>Leaflet</strong>. The <code>leaflet</code> package in R provides access to the Leaflet javascript library (<a href="https://leafletjs.com/" class="uri">https://leafletjs.com/</a>) to create interactive maps. A basic map can be created with a data frame of coordinates and attributes (more advanced topics can be found at <a href="https://rstudio.github.io/leaflet/" class="uri">https://rstudio.github.io/leaflet/</a>):</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addMarkers</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br><br><br></p>
</section>
<section id="whats-next" class="level1">
<h1>What’s next?</h1>
<p>We used based mapping tools without thinking too much about the details of the maps. In order to create more advanced spatial visualizations, we need a foundation in spatial coordinate reference systems and how spatial data is often recorded and stored!</p>
<p><br><br><br></p>
</section>
<section id="coordinate-reference-system" class="level1">
<h1>Coordinate Reference System</h1>
<p>At the heart of every spatial visualization is a set of locations. One way to describe a location is in terms of coordinates and a coordinate reference system (CRS).</p>
<p>There are three main components to a CRS: ellipsoid, datum, and a projection. (The projection is a part of <em>projected</em> CRSs.)</p>
<section id="ellipsoid" class="level2">
<h2 class="anchored" data-anchor-id="ellipsoid">Ellipsoid</h2>
<p>While you might have learned that the Earth is a sphere, it is actually closer to an ellipsoid with a bulge at the equator. Additionally, the surface is irregular and not smooth. To define a CRS, we first need to choose a mathematical model represent a smooth approximation to the shape of the Earth. The common ellipsoid models are known as WGS84 and GRS80. See the illustration below of one ellipsoid model (shown in black) as compared to Earth’s true irregular surface (shown in red).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.icsm.gov.au/sites/default/files/inline-images/geocentric_0.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Illustration of ellipsoid model and Earth’s irregular surface, centered to have an overall best fit. Source: www.icsm.gov.au</figcaption>
</figure>
</div>
</section>
<section id="datum" class="level2">
<h2 class="anchored" data-anchor-id="datum">Datum</h2>
<p>Each ellipsoid model has different ways to position it self relative to Earth depending on the center or origin. Each potential position and reference frame for representing the position of locations on Earth is called a <strong>datum</strong>.</p>
<p>For example, two different datum for the same ellipsoid model can provide a more accurate fit or approximation of the Earth’s surface depending on the region of interest (South America v. North America). For example, the NAD83 datum is a good fit for the GRS80 ellipsoid in North America, but SIRGAS2000 is a better fit for the GRS80 ellipsoid in South America. The illustration below shows one datum in which the center of the ellipsoid does not coincide with the center of Earth’s mass. With this position of the ellipsoid, we gain a better fit for the southern half of the Earth.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.icsm.gov.au/sites/default/files/inline-images/regional_0.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Illustration of ellipsoid model and Earth’s irregular surface for a datum that better fits southern part (bottom right) of the Earth. Source: www.icsm.gov.au</figcaption>
</figure>
</div>
<p>It is useful to know that the Global Positioning System (GPS) uses the WGS84 ellipsoid model and a datum by the same name, which provides an overall best fit of the Earth.</p>
<p>If you have longitude and latitude coordinates for a location, it is important to know what datum and ellipsoid were used to define those positions.</p>
<p><em>Note: In practice, the horizontal distance between WGS84 and NAD83 coordinates is about 3-4 feet in the US, which may not be significant for most applications.</em></p>
<section id="exercise-1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1">Exercise 1</h3>
<p>Go to <a href="https://epsg.io/" class="uri">https://epsg.io/</a>. Search for a location important to you (state, country, etc.). Filter based on Datum (Geodetic) on the right. Click on one geodetic datum option for your region of interest. Make sure your location is listed under the “Area of use” attribute.</p>
<p>Provide the region of interest (e.g.&nbsp;United States), the full datum name (e.g.&nbsp;North American Datum 1983), the shorthand name (e.g.&nbsp;NAD83, EPSG: 6269), and the ellipsoid (e.g.&nbsp;GRS 1980).</p>
<blockquote class="blockquote">
<p>Location:</p>
</blockquote>
<details>
<summary>
Example Solution
</summary>
<blockquote class="blockquote">
<p>Location 1: South Africa, Cape, EPSG:6222, Ellipsoid: Clarke 1880 (Arc)</p>
</blockquote>
<blockquote class="blockquote">
<p>Location 2: Thailand, Indian 1975, EPSG:6240, Ellipsoid: Everest 1830 (1937 Adjustment)</p>
</blockquote>
<blockquote class="blockquote">
<p>Location 3: Colombia, Marco Geocentrico Nacional de Referencia, EPSG:6686, Ellipsoid: GRS 1980</p>
</blockquote>
</details>
</section>
<section id="exercise-2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2">Exercise 2</h3>
<p>Let’s now practice specifying coordinates in a CRS.</p>
<p>For <em>geographic coordinate reference systems</em>, the coordinates of locations are specified by latitude (degrees, minutes, and seconds north or south of the equator), longitude (degrees, minutes, and seconds west or east of a prime meridian), and sometimes height.</p>
<p>Use the “Get position on a map” feature of <a href="https://epsg.io/" class="uri">https://epsg.io/</a> to locate the Olin-Rice Science Center at Macalester. The two boxes at the top allow you to specify a longitude (left box) and latitude (right box) in degrees. Enter the following to focus OLRI:</p>
<blockquote class="blockquote">
<p>Longitude: -93.168855</p>
<p>Latitude: 44.936611</p>
</blockquote>
<p>For <em>projected coordinate reference systems</em>, the coordinates of locations are typically specified by easting (x) and northing (y).</p>
<p>Click the “Transform” button at the top to find the location of OLRI in northing and easting coordinates (in meters) for the CRS EPSG:26993.</p>
<blockquote class="blockquote">
<p>Easting:</p>
<p>Northing:</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<blockquote class="blockquote">
<p>Easting: 865601.0163401571</p>
<p>Northing: 315516.10931633075</p>
</blockquote>
</details>
</section>
</section>
<section id="projection" class="level2">
<h2 class="anchored" data-anchor-id="projection">Projection</h2>
<p>Lastly, the Earth lives in a 3 dimensional (3D) world and most visualizations are on a 2 dimensional (2D) surface. We must choose a projection method to represent points, regions, and lines on Earth on a 2D map with distance units (typically meter, international foot, US survey foot). In that projection process, a 3D element will lose angle, area, and/or distance when projected onto a 2D surface, no matter which method is chosen.</p>
<p>For a good overview of common projection methods, see <a href="https://pubs.usgs.gov/gip/70047422/report.pdf" class="uri">https://pubs.usgs.gov/gip/70047422/report.pdf</a>.</p>
<p>One of the most commonly used projection is the Mercator projection which is a cylindrical map projection from the 1500’s. It became popular for navigation because it represented north as up and south as down everywhere and preserves local directions and shape. However, it inflates the size of regions far from the equator. Thus, Greenland, Antarctica, Canada, and Russia appear large relative to their actual land mass as compared to Central Africa. See the illustration below to compare the area/shape of the countries with the Mercator projection of the world (light blue) with the true areas/shapes (dark blue).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mercator.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><a href="https://www.reddit.com/r/dataisbeautiful/comments/9nkg7k/map_projections_can_be_deceptive_oc/">Source</a>: <span class="citation" data-cites="neilrkaye">@neilrkaye</span></figcaption>
</figure>
</div>
<p>Below you can see four different world projections. Take note of what is lost in terms of angle, area, or distance in these projections.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic Map w/ labels</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>, <span class="at">title =</span> <span class="st">"World Map - Mercator Projection"</span>, <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"("</span>, <span class="fu">length</span>(<span class="fu">unique</span>(world<span class="sc">$</span>name)), <span class="st">" countries)"</span>)) <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs"</span>) <span class="sc">+</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Lambert Azimuthal Equal-Area Projection"</span>, <span class="at">subtitle =</span> <span class="st">"Correctly represents area but not angles"</span>) <span class="sc">+</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=fouc"</span>) <span class="sc">+</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Foucaut Projection"</span>, <span class="at">subtitle =</span> <span class="st">"Correctly represents area, lots of shape distortion in high latitudes"</span>) <span class="sc">+</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-2-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=natearth2"</span>) <span class="sc">+</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Natural Earth II Projection"</span>, <span class="at">subtitle =</span> <span class="st">"Represents globe shape, distorted at high latitudes"</span>) <span class="sc">+</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-2-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="exercise-3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3">Exercise 3</h3>
<p>Create a world map with a different projection (beyond the four above). Go to <a href="https://proj.org/en/9.2/operations/projections/index.html" class="uri">https://proj.org/en/9.2/operations/projections/index.html</a> and find another projection. Look for the <code>proj-string</code> and copy that to the <code>crs =</code> argument in <code>coord_sf()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"??"</span>) <span class="sc">+</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"?? Projection"</span>, <span class="at">subtitle =</span> <span class="st">"??"</span>) <span class="sc">+</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What is interesting, surprising, or different to you about the map of the Earth based on this projection?</p>
<blockquote class="blockquote">
<p>ANSWER:</p>
</blockquote>
<p>Talk with a neighbor about the projection they tried. What projection did they use and how is it different from the one you chose?</p>
<blockquote class="blockquote">
<p>ANSWER:</p>
</blockquote>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop to Reflect
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>If coordinate reference systems are new to you, how do you feel about all of this new information? What are the most important points to take away? What are the documents and sites you can refer back to when you need more details?</p>
<p>When you learn about a new area of study, it can feel overwhelming. Pick out the 3-5 priority ideas to help you organize all of the details.</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="spatial-data" class="level1">
<h1>Spatial Data</h1>
<p>With a CRS (including a projection method) to collect and record location data in terms of longitude or easting (x) and latitude or northing (y) coordinates, we can now consider common models for storing spatial data on the computer. There are two main data models: vector and raster.</p>
<section id="data-models" class="level2">
<h2 class="anchored" data-anchor-id="data-models">Data Models</h2>
<section id="vector" class="level3">
<h3 class="anchored" data-anchor-id="vector">Vector</h3>
<p>Vector data represents the world as a set of spatial geometries that are defined in terms of location coordinates (with a specified CRS) with non-spatial attributes or properties.</p>
<p>The three basic vector geometries are</p>
<ul>
<li>Points: Locations defined based on a (x, y) coordinates.</li>
<li>Lines: A set of ordered points connected by straight lines.</li>
<li>Polygons: A set of ordered points connected by straight lines, first and last point are the same.</li>
</ul>
<p>For example, city locations can be represented with points, roads and rivers can be represented by lines, and geo-political boundaries and lakes can be represented by polygons.</p>
<p>Hundreds of file formats exist to store spatial vector data. A text file (such as .csv) can store the coordinates in two columns (x,y) in addition to a group id (needed for lines and polygons) plus attributes or properties in additional columns. Note that text files do not store the CRS. However, shapefiles (.shp) developed by ESRI is one of the most widely supported spatial vector file format (that includes the CRS). Additionally, GeoJSON (.geojson) and KML (.kml) are additional popular formats.</p>
</section>
<section id="exercise-4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4">Exercise 4</h3>
<p>To create maps, we’ll need to have access to some spatial data.</p>
<p>Go to the following websites and download the vector data files indicated. Put all of the downloaded files/folders in same folder as this Rmd file.</p>
<ul>
<li>URL: <a href="https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map" class="uri">https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map</a>
<ul>
<li>Download File Type: GeoJSON</li>
<li>Name of File: <code>us_states_hexgrid.geojson</code></li>
</ul></li>
<li>URL: <a href="https://www2.census.gov/programs-surveys/decennial/2020/data/apportionment/apportionment.csv" class="uri">https://www2.census.gov/programs-surveys/decennial/2020/data/apportionment/apportionment.csv</a>
<ul>
<li>Download File Type: csv</li>
<li>Name of File: <code>apportionment.csv</code></li>
</ul></li>
<li>URL: <a href="https://gisdata.mn.gov/dataset/loc-pop-centers" class="uri">https://gisdata.mn.gov/dataset/loc-pop-centers</a>
<ul>
<li>Download File Type: shapefile (.shp)</li>
<li>Name of File: <code>shp_loc_pop_centers.zip</code> (unzip this file to get a folder with the name <code>shp_loc_pop_centers</code>)</li>
</ul></li>
<li>URL: <a href="https://gisdata.mn.gov/dataset/us-mn-state-metc-water-lakes-rivers" class="uri">https://gisdata.mn.gov/dataset/us-mn-state-metc-water-lakes-rivers</a>
<ul>
<li>Download File Type: shapefile (.shp)</li>
<li>Name of File: <code>shp_water_lakes_rivers.zip</code> (unzip this file to get a folder with the name <code>shp_water_lakes_rivers</code>)</li>
</ul></li>
</ul>
</section>
<section id="raster" class="level3">
<h3 class="anchored" data-anchor-id="raster">Raster</h3>
<p>Raster data represents the world using a continuous grid of cells where each cell has a single value. These values could be continuous (e.g., elevation, precipitation) or categorical (e.g., land cover type, soil type).</p>
<p>Typically regular cells are square in shape but they can be rotated and sheared. Rectilinear and curvilinear shapes are also possible, depending on the spatial region of interest and CRS.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://i.stack.imgur.com/r2wim.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Difference between vector and raster formats. Source: gis.stackexchange.com</figcaption>
</figure>
</div>
<p><em>Be aware that high resolution raster data involves a large number of small cells. This can slow down the computations and visualizations.</em></p>
<p>Many raster file formats exist. One of the most popular is GeoTIFF (.tif or .tiff). More complex raster formats include NetCDF (.nc) and HDF (.hdf). To work with raster data in R, you’ll use the <code>raster</code>, <code>terra</code>, and the <code>stars</code> packages. If you are interested in learning more, check out <a href="https://r-spatial.github.io/stars/" class="uri">https://r-spatial.github.io/stars/</a>.</p>
</section>
</section>
<section id="working-with-spatial-data-in-r" class="level2">
<h2 class="anchored" data-anchor-id="working-with-spatial-data-in-r">Working with Spatial Data in R</h2>
<section id="read-data-into-r" class="level3">
<h3 class="anchored" data-anchor-id="read-data-into-r">Read data into R</h3>
<p>For each file format, we need to use a different function to read in the data. See the examples below for reading in GeoJSON, CSV, and shapefiles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in GeoJSON file</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>hex_spatial <span class="ot">&lt;-</span> geojsonio<span class="sc">::</span><span class="fu">geojson_read</span>(<span class="st">"data/us_states_hexgrid.geojson"</span>, <span class="at">what =</span> <span class="st">"sp"</span>) </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in CSV File</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>pop_growth <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/apportionment.csv"</span>) <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Shapefiles</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>mn_cities <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"data/shp_loc_pop_centers"</span>) <span class="co">#shp file/folder</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>mn_water <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"data/shp_water_lakes_rivers"</span>) <span class="co">#shp file/folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-classes-in-r" class="level3">
<h3 class="anchored" data-anchor-id="data-classes-in-r">Data classes in R</h3>
<p>When data is read in, an R data object is created of a default class. Notice the classes of the R objects we read in. Also, notice that an object may have multiple classes, which indicate the type of structure it has and how functions may interact with the object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(hex_spatial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SpatialPolygonsDataFrame"
attr(,"package")
[1] "sp"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pop_growth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mn_cities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mn_water)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p><strong>Older R Spatial classes</strong></p>
<p>In the <code>sp</code> package, there are many spatial classes that hold slightly different data. All <code>Spatial*</code> classes have a bounding box (bbox) and a CRS.</p>
<ul>
<li><code>SpatialPoints</code>, <code>SpatialLines</code>, and <code>SpatialPolygons</code> provide structure to hold the basic spatial geometries of points, lines, and polygons.</li>
<li><code>Spatial*DataFrame</code> extends the geometry classes to a data.frame-like object with non-spatial attribute data.</li>
</ul>
</section>
<section id="exercise-5" class="level3">
<h3 class="anchored" data-anchor-id="exercise-5">Exercise 5</h3>
<p>We can look at the first bit of the <code>hex_spatial</code> object to get a sense for how information in the object is organized:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class "SpatialPolygonsDataFrame"
Slot "data":
  cartodb_id          created_at          updated_at label bees iso3166_2
1       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
            google_name
1 Maine (United States)

Slot "polygons":
[[1]]
An object of class "Polygons"
Slot "Polygons":
[[1]]
An object of class "Polygon"
Slot "labpt":
[1] -72.62574  53.45575

Slot "area":
[1] 15.28454

Slot "hole":
[1] FALSE

Slot "ringDir":
[1] 1

Slot "coords":
          [,1]     [,2]
[1,] -72.62574 55.31320
[2,] -69.90286 54.40843
[3,] -69.90286 52.53744
[4,] -72.62574 51.57081
[5,] -75.34861 52.53744
[6,] -75.34861 54.40843
[7,] -72.62574 55.31320



Slot "plotOrder":
[1] 1

Slot "labpt":
[1] -72.62574  53.45575

Slot "ID":
[1] "1"

Slot "area":
[1] 15.28454



Slot "plotOrder":
[1] 1

Slot "bbox":
        min       max
x -75.34861 -69.90286
y  51.57081  55.31320

Slot "proj4string":
Coordinate Reference System:
Deprecated Proj.4 representation: +proj=longlat +datum=WGS84 +no_defs 
WKT2 2019 representation:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]] </code></pre>
</div>
</div>
<p>Based on this information, fill in the following:</p>
<ul>
<li>CRS:</li>
<li>BBOX (extent):</li>
<li>Geometry type:</li>
</ul>
<details>
<summary>
Solution
</summary>
<ul>
<li>CRS: EPSG:4326 (+proj=longlat +datum=WGS84 +no_defs) (From <code>Slot "proj4string": Coordinate Reference System:</code>)</li>
<li>BBOX: x -75.34861 -69.90; y 51.57 55.31 (From <code>Slot "bbox"</code>)</li>
<li>Geometry type: Polygons (Inferred from <code>An object of class "SpatialPolygonsDataFrame"</code> and <code>class "Polygon"</code>)</li>
</ul>
</details>
<p><strong>Newer R Spatial classes</strong></p>
<p>The community is moving away from using older <code>sp</code> classes to <code>sf</code> classes. It is useful for you to know that the older versions exist, but we will stick with the <code>sf</code> classes.</p>
<ul>
<li><code>sfc</code> objects are modern, general versions of the spatial geometries from the <code>sp</code> package with a bbox, CRS, and many geometries available.</li>
<li><code>sf</code> objects are <code>data.frame</code>-like objects with a geometry column of class <code>sfc</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mn_cities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1081 features and 8 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 190832.6 ymin: 4816672 xmax: 747463.4 ymax: 5468045
Projected CRS: NAD83 / UTM zone 15N
# A tibble: 1,081 × 9
      GNIS Name        CTU_Type County      FIPS_Code Sym_Class Population Notes
     &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;
 1 2393879 Ada         City     Norman Cou… 27107001… County S…       1681 &lt;NA&gt; 
 2 2393881 Adams       City     Mower Coun… 27099001… Small Ci…        742 &lt;NA&gt; 
 3 2393884 Adrian      City     Nobles Cou… 27105002… Small Ci…       1278 &lt;NA&gt; 
 4 2393887 Afton       City     Washington… 27163003… Small Ci…       2932 &lt;NA&gt; 
 5 2393894 Aitkin      City     Aitkin Cou… 27001004… County S…       2279 &lt;NA&gt; 
 6 2393895 Akeley      City     Hubbard Co… 27057004… Small Ci…        397 &lt;NA&gt; 
 7 2393898 Albany      City     Stearns Co… 27145006… Small Ci…       2618 &lt;NA&gt; 
 8 2393902 Albert Lea  City     Freeborn C… 27047006… County S…      17843 &lt;NA&gt; 
 9 2393903 Alberta     City     Stevens Co… 27149006… Small Ci…        122 &lt;NA&gt; 
10 2393904 Albertville City     Wright Cou… 27171007… Small Ci…       7226 &lt;NA&gt; 
# ℹ 1,071 more rows
# ℹ 1 more variable: geometry &lt;POINT [m]&gt;</code></pre>
</div>
</div>
</section>
<section id="exercise-6" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6">Exercise 6</h3>
<p>Based on the summary of <code>mn_cities</code>, what are the following:</p>
<ul>
<li>CRS:</li>
<li>BBOX:</li>
<li>Geometry type:</li>
</ul>
<details>
<summary>
Solution
</summary>
<ul>
<li>CRS: NAD83 / UTM zone 15N</li>
<li>BBOX: xmin: 190832.6 ymin: 4816672 xmax: 747463.4 ymax: 5468045</li>
<li>Geometry type: Points</li>
</ul>
</details>
<p><strong>Putting spatial data into a <code>data.frame</code> with <code>fortify()</code></strong></p>
<p>The <code>data.frame</code> and <code>tbl</code> (tibble) classes are standard data formats that are not specific to spatial data but are really nice for working with because of <code>tidyverse</code>. Our <code>pop_growth</code> data doesn’t include any coordinate information, so it can be stored simply as a <code>data.frame</code> (<code>tbl</code>, <code>tbl_df</code>, and <code>spec_tbl_df</code> are all subclasses of <code>data.frame</code>).</p>
<p>You may come across <code>data.frames</code> that contain spatial coordinate information, so let’s see what that might look like. We can <code>fortify()</code> our <code>sp</code> object (<code>hex_spatial</code>) to make it a data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Spatial*DataFrame to Data Frame</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_df <span class="ot">&lt;-</span> <span class="fu">fortify</span>(hex_spatial)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(hex_spatial_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
</section>
<section id="exercise-7" class="level3">
<h3 class="anchored" data-anchor-id="exercise-7">Exercise 7</h3>
<p>Whenever we come across a new function (<code>fortify</code>), it is helpful to explore the structure of information contained within the object that it creates.</p>
<p>What are the variables in <code>hex_spatial_df</code>? Compare the first seven rows with the first spatial polygon of <code>hex_spatial</code>. Using this comparison describe the meaning of the variables in <code>hex_spatial_df</code>. (<code>piece</code>, <code>id</code>, and <code>group</code> are trickier. We’ll talk about this together.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first 7 rows of hex_spatial_df</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial_df,<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       long      lat order  hole piece id group
1 -72.62574 55.31320     1 FALSE     1  1   1.1
2 -69.90286 54.40843     2 FALSE     1  1   1.1
3 -69.90286 52.53744     3 FALSE     1  1   1.1
4 -72.62574 51.57081     4 FALSE     1  1   1.1
5 -75.34861 52.53744     5 FALSE     1  1   1.1
6 -75.34861 54.40843     6 FALSE     1  1   1.1
7 -72.62574 55.31320     7 FALSE     1  1   1.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the first polygon in the hex_spatial object (Maine)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>hex_spatial<span class="sc">@</span>polygons[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class "Polygons"
Slot "Polygons":
[[1]]
An object of class "Polygon"
Slot "labpt":
[1] -72.62574  53.45575

Slot "area":
[1] 15.28454

Slot "hole":
[1] FALSE

Slot "ringDir":
[1] 1

Slot "coords":
          [,1]     [,2]
[1,] -72.62574 55.31320
[2,] -69.90286 54.40843
[3,] -69.90286 52.53744
[4,] -72.62574 51.57081
[5,] -75.34861 52.53744
[6,] -75.34861 54.40843
[7,] -72.62574 55.31320



Slot "plotOrder":
[1] 1

Slot "labpt":
[1] -72.62574  53.45575

Slot "ID":
[1] "1"

Slot "area":
[1] 15.28454</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>ANSWER:</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<blockquote class="blockquote">
<p>Variables: long, lat, order, hole, piece, id, group</p>
</blockquote>
<blockquote class="blockquote">
<p><code>long</code> and <code>lat</code> provide the x and y coordinates of the polygon for a particlar region or area <code>id</code>.</p>
</blockquote>
<blockquote class="blockquote">
<p>The <code>order</code> is the order in which you connect the coordinate points to make a polygon.</p>
</blockquote>
<blockquote class="blockquote">
<p><code>hole</code> indicates whether or not it should be included or excluded in the region as a hole.</p>
</blockquote>
<blockquote class="blockquote">
<p><code>piece</code> indicates the number of the polygon for an individual area</p>
</blockquote>
<blockquote class="blockquote">
<p><code>id</code> is a unique identifier for each polygon and allows linking to the original spatial object (<code>hex_spatial</code>). (There is a <code>Slot "ID"</code> part of the object.)</p>
</blockquote>
<blockquote class="blockquote">
<p><code>group</code> indicates which pieces belong to the same group or should be plotted together as a single entity. This can be useful when you want to apply different aesthetics (e.g., colors, linetypes) to different groups of polygons within your spatial object. It helps in specifying how to group and style the different pieces when creating plots.</p>
</blockquote>
</details>
</section>
<section id="converting-between-data-classes" class="level3">
<h3 class="anchored" data-anchor-id="converting-between-data-classes">Converting between data classes</h3>
<p>Sometimes functions for working with spatial data will only work on an object that is of a particular class (e.g., only works on <code>sf</code> objects). If we have an object of a different class, we need to know how to convert it to the right class.</p>
<p>We can convert objects between these data classes with the following functions:</p>
<ul>
<li><code>fortify(x)</code>: <code>sp</code> object x to <code>data.frame</code></li>
<li><code>st_as_sf(x)</code>: <code>sp</code> object x to <code>sf</code></li>
<li><code>st_as_sf(x, coords = c("long", "lat"))</code>: <code>data.frame</code> x to <code>sf</code> as points</li>
<li>To convert a <code>data.frame</code> with columns of <code>long</code>, <code>lat</code>, and <code>group</code> containing polygon geometry information, you can use:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_as_sf</span>(x, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_combine</span>(geometry)) <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(Note: We won’t often want to convert our data to a <code>Spatial*</code> class from <code>sp</code> package, so we’ll exclude that in this activity.)</p>
</section>
<section id="exercise-8" class="level3">
<h3 class="anchored" data-anchor-id="exercise-8">Exercise 8</h3>
<p>Convert the <code>hex_spatial</code> data to an <code>sf</code> object called <code>hex_spatial_sf</code>. Complete these two ways</p>
<ol type="1">
<li><code>hex_spatial</code> directly to <code>hex_spatial_sf</code> AND</li>
<li><code>hex_spatial_df</code> to <code>hex_spatial_sf</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to SF from hex_spatial_df  </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial_df <span class="sc">%&gt;%</span> ???  </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to SF from hex_spatial</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial <span class="sc">%&gt;%</span> ???</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to SF from hex_spatial_df  </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial_df <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_combine</span>(geometry)) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to SF from hex_spatial</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial <span class="sc">%&gt;%</span> <span class="fu">st_as_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop to Reflect
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>We’ve now talked about CRSs and how spatial data is stored in R. Thinking on the lesson so far as a whole…</p>
<ul>
<li>What’s making sense? What’s not?</li>
<li>What would help connect everything we’ve talked about?</li>
</ul>
<p>Record observations in your Process and Reflection Log.</p>
<p>Share your observations with your partner. Together try to figure out what <strong>themes</strong> emerge in what you’re still working on. Then try to come up with strategies that can help you move forward.</p>
<p>Example themes: What is the “why” behind this? What is the full picture/pipeline/how this is used in practice?</p>
<p>Example strategies: writing condensed summaries, drawing concept maps</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="spatial-maps" class="level1">
<h1>Spatial Maps</h1>
<section id="hexbin-choropleth" class="level2">
<h2 class="anchored" data-anchor-id="hexbin-choropleth">Hexbin Choropleth</h2>
<p>Data Source: <a href="https://r-graph-gallery.com/328-hexbin-map-of-the-usa.html" class="uri">https://r-graph-gallery.com/328-hexbin-map-of-the-usa.html</a></p>
<p>In this example, we’ll create an alternative choropleth map. Instead of using the actual geo-political boundaries, we will use hexagons to represent the U.S. states and maintain their relative directional position to each together. This approach results in each state having the same area in the graphic so that large regions don’t dominate the visual story.</p>
<section id="exercise-9" class="level3">
<h3 class="anchored" data-anchor-id="exercise-9">Exercise 9</h3>
<p>Describe what the following code chunks are doing. Be sure to consider the class of the data object, what the data object looks like to start, and what it looks like at the end of the chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk A</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_df  <span class="ot">&lt;-</span> hex_spatial_df <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hex_spatial)) , </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="fu">str_replace</span>(hex_spatial<span class="sc">$</span>google_name,<span class="st">' </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)'</span>,<span class="st">''</span>), </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">abbr =</span> hex_spatial<span class="sc">$</span>iso3166_2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk A):</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk A</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial_df) <span class="co"># Start with data frame of 357 rows and 7 columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       long      lat order  hole piece id group
1 -72.62574 55.31320     1 FALSE     1  1   1.1
2 -69.90286 54.40843     2 FALSE     1  1   1.1
3 -69.90286 52.53744     3 FALSE     1  1   1.1
4 -72.62574 51.57081     4 FALSE     1  1   1.1
5 -75.34861 52.53744     5 FALSE     1  1   1.1
6 -75.34861 54.40843     6 FALSE     1  1   1.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>hex_spatial_df  <span class="ot">&lt;-</span> hex_spatial_df <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>( <span class="co"># Left join, a mutating join, a dataset with information from hex_spatial</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hex_spatial)) , <span class="co"># Create a data frame with variables id (1,2,3...), name (defined as the google_name from hex_spatial after removing "(United States)"), and abbr (the state abbreviation in hex_spatial as variable iso3166_2)</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="fu">str_replace</span>(hex_spatial<span class="sc">$</span>google_name,<span class="st">' </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)'</span>,<span class="st">''</span>), </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">abbr =</span> hex_spatial<span class="sc">$</span>iso3166_2))</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial_df) <span class="co"># End with data frame of 357 rows and 9 columns (new: name and abbr)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       long      lat order  hole piece id group  name abbr
1 -72.62574 55.31320     1 FALSE     1  1   1.1 Maine   ME
2 -69.90286 54.40843     2 FALSE     1  1   1.1 Maine   ME
3 -69.90286 52.53744     3 FALSE     1  1   1.1 Maine   ME
4 -72.62574 51.57081     4 FALSE     1  1   1.1 Maine   ME
5 -75.34861 52.53744     5 FALSE     1  1   1.1 Maine   ME
6 -75.34861 54.40843     6 FALSE     1  1   1.1 Maine   ME</code></pre>
</div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk B</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial_sf <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="fu">str_replace</span>(google_name,<span class="st">' </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)'</span>,<span class="st">''</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">abbr =</span> iso3166_2</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk B):</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk B</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial_sf) <span class="co"># Start with sf object with 51 regions and 7 variables/features</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 7 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -113.4688 ymin: 30.53798 xmax: -69.90286 ymax: 55.3132
Geodetic CRS:  WGS 84
  cartodb_id          created_at          updated_at label bees iso3166_2
1       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
2       1217 2015-05-13 17:24:35 2015-10-05 11:00:16  R.I. 47.8        RI
3       1218 2015-05-13 17:25:00 2015-10-05 11:00:16   Vt. 33.9        VT
4        231 2015-05-13 17:02:22 2015-10-05 11:00:16 Okla. 63.4        OK
5        244 2015-05-13 17:02:22 2015-10-05 11:00:16  N.C. 41.5        NC
6        259 2015-05-13 17:02:22 2015-10-05 11:00:16   Va. 45.6        VA
                     google_name                       geometry
1          Maine (United States) POLYGON ((-72.62574 55.3132...
2   Rhode Island (United States) POLYGON ((-72.62574 49.5743...
3        Vermont (United States) POLYGON ((-80.79436 52.5374...
4       Oklahoma (United States) POLYGON ((-110.746 35.79821...
5 North Carolina (United States) POLYGON ((-91.68585 39.5301...
6       Virginia (United States) POLYGON ((-88.96298 43.0717...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial_sf <span class="sc">%&gt;%</span> <span class="co"># Create new variables: name (defined as the google_name after removing "(United States)"), and abbr (the state abbreviation from variable iso3166_2)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="fu">str_replace</span>(google_name,<span class="st">' </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)'</span>,<span class="st">''</span>),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">abbr =</span> iso3166_2</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial_sf) <span class="co"># Ends with sf object with 51 regions and 9 variables/features</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 9 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -113.4688 ymin: 30.53798 xmax: -69.90286 ymax: 55.3132
Geodetic CRS:  WGS 84
  cartodb_id          created_at          updated_at label bees iso3166_2
1       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
2       1217 2015-05-13 17:24:35 2015-10-05 11:00:16  R.I. 47.8        RI
3       1218 2015-05-13 17:25:00 2015-10-05 11:00:16   Vt. 33.9        VT
4        231 2015-05-13 17:02:22 2015-10-05 11:00:16 Okla. 63.4        OK
5        244 2015-05-13 17:02:22 2015-10-05 11:00:16  N.C. 41.5        NC
6        259 2015-05-13 17:02:22 2015-10-05 11:00:16   Va. 45.6        VA
                     google_name                       geometry           name
1          Maine (United States) POLYGON ((-72.62574 55.3132...          Maine
2   Rhode Island (United States) POLYGON ((-72.62574 49.5743...   Rhode Island
3        Vermont (United States) POLYGON ((-80.79436 52.5374...        Vermont
4       Oklahoma (United States) POLYGON ((-110.746 35.79821...       Oklahoma
5 North Carolina (United States) POLYGON ((-91.68585 39.5301... North Carolina
6       Virginia (United States) POLYGON ((-88.96298 43.0717...       Virginia
  abbr
1   ME
2   RI
3   VT
4   OK
5   NC
6   VA</code></pre>
</div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk C</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>hex_growth_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hex_spatial_df, pop_growth, <span class="at">by =</span> <span class="st">'name'</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>hex_growth_sf <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hex_spatial_sf, pop_growth, <span class="at">by =</span> <span class="st">'name'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk C):</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk C</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>hex_growth_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hex_spatial_df, pop_growth, <span class="at">by =</span> <span class="st">'name'</span>) <span class="co"># Add in pop_growth variables to data frame using left_join; in the process duplicate the geometry for each region for each year</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_growth_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       long     lat order  hole piece id group  name abbr geography_type year
1 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1910
2 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1920
3 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1930
4 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1940
5 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1950
6 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1960
  resident_population percent_change_in_resident_population
1              742371                                   6.9
2              768014                                   3.5
3              797423                                   3.8
4              847226                                   6.2
5              913774                                   7.9
6              969265                                   6.1
  resident_population_density resident_population_density_rank
1                        24.1                               33
2                        24.9                               34
3                        25.9                               36
4                        27.5                               36
5                        29.6                               37
6                        31.4                               38
  number_of_representatives change_in_number_of_representatives
1                         4                                   0
2                         4                                   0
3                         3                                  -1
4                         3                                   0
5                         3                                   0
6                         2                                  -1
  average_apportionment_population_per_representative
1                                              185593
2                                              192004
3                                              265806
4                                              282409
5                                              304591
6                                              484633</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(hex_growth_df) <span class="co"># end with data frame of 4284 rows and 18 variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4284   18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>hex_growth_sf <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hex_spatial_sf, pop_growth, <span class="at">by =</span> <span class="st">'name'</span>) <span class="co"># add in pop_growth variables to sf object using left join; in the process duplicate the geometry for each region for each year </span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_growth_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 18 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -75.34861 ymin: 51.57081 xmax: -69.90286 ymax: 55.3132
Geodetic CRS:  WGS 84
  cartodb_id          created_at          updated_at label bees iso3166_2
1       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
2       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
3       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
4       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
5       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
6       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
            google_name  name abbr geography_type year resident_population
1 Maine (United States) Maine   ME          State 1910              742371
2 Maine (United States) Maine   ME          State 1920              768014
3 Maine (United States) Maine   ME          State 1930              797423
4 Maine (United States) Maine   ME          State 1940              847226
5 Maine (United States) Maine   ME          State 1950              913774
6 Maine (United States) Maine   ME          State 1960              969265
  percent_change_in_resident_population resident_population_density
1                                   6.9                        24.1
2                                   3.5                        24.9
3                                   3.8                        25.9
4                                   6.2                        27.5
5                                   7.9                        29.6
6                                   6.1                        31.4
  resident_population_density_rank number_of_representatives
1                               33                         4
2                               34                         4
3                               36                         3
4                               36                         3
5                               37                         3
6                               38                         2
  change_in_number_of_representatives
1                                   0
2                                   0
3                                  -1
4                                   0
5                                   0
6                                  -1
  average_apportionment_population_per_representative
1                                              185593
2                                              192004
3                                              265806
4                                              282409
5                                              304591
6                                              484633
                        geometry
1 POLYGON ((-72.62574 55.3132...
2 POLYGON ((-72.62574 55.3132...
3 POLYGON ((-72.62574 55.3132...
4 POLYGON ((-72.62574 55.3132...
5 POLYGON ((-72.62574 55.3132...
6 POLYGON ((-72.62574 55.3132...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(hex_growth_sf) <span class="co">#end with sf object of 612 region/year combinations and 19 variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 612  19</code></pre>
</div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk D</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>centers <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    rgeos<span class="sc">::</span><span class="fu">gCentroid</span>(hex_spatial,<span class="at">byid =</span> <span class="cn">TRUE</span>), </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">abbr =</span> hex_spatial<span class="sc">$</span>iso3166_2</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>hex_growth_df <span class="sc">%&gt;%</span> </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">group =</span> group, <span class="at">fill =</span> percent_change_in_resident_population)) <span class="sc">+</span> </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="at">data =</span> centers, <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> abbr), <span class="at">color =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span> </span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>        ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk D):</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk D</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>centers <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    rgeos<span class="sc">::</span><span class="fu">gCentroid</span>(hex_spatial,<span class="at">byid =</span> <span class="cn">TRUE</span>), <span class="co"># Create data frame of the center of each region and the state abbreviation</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">abbr =</span> hex_spatial<span class="sc">$</span>iso3166_2</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>hex_growth_df <span class="sc">%&gt;%</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> <span class="co"># focus only on the data from 2020</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span> <span class="co"># create frame of longitude and latitude</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">group =</span> group, <span class="at">fill =</span> percent_change_in_resident_population)) <span class="sc">+</span>  <span class="co"># add hex polygons defined by x and y but grouped according to group and color filled by the percent_change in resident population</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_text</span>(<span class="at">data =</span> centers, <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> abbr), <span class="at">color =</span> <span class="st">'white'</span>) <span class="sc">+</span> <span class="co"># add text at the centers of the polygons and add text labels from the abbr variable in the centers data we created</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span>  <span class="co"># change legend label</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>        ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>) <span class="co"># remove the background theme and move the legend to the bottom right</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk E</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>hex_growth_sf <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> percent_change_in_resident_population)) <span class="sc">+</span> </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_sf_text</span>( <span class="fu">aes</span>(<span class="at">label =</span> abbr), <span class="at">color =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span> </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>        ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk E):</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk E</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>hex_growth_sf <span class="sc">%&gt;%</span>  <span class="co"># start with sf object</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> <span class="co">#filter to focus on data from 2020</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> percent_change_in_resident_population)) <span class="sc">+</span> <span class="co"># plot the sf geometry (polygons) and fill color according to percent change in population</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_sf_text</span>( <span class="fu">aes</span>(<span class="at">label =</span> abbr), <span class="at">color =</span> <span class="st">'white'</span>) <span class="sc">+</span> <span class="co"># add text labels to the sf geometry regions using abbr for the text</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span> <span class="co"># Change legend label</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>) <span class="co"># remove the background theme and move the legend to the bottom right </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</details>
</section>
<section id="exercise-10" class="level3">
<h3 class="anchored" data-anchor-id="exercise-10">Exercise 10</h3>
<p>Using the hexbin spatial boundaries and the <code>pop_growth</code> data, make the following updates to the choropleth graphic:</p>
<ul>
<li>Change the outcome variable (different year or variable).</li>
<li>Change the fill scale to be more meaningful and effective.</li>
<li>Make one more update beyond the fill color to improve the effectiveness of the graphic.</li>
</ul>
<p>Make the graphic twice, once with <code>geom_polygon()</code> and once with <code>geom_sf()</code>.</p>
<details>
<summary>
Example Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>hex_growth_df <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span> <span class="co"># create frame of longitude and latitude</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">group =</span> group, <span class="at">fill =</span> change_in_number_of_representatives)) <span class="sc">+</span>  <span class="co"># add hex polygons defined by x and y but grouped according to group and color by change in number of representatives</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># geom_text(data = centers, aes( x = x, y = y, label = abbr), color = 'white') + # add text at the centers of the polygons and add text labels from the abbr variable in the centers data we created</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_wrap</span>(<span class="sc">~</span> year, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span>  <span class="co"># change legend label</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>        ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>) <span class="co"># remove the background theme and move the legend to the bottom right</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>hex_growth_sf <span class="sc">%&gt;%</span>  <span class="co"># start with sf object</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> change_in_number_of_representatives)) <span class="sc">+</span> <span class="co"># plot the sf geometry (polygons) and fill color according to change in number of representatives</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># geom_sf_text( aes(label = abbr), color = 'white') + # add text labels to the sf geometry regions using abbr for the text</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_wrap</span>(<span class="sc">~</span> year, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span> <span class="co"># Change legend label</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>) <span class="co"># remove the background theme and move the legend to the bottom right</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</details>
</section>
<section id="bonus-challenge" class="level3">
<h3 class="anchored" data-anchor-id="bonus-challenge">Bonus Challenge</h3>
<p>Find external state-level data online, read it into R, join it, and create a U.S. state hexbin map displaying that new state-level outcome.</p>
</section>
</section>
<section id="mn-citycounty-example" class="level2">
<h2 class="anchored" data-anchor-id="mn-citycounty-example">MN City/County example</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop to Reflect
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>When looking through code examples, notice familiar functions and syntax patterns. Also, notice new functions and try figure out what they are doing.</p>
<p>Add comments to the code so that you can come back to the examples when you need them.</p>
</div>
</div>
</div>
<section id="unifying-crss-across-different-spatial-datasets" class="level3">
<h3 class="anchored" data-anchor-id="unifying-crss-across-different-spatial-datasets">Unifying CRSs across different spatial datasets</h3>
<p>To demonstrate other spatial geometries beyond polygons (the hexagons in the last example were spatial polygons), we’ll walk through create a map of MN with different layers of information (city point locations, county polygon boundaries, rivers as lines and polygons, and a raster elevation map). To add all of this information on one map, we need to ensure that the CRS is the same for all spatial datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check CRS</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_cities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD83 / UTM zone 15N 
  wkt:
PROJCRS["NAD83 / UTM zone 15N",
    BASEGEOGCRS["NAD83",
        DATUM["North American Datum 1983",
            ELLIPSOID["GRS 1980",6378137,298.257222101,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4269]],
    CONVERSION["UTM zone 15N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-93,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",26915]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check CRS</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_water)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD83 / UTM zone 15N 
  wkt:
PROJCRS["NAD83 / UTM zone 15N",
    BASEGEOGCRS["NAD83",
        DATUM["North American Datum 1983",
            ELLIPSOID["GRS 1980",6378137,298.257222101,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4269]],
    CONVERSION["UTM zone 15N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-93,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",26915]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (They're both NAD83 / UTM zone 15N but we'll transform anyway)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform CRS of water to the same of the cities</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>mn_water <span class="ot">&lt;-</span> mn_water <span class="sc">%&gt;%</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(mn_cities))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load country boundaries data as sf object</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>mn_counties <span class="ot">&lt;-</span> <span class="fu">us_counties</span>(<span class="at">resolution =</span> <span class="st">"high"</span>, <span class="at">states =</span> <span class="st">"Minnesota"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicate column names</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>names_counties <span class="ot">&lt;-</span> <span class="fu">names</span>(mn_counties)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mn_counties)[names_counties <span class="sc">==</span> <span class="st">'state_name'</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"state_name1"</span>, <span class="st">"state_name2"</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check CRS</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (They're different!)</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the CRS of county data to the more local CRS of the cities</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>mn_counties <span class="ot">&lt;-</span> mn_counties <span class="sc">%&gt;%</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(mn_cities))</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD83 / UTM zone 15N 
  wkt:
PROJCRS["NAD83 / UTM zone 15N",
    BASEGEOGCRS["NAD83",
        DATUM["North American Datum 1983",
            ELLIPSOID["GRS 1980",6378137,298.257222101,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4269]],
    CONVERSION["UTM zone 15N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-93,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",26915]]</code></pre>
</div>
</div>
</section>
<section id="initial-map-counties-and-cities" class="level3">
<h3 class="anchored" data-anchor-id="initial-map-counties-and-cities">Initial map: counties and cities</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="co"># plot frame</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="co"># county boundary layer</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="co"># city point layer</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_map</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="st">"wheat"</span>, <span class="at">color =</span> <span class="st">"tan"</span>) <span class="sc">+</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Population <span class="sc">&gt;=</span> <span class="dv">10000</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Population, <span class="at">size =</span> Population), <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span> <span class="co">#cities layer</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span> <span class="co"># continuous (gradient) color scale</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Minnesota Cities with Population &gt;= 10,000"</span>) <span class="sc">+</span> </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co">#move legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="updated-map-counties-and-cities-plus-elevation" class="level3">
<h3 class="anchored" data-anchor-id="updated-map-counties-and-cities-plus-elevation">Updated map: counties and cities plus elevation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>elevation <span class="ot">&lt;-</span> elevatr<span class="sc">::</span><span class="fu">get_elev_raster</span>(mn_counties, <span class="at">z =</span> <span class="dv">5</span>, <span class="at">clip =</span> <span class="st">'bbox'</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">crs</span>(elevation) <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(mn_counties)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to Data Frame for plotting</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>elev_df <span class="ot">&lt;-</span> elevation <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(elev_df) <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">'x'</span>,<span class="st">'y'</span>,<span class="st">'value'</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_raster</span>(<span class="at">data =</span> elev_df, <span class="fu">aes</span>(<span class="at">x =</span> x,<span class="at">y =</span> y,<span class="at">fill =</span> value)) <span class="sc">+</span> <span class="co"># adding the elevation as first (bottom) layer</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Population <span class="sc">&gt;=</span> <span class="dv">10000</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Population,<span class="at">size =</span> Population), <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span> <span class="co">#cities layer</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span> <span class="co">#continuous (gradient) color scale</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">'darkgreen'</span>,<span class="at">high =</span> <span class="st">'white'</span>, <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Minnesota Cities with Population &gt;= 10,000"</span>) <span class="sc">+</span> </span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co">#move legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="updated-map-zoom-in-to-twin-cities" class="level3">
<h3 class="anchored" data-anchor-id="updated-map-zoom-in-to-twin-cities">Updated map: zoom in to Twin Cities</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>seven_countyarea <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(mn_counties <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Anoka"</span>, <span class="st">"Hennepin"</span>, <span class="st">"Ramsey"</span>, <span class="st">"Dakota"</span>, <span class="st">"Carver"</span>, <span class="st">"Washington"</span>, <span class="st">"Scott"</span>)))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>elevation <span class="ot">&lt;-</span> elevatr<span class="sc">::</span><span class="fu">get_elev_raster</span>(mn_counties <span class="sc">%&gt;%</span> <span class="fu">st_crop</span>(seven_countyarea), <span class="at">z =</span> <span class="dv">9</span>, <span class="at">clip =</span> <span class="st">'bbox'</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">crs</span>(elevation) <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(mn_counties)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame for plotting</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>elev_df <span class="ot">&lt;-</span> elevation <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(elev_df) <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">'x'</span>,<span class="st">'y'</span>,<span class="st">'value'</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_raster</span>(<span class="at">data =</span> elev_df, <span class="fu">aes</span>(<span class="at">x =</span> x,<span class="at">y =</span> y,<span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="co"># county boundary layer</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_water, <span class="at">fill =</span> <span class="st">'lightsteelblue1'</span>,<span class="at">color =</span> <span class="st">'lightsteelblue1'</span>) <span class="sc">+</span> <span class="co"># added a river/lake layer</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Population <span class="sc">&gt;=</span> <span class="dv">10000</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Population,<span class="at">size =</span> Population)) <span class="sc">+</span> <span class="co"># cities layer</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> seven_countyarea[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)], <span class="at">ylim =</span> seven_countyarea[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)]) <span class="sc">+</span> <span class="co"># crop map to coordinates of seven county area</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">'magma'</span>) <span class="sc">+</span> <span class="co"># continuous (gradient) color scale</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">'darkgreen'</span>,<span class="at">high =</span> <span class="st">'white'</span>) <span class="sc">+</span> <span class="co"># continuous (gradient) fill scale</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Twin Cities with Population &gt;= 10,000"</span>) <span class="sc">+</span> </span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  <span class="co"># remove legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="twin-cities-leaflet" class="level3">
<h3 class="anchored" data-anchor-id="twin-cities-leaflet">Twin Cities Leaflet</h3>
<p>Below we show how to make the MN counties map in the <code>leaflet</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>mn_counties_leaf <span class="ot">&lt;-</span> mn_counties <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="dv">4326</span>) <span class="co"># Leaflet expects this CRS for vectors</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>mn_cities_leaf <span class="ot">&lt;-</span> mn_cities <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="dv">4326</span>) <span class="co"># Leaflet expects this CRS for vectors</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>Cities_per_County <span class="ot">&lt;-</span> <span class="fu">st_join</span>(mn_cities_leaf, mn_counties_leaf) <span class="sc">%&gt;%</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> <span class="co">#removes geometry - makes the following calculation more efficient </span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(name) </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>mn_counties_leaf <span class="sc">%&gt;%</span> </span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Anoka"</span>, <span class="st">"Hennepin"</span>, <span class="st">"Ramsey"</span>, <span class="st">"Dakota"</span>, <span class="st">"Carver"</span>, <span class="st">"Washington"</span>, <span class="st">"Scott"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(Cities_per_County) <span class="sc">%&gt;%</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addProviderTiles</span>(<span class="st">"CartoDB.Positron"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addPolygons</span>(<span class="at">color =</span> <span class="st">"#444444"</span>, <span class="at">weight =</span> <span class="dv">1</span>, <span class="at">smoothFactor =</span> <span class="fl">0.5</span>,</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="fl">1.0</span>, <span class="at">fillOpacity =</span> <span class="fl">0.5</span>, <span class="at">fillColor =</span> <span class="sc">~</span><span class="fu">colorQuantile</span>(<span class="st">"YlOrRd"</span>, n)(n), <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">bringToFront =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addCircles</span>(<span class="at">data =</span> mn_cities_leaf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(County <span class="sc">%in%</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">"Anoka"</span>, <span class="st">"Hennepin"</span>, <span class="st">"Ramsey"</span>, <span class="st">"Dakota"</span>, <span class="st">"Carver"</span>, <span class="st">"Washington"</span>, <span class="st">"Scott"</span>),<span class="st">'County'</span>)), <span class="at">color =</span> <span class="st">"#444444"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="open-ended-exercise-homework" class="level2">
<h2 class="anchored" data-anchor-id="open-ended-exercise-homework">Open-ended Exercise (Homework)</h2>
<p>The following exercises will use census tract <code>tidycensus</code> data for Ramsey and Hennepin county and <a href="data/Crash.csv">Crash.csv</a> (2019-2022) from the <a href="https://information.stpaul.gov/datasets/stpaul::pedestrian-and-bike-crash-dataset-/about">pedestrian/bike crash database</a> for St.&nbsp;Paul within Ramsey county in the Twin Cities. We provide several variables that you can choose from in order to create maps that best fit your interest.</p>
<p>Load the data with the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>census2020 <span class="ot">&lt;-</span> tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(<span class="at">year =</span> <span class="dv">2020</span>, <span class="at">state =</span> <span class="st">"MN"</span>, <span class="at">geography =</span> <span class="st">"tract"</span>, <span class="at">variables =</span> <span class="fu">c</span>(    </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="st">"B01003_001"</span>, <span class="st">"B19013_001"</span>, <span class="st">"B23006_023"</span>, <span class="st">"B25058_001"</span>, <span class="st">"B25107_001"</span>, <span class="st">"B25003_001"</span>, <span class="st">"B25003_002"</span>, <span class="st">"B25003_003"</span>, <span class="st">"B25077_001"</span>), <span class="at">output =</span> <span class="st">'wide'</span>, <span class="at">geometry =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">word</span>(NAME, <span class="dv">4</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ramsey"</span>,<span class="st">"Hennepin"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">tract =</span> <span class="fu">word</span>(NAME, <span class="dv">3</span>),</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tract =</span> <span class="fu">str_remove</span>(tract, <span class="st">","</span>),</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">county =</span> <span class="fu">word</span>(NAME, <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>               <span class="fu">select</span>(<span class="sc">-</span>NAME) <span class="sc">%&gt;%</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rename</span>(<span class="st">"population"</span> <span class="ot">=</span> <span class="st">"B01003_001E"</span>, </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"medianIncome"</span> <span class="ot">=</span> <span class="st">"B19013_001E"</span>, </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"bachelors"</span> <span class="ot">=</span> <span class="st">"B23006_023E"</span>,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"medContractRent"</span> <span class="ot">=</span> <span class="st">"B25058_001E"</span>, </span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"tenureTotal"</span> <span class="ot">=</span> <span class="st">"B25003_001E"</span>, </span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"tenureOwned"</span> <span class="ot">=</span> <span class="st">"B25003_002E"</span>, </span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"tenureRented"</span> <span class="ot">=</span> <span class="st">"B25003_003E"</span>,</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"medianHomeValue"</span><span class="ot">=</span> <span class="st">"B25077_001E"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"_"</span>))</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>crashes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://lmyint.github.io/212_fall_2023/data/Crash.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Latitude), <span class="sc">!</span><span class="fu">is.na</span>(Longitude))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercise-joining-and-aggregation" class="level3">
<h3 class="anchored" data-anchor-id="exercise-joining-and-aggregation">Exercise: Joining and aggregation</h3>
<p><strong>Create a map of crashes per census tract in Ramsey county.</strong></p>
<p>First, transform the <code>crashes</code> data frame to a <code>sf</code> object have a point geometry using the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>crashes <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(crashes, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs =</span> <span class="st">"NAD83"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the CRS are the same for <code>census2020</code> and <code>crashes</code> using <code>st_crs()</code> and transform if needed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join the crashes and census dataset together and count the number of crashes per census tract. The function <code>st_join</code> can join to spatial data sets according to whether the spatial geometries of the right table intersect with the spatial geometries of the left table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>crashes_per_tract <span class="ot">&lt;-</span> <span class="fu">st_join</span>(??,??) <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> <span class="co"># removes geometry - makes the following calculation more efficient </span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Accident_Datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(??) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join the census data with <code>crashes_per_tract</code> and then use a filter of <code>n &gt; 0</code> to only keep the census tracts where crashes were recorded instead of all of Ramsey and Hennepin County.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>crashes_per_tract_geo <span class="ot">&lt;-</span> ??? <span class="sc">%&gt;%</span> <span class="co"># sf object with census geometry goes first</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(??, <span class="at">by =</span> ??) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create the plot!!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(???) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"lightcyan"</span>, <span class="st">"lightcyan2"</span>, <span class="st">"lightskyblue3"</span>, <span class="st">"lightskyblue4"</span>))<span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Crashes"</span>, <span class="at">color =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Number of pedestrian/bike crashes per census tract"</span>) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercise-adding-layers" class="level3">
<h3 class="anchored" data-anchor-id="exercise-adding-layers">Exercise: Adding layers</h3>
<p><strong>Plot a variable of your choice for census tracts in Hennepin and Ramsey County and add roads to the map.</strong></p>
<p>Start by downloading a shape file. For example, you could search for “Minnesota roads shape file”. For this example, visit <a href="https://catalog.data.gov/dataset/tiger-line-shapefile-2019-state-minnesota-primary-and-secondary-roads-state-based-shapefile">this site</a> and download the Shapefile Zip File. Unzip the file and put the folder in the same location as this Rmd file.</p>
<p>Load in the shapefile using <code>st_read()</code> and transform <code>roads</code> to have the same CRS as <code>census2020</code> if necessary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"tl_2019_27_prisecroads"</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check CRS of roads and transform if necessary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Start by using <code>st_crop()</code> to crop the roads map to the area we are interested in (Hennepin and Ramsey County).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>roads_sub <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(roads,<span class="fu">st_bbox</span>(census2020))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create the map!!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(??)<span class="sc">+</span> <span class="co">#put census tracts on map and fill by your variable of interest</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(?? ,<span class="at">fill =</span> <span class="st">"gray"</span>, <span class="at">color =</span> <span class="st">"gray"</span>, <span class="at">lwd =</span> <span class="fl">0.2</span>)<span class="sc">+</span> <span class="co">#roads data here</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(??)<span class="sc">+</span> <span class="co"># add labels to fit your variables </span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"lightcyan"</span>, <span class="st">"lightcyan2"</span>, <span class="st">"lightskyblue3"</span>, <span class="st">"lightskyblue4"</span>))<span class="sc">+</span> <span class="co"># change to preferred color palette</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.line =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title.position =</span> <span class="st">"plot"</span>, </span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>), </span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>How to cite AI and other resources:</strong> If you use AI tools like ChatGPT or Google Bard, please copy and paste all prompts and output into an “Appendix” section of this assignment. If you use an AI tool, also list one environmentally-friendly action you could adopt (that you don’t already do) to offset the energy usage. Also list any websites used in this Appendix.</p>
<p><strong>Submission details:</strong> Click the “Render” button to create an HTML report from your Quarto file. Open the HTML in your web browser and save the webpage as a PDF (Ctrl-P/Command P, choose “Save as PDF” as the Destination). Submit this PDF on <a href="https://moodle.macalester.edu/mod/assign/view.php?id=37543">Moodle</a> AND the <code>.qmd</code> file by midnight on Wednesday, 9/20.</p>
</section>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<ul>
<li>Spatial Data Science <a href="https://r-spatial.org/book/" class="uri">https://r-spatial.org/book/</a></li>
<li>Leaflet in R <a href="https://rstudio.github.io/leaflet/" class="uri">https://rstudio.github.io/leaflet/</a></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© Leslie Myint, 2023<br> All content licensed under <img src="https://static.thenounproject.com/png/70967-200.png" height="20"> (<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>)</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Site built with <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>