<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brianna Heggeseth (with contributions from Erin Franke and Vivian Powell)">

<title>STAT/COMP 212 - Topic 3: Advanced Spatial Visualizations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="site_libs/jquery-1.12.4/jquery.min.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.1.2/leaflet.js"></script>
<script src="site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="site_libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STAT/COMP 212</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./activities.html" rel="" target="">
 <span class="menu-text">Activities</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./homework.html" rel="" target="">
 <span class="menu-text">Homework</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./project.html" rel="" target="">
 <span class="menu-text">Project</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-adv-maps.html">Topic 3: Advanced Spatial Visualizations</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introductions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic 1: Introductions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-adv-ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic 2: Advanced Data Visualization in ggplot2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-adv-maps.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Topic 3: Advanced Spatial Visualizations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-interactive-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic 4: Interactive visualization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-data-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic 5: Wrangling numerics, logicals, factors, and dates</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-functions-control-structs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic 6: Functions and control structures</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">Learning goals</a></li>
  <li><a href="#spatial-visualization-review" id="toc-spatial-visualization-review" class="nav-link" data-scroll-target="#spatial-visualization-review">Spatial Visualization Review</a></li>
  <li><a href="#what-next" id="toc-what-next" class="nav-link" data-scroll-target="#what-next">What next?</a></li>
  <li><a href="#coordinate-reference-system" id="toc-coordinate-reference-system" class="nav-link" data-scroll-target="#coordinate-reference-system">Coordinate Reference System</a>
  <ul class="collapse">
  <li><a href="#ellipsoid" id="toc-ellipsoid" class="nav-link" data-scroll-target="#ellipsoid">Ellipsoid</a></li>
  <li><a href="#datum" id="toc-datum" class="nav-link" data-scroll-target="#datum">Datum</a>
  <ul class="collapse">
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise</a></li>
  </ul></li>
  <li><a href="#projection" id="toc-projection" class="nav-link" data-scroll-target="#projection">Projection</a>
  <ul class="collapse">
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#spatial-data" id="toc-spatial-data" class="nav-link" data-scroll-target="#spatial-data">Spatial Data</a>
  <ul class="collapse">
  <li><a href="#data-models" id="toc-data-models" class="nav-link" data-scroll-target="#data-models">Data Models</a>
  <ul class="collapse">
  <li><a href="#vector" id="toc-vector" class="nav-link" data-scroll-target="#vector">Vector</a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4">Exercise</a></li>
  <li><a href="#raster" id="toc-raster" class="nav-link" data-scroll-target="#raster">Raster</a></li>
  </ul></li>
  <li><a href="#working-with-spatial-data-in-r" id="toc-working-with-spatial-data-in-r" class="nav-link" data-scroll-target="#working-with-spatial-data-in-r">Working with Spatial Data in R</a>
  <ul class="collapse">
  <li><a href="#read-in-data-to-r" id="toc-read-in-data-to-r" class="nav-link" data-scroll-target="#read-in-data-to-r">Read in data to R</a></li>
  <li><a href="#data-classes-in-r" id="toc-data-classes-in-r" class="nav-link" data-scroll-target="#data-classes-in-r">Data classes in R</a></li>
  <li><a href="#exercise-5" id="toc-exercise-5" class="nav-link" data-scroll-target="#exercise-5">Exercise</a></li>
  <li><a href="#exercise-6" id="toc-exercise-6" class="nav-link" data-scroll-target="#exercise-6">Exercise</a></li>
  <li><a href="#exercise-7" id="toc-exercise-7" class="nav-link" data-scroll-target="#exercise-7">Exercise</a></li>
  <li><a href="#convert-data-class-types" id="toc-convert-data-class-types" class="nav-link" data-scroll-target="#convert-data-class-types">Convert data class types</a></li>
  <li><a href="#exercise-8" id="toc-exercise-8" class="nav-link" data-scroll-target="#exercise-8">Exercise</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#spatial-maps" id="toc-spatial-maps" class="nav-link" data-scroll-target="#spatial-maps">Spatial Maps</a>
  <ul class="collapse">
  <li><a href="#hexbin-choropleth" id="toc-hexbin-choropleth" class="nav-link" data-scroll-target="#hexbin-choropleth">Hexbin Choropleth</a>
  <ul class="collapse">
  <li><a href="#exercise-9" id="toc-exercise-9" class="nav-link" data-scroll-target="#exercise-9">Exercise</a></li>
  <li><a href="#exercise-10" id="toc-exercise-10" class="nav-link" data-scroll-target="#exercise-10">Exercise</a></li>
  <li><a href="#bonus-challenge" id="toc-bonus-challenge" class="nav-link" data-scroll-target="#bonus-challenge">Bonus Challenge</a></li>
  </ul></li>
  <li><a href="#mn-citycounty-example" id="toc-mn-citycounty-example" class="nav-link" data-scroll-target="#mn-citycounty-example">MN City/County example</a>
  <ul class="collapse">
  <li><a href="#unify-crs" id="toc-unify-crs" class="nav-link" data-scroll-target="#unify-crs">Unify CRS</a></li>
  <li><a href="#initial-map-counties-and-cities" id="toc-initial-map-counties-and-cities" class="nav-link" data-scroll-target="#initial-map-counties-and-cities">Initial Map: Counties and Cities</a></li>
  <li><a href="#updated-map-counties-and-cities-plus-elevation" id="toc-updated-map-counties-and-cities-plus-elevation" class="nav-link" data-scroll-target="#updated-map-counties-and-cities-plus-elevation">Updated Map: Counties and Cities plus Elevation</a></li>
  <li><a href="#zoom-to-twin-cities-map" id="toc-zoom-to-twin-cities-map" class="nav-link" data-scroll-target="#zoom-to-twin-cities-map">Zoom to Twin Cities Map</a></li>
  <li><a href="#twin-cities-leaflet" id="toc-twin-cities-leaflet" class="nav-link" data-scroll-target="#twin-cities-leaflet">Twin Cities Leaflet</a></li>
  </ul></li>
  <li><a href="#open-ended-exercise" id="toc-open-ended-exercise" class="nav-link" data-scroll-target="#open-ended-exercise">Open-ended Exercise</a>
  <ul class="collapse">
  <li><a href="#exercise-joining-and-aggregation" id="toc-exercise-joining-and-aggregation" class="nav-link" data-scroll-target="#exercise-joining-and-aggregation">Exercise: Joining and aggregation</a></li>
  <li><a href="#exercise-adding-layers" id="toc-exercise-adding-layers" class="nav-link" data-scroll-target="#exercise-adding-layers">Exercise: Adding layers</a></li>
  <li><a href="#bonus-challenge-map-design-if-you-have-time" id="toc-bonus-challenge-map-design-if-you-have-time" class="nav-link" data-scroll-target="#bonus-challenge-map-design-if-you-have-time">Bonus Challenge: Map design (if you have time)</a></li>
  </ul></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Topic 3: Advanced Spatial Visualizations</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brianna Heggeseth (with contributions from Erin Franke and Vivian Powell) </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="learning-goals" class="level1">
<h1>Learning goals</h1>
<p>After this lesson, you should be able to:</p>
<ul>
<li>Understand the basics of a CRS (coordinate reference system)</li>
<li>Understand and recognize different spatial file types and data types in R</li>
<li>Implement some of the basic plotting with the <code>sf</code> package</li>
<li>Understand foundational ideas in working with spatial data (aggregating spatial point data to a spatial region, joining spatial data sets)</li>
</ul>
</section>
<section id="spatial-visualization-review" class="level1">
<h1>Spatial Visualization Review</h1>
<p>In STAT/COMP 112, you learned about basic spatial visualizations. To review,</p>
<ul>
<li><strong>Background Maps in ggplot</strong>. The <code>ggmap</code> package includes tools to create a plot with a map background. In particular, <code>get_stamenmap()</code> accesses map image tiles from Stamen Maps (<a href="http://maps.stamen.com/" class="uri">http://maps.stamen.com/</a>) based on a provided bounding box (bbox) and <code>ggmap()</code> can be used instead of <code>ggplot()</code> to use a background map image as the plotting frame.
<ul>
<li><a href="http://Openstreetmap.org" class="uri">http://Openstreetmap.org</a> is an excellent tool to find longitude/latitude values for a desired bbox.</li>
<li><em>Technical note: The bounding box of the ggmap object has a CRS of WGS84 (EPSG:4326), but the actual raster is in EPSG:3857. We’ll talk about CRS in this activity</em></li>
</ul></li>
<li><strong>Contour Plots</strong>. The <code>geom_density_2d()</code> function in <code>ggplot2</code> package displays contours of intensity of points in a spatial area.</li>
<li><strong>Choropleth</strong>. The <code>geom_map(data, map, aes(map_id))</code> function in <code>ggplot2</code> package displays choropleth maps (filled polygons/regions) based on a data frame of coordinates (long/x,lat/y,region/id) and an attribute data frame with properties for each region or id.</li>
<li><strong>Leaflet</strong>. The <code>leaflet</code> package in R provides access to the Leaflet javascript library (<a href="https://leafletjs.com/" class="uri">https://leafletjs.com/</a>) to create interactive maps. A basic map can be created with a data frame of coordinates and attributes (more advanced topics can be found at <a href="https://rstudio.github.io/leaflet/" class="uri">https://rstudio.github.io/leaflet/</a>):</li>
</ul>
<pre><code>leaflet(data) %&gt;% 
  addTiles() %&gt;% 
  addMarkers()</code></pre>
</section>
<section id="what-next" class="level1">
<h1>What next?</h1>
<p>We used based mapping tools without thinking too much about the details of the maps. In order to create more advanced spatial visualizations, you need a foundation in spatial coordinate reference systems and how spatial data is often recorded and stored!</p>
</section>
<section id="coordinate-reference-system" class="level1">
<h1>Coordinate Reference System</h1>
<p>At the heart of every spatial visualization is a set of locations. One way to describe a location is in terms of coordinates and a coordinate reference system (known as CRS).</p>
<p>There are three main components to a CRS: ellipsoid, datum, and a projection.</p>
<section id="ellipsoid" class="level2">
<h2 class="anchored" data-anchor-id="ellipsoid">Ellipsoid</h2>
<p>While you might have learned that the Earth is a sphere, it is actually closer to an ellipsoid with a bulge at the equator. Additionally, the surface is irregular and not smooth. To define a CRS, we first need to choose a mathematical model represent a smooth approximation to the shape of the Earth. The common ellipsoid models are known as WGS84 and GRS80. See the illustration below of one ellipsoid model (shown in black) as compared to Earth’s true irregular surface (shown in red).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.icsm.gov.au/sites/default/files/inline-images/geocentric_0.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Illustration of ellipsoid model and Earth’s irregular surface, centered to have an overall best fit. Source: www.icsm.gov.au</figcaption>
</figure>
</div>
</section>
<section id="datum" class="level2">
<h2 class="anchored" data-anchor-id="datum">Datum</h2>
<p>Each ellipsoid model has different ways to position it self relative to Earth depending on the center or origin. Each potential position and reference frame for representing the position of locations on Earth is called a datum.</p>
<p>For example, two different datum for the same ellipsoid model can provide a more accurate fit or approximation of the Earth’s surface depending on the region of interest (South America v. North America). For example, the NAD83 datum is a good fit for the GRS80 ellipsoid in North America, but SIRGAS2000 is a better fit for the GRS80 ellipsoid in South America. The illustration below shows one datum in which the center of the ellipsoid does not coincide with the center of Earth’s mass. With this position of the ellipsoid, we gain a better fit for the southern half of the Earth.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.icsm.gov.au/sites/default/files/inline-images/regional_0.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Illustration of ellipsoid model and Earth’s irregular surface for a datum that better fits southern part (bottom right) of the Earth. Source: www.icsm.gov.au</figcaption>
</figure>
</div>
<p>It is useful to know that the Global Positioning System (GPS) uses the WGS84 ellipsoid model and a datum by the same name, which provides an overall best fit of the Earth.</p>
<p>If you have longitude and latitude coordinates for a location, it is important to know what datum and ellipsoid were used to define those positions.</p>
<p><em>Note: In practice, the horizontal distance between WGS84 and NAD83 coordinates is about 3-4 feet in the US, which may not be significant for most applications.</em></p>
<section id="exercise" class="level3">
<h3 class="anchored" data-anchor-id="exercise">Exercise</h3>
<p>Go to <a href="https://epsg.io/" class="uri">https://epsg.io/</a>. Search for a location important to you (state, country, etc.). Filter based on Datum (Geodetic) on the right. Click on one geodetic datum options for your region of interest (make sure your location is listed under Area of Use). Repeat for three locations.</p>
<p>Provide the region of interest (e.g.&nbsp;United States), the full datum name (e.g.&nbsp;North American Datum 1983), the shorthand name (e.g.&nbsp;NAD83, EPSG: 6269), and the ellipsoid (e.g.&nbsp;GRS 1980).</p>
<blockquote class="blockquote">
<p>Location 1:</p>
</blockquote>
<blockquote class="blockquote">
<p>Location 2:</p>
</blockquote>
<blockquote class="blockquote">
<p>Location 3:</p>
</blockquote>
<details>
<summary>
Example Solution
</summary>
<blockquote class="blockquote">
<p>Location 1: South Africa, Cape, EPSG:6222, Ellipsoid: Clarke 1880 (Arc)</p>
</blockquote>
<blockquote class="blockquote">
<p>Location 2: Thailand, Indian 1975, EPSG:6240, Ellipsoid: Everest 1830 (1937 Adjustment)</p>
</blockquote>
<blockquote class="blockquote">
<p>Location 3: Colombia, Marco Geocentrico Nacional de Referencia, EPSG:6686, Ellipsoid: GRS 1980</p>
</blockquote>
</details>
</section>
<section id="exercise-1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1">Exercise</h3>
<p>Let’s now practice specifying coordinates in a CRS.</p>
<p>For <em>geographic coordinate reference systems</em>, the coordinates of locations are specified by latitude (degrees north or south of the equator), longitude (degrees west or east of a prime meridian), and sometimes height.</p>
<p>Find the location of Macalester College (OLRI) in longitude and latitude degrees.</p>
<blockquote class="blockquote">
<p>Longitude:</p>
</blockquote>
<blockquote class="blockquote">
<p>Latitude:</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<blockquote class="blockquote">
<p>Longitude: -93.168855</p>
</blockquote>
<blockquote class="blockquote">
<p>Latitude: 44.936611</p>
</blockquote>
</details>
<p>For <em>projected coordinate reference systems</em>, the coordinates of locations are typically specified by easting (x) and northing (y). Go to https://epsg.io/, find the location, and transform the longitude and latitude using the following projected CRS: EPSG:26993.</p>
<p>Find the location of Macalester College (OLRI) in northing and easting coordinates (in meters) for the CRS EPSG:26993.</p>
<blockquote class="blockquote">
<p>Easting:</p>
</blockquote>
<blockquote class="blockquote">
<p>Northing:</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<blockquote class="blockquote">
<p>Easting: 865601.084165104</p>
</blockquote>
<blockquote class="blockquote">
<p>Northing: 315515.92290198436</p>
</blockquote>
</details>
</section>
</section>
<section id="projection" class="level2">
<h2 class="anchored" data-anchor-id="projection">Projection</h2>
<p>Lastly, the Earth lives in a 3 dimensional (3D) world and most visualizations are on a 2 dimensional (2D) surface. We must choose a projection method to represent points, regions, and lines on Earth on a 2D map with distance units (typically meter, international foot, US survey foot). In that projection process, a 3D element will lose angle, area, and/or distance when projected onto a 2D surface, no matter which method is chosen.</p>
<p>For a good overview of common projection methods, see <a href="https://pubs.usgs.gov/gip/70047422/report.pdf" class="uri">https://pubs.usgs.gov/gip/70047422/report.pdf</a>.</p>
<p>One of the most commonly used projection is the Mercator projection which is a cylindrical map projection from the 1500’s. It became popular for navigation because it represented north as up and south as down everywhere and preserves local directions and shape. However, it inflates the size of regions far from the equator. Thus, Greenland, Antarctica, Canada, and Russia appear large relative to their actual land mass as compared to Central Africa. See the illustration below to compare the area/shape of the countries with the Mercator projection of the world (light blue) with the true areas/shapes (dark blue).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mercator.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><a href="./r/dataisbeautiful/comments/9nkg7k/map_projections_can_be_deceptive_oc/">Source</a>: <span class="citation" data-cites="neilrkaye">@neilrkaye</span></figcaption>
</figure>
</div>
<p>Below you can see four different world projections. Take note of what is lost in terms of angle, area, or distance in these projections.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic Map w/ labels</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>, <span class="at">title =</span> <span class="st">"World Map - Mercator Projection"</span>, <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"("</span>, <span class="fu">length</span>(<span class="fu">unique</span>(world<span class="sc">$</span>name)), <span class="st">" countries)"</span>)) <span class="sc">+</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs"</span>)  <span class="sc">+</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Lambert Azimuthal Equal-Area Projection"</span>, <span class="at">subtitle =</span> <span class="st">"Correctly represents area but not angles"</span>) <span class="sc">+</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=fouc"</span>) <span class="sc">+</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Foucaut Projection"</span>, <span class="at">subtitle =</span> <span class="st">"Correctly represents area, lots of distortion in high latitudes"</span>) <span class="sc">+</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=natearth2"</span>) <span class="sc">+</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Natural Earth II Projection"</span>, <span class="at">subtitle =</span> <span class="st">"Represents globe shape, distorted at high latitudes"</span>) <span class="sc">+</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-1-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="exercise-2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2">Exercise</h3>
<p>Create a world map with a different projection (beyond the four above). Go to <a href="https://proj.org/en/9.2/operations/projections/index.html" class="uri">https://proj.org/en/9.2/operations/projections/index.html</a> and find another projection. Look for the <code>proj-string</code> and copy that to the <code>crs =</code> argument in <code>coord_sf()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=natearth2"</span>) <span class="sc">+</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"?? Projection"</span>, <span class="at">subtitle =</span> <span class="st">"??"</span>) <span class="sc">+</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What is interesting, surprising, or different to you about the map of the Earth based on this projection?</p>
<blockquote class="blockquote">
<p>ANSWER:</p>
</blockquote>
</section>
<section id="exercise-3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3">Exercise</h3>
<p>Talk with a neighbor about the projection they tried. What projection did they use and how is it different from the one you chose?</p>
<blockquote class="blockquote">
<p>ANSWER:</p>
</blockquote>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop to Reflect
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>If coordinate reference systems are new to you, how do you feel about all of this new information? What are the most important points to take away? What are the documents and sites you can refer back to when you need more details?</p>
<p>When you learn about a new area of study, it can feel overwhelming. Pick out the 3-5 priority ideas to help you organize all of the details.</p>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="spatial-data" class="level1">
<h1>Spatial Data</h1>
<p>With a CRS (including a projection method) to collect and record location data in terms of longitude or easting (x) and latitude or northing (y) coordinates, we can now consider common models for storing spatial data on the computer. There are two main data models: vector and raster.</p>
<section id="data-models" class="level2">
<h2 class="anchored" data-anchor-id="data-models">Data Models</h2>
<section id="vector" class="level3">
<h3 class="anchored" data-anchor-id="vector">Vector</h3>
<p>Vector data represents the world as a set of spatial geometries that are defined in terms of location coordinates (with a specified CRS) with non-spatial attributes or properties.</p>
<p>The three basic vector geometries are</p>
<ul>
<li>Points: Locations defined based on a (x, y) coordinates.</li>
<li>Lines: A set of ordered points connected by straight lines.</li>
<li>Polygons: A set of ordered points connected by straight lines, first and last point are the same.</li>
</ul>
<p>For example, city locations can be represented with points, roads and rivers can be represented by lines, and geo-political boundaries and lakes can be represented by polygons.</p>
<p>Hundreds of file formats exist to store spatial vector data. A text file (such as .csv) can store the coordinates in two columns (x,y) in addition to a group id (needed for lines and polygons) plus attributes or properties in additional columns. Note that text files do not store the CRS. However, shapefiles (.shp) developed by ESRI is one of the most widely supported spatial vector file format (that includes the CRS). Additionally, GeoJSON (.geojson) and KML (.kml) are additional popular formats.</p>
</section>
<section id="exercise-4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4">Exercise</h3>
<p>To create maps, we’ll need to have access to some spatial data.</p>
<p>Go to the following websites and download the vector data files indicated. Put all of the downloaded files/folders in same folder as this Rmd file.</p>
<ul>
<li>URL: <a href="https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map" class="uri">https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map</a>
<ul>
<li>Download File Type: GeoJSON</li>
<li>Name of File: <code>us_states_hexgrid.geojson</code></li>
</ul></li>
<li>URL: <a href="https://www2.census.gov/programs-surveys/decennial/2020/data/apportionment/apportionment.csv" class="uri">https://www2.census.gov/programs-surveys/decennial/2020/data/apportionment/apportionment.csv</a>
<ul>
<li>Download File Type: csv</li>
<li>Name of File: <code>apportionment.csv</code></li>
</ul></li>
<li>URL: <a href="https://gisdata.mn.gov/dataset/loc-pop-centers" class="uri">https://gisdata.mn.gov/dataset/loc-pop-centers</a>
<ul>
<li>Download File Type: shapefile (.shp)</li>
<li>Name of File: <code>shp_loc_pop_centers.zip</code> (unzip this file to get a folder with the name <code>shp_loc_pop_centers</code>)</li>
</ul></li>
<li>URL: <a href="https://gisdata.mn.gov/dataset/us-mn-state-metc-water-lakes-rivers" class="uri">https://gisdata.mn.gov/dataset/us-mn-state-metc-water-lakes-rivers</a>
<ul>
<li>Download File Type: shapefile (.shp)</li>
<li>Name of File: <code>shp_water_lakes_rivers.zip</code> (unzip this file to get a folder with the name <code>shp_water_lakes_rivers</code>)</li>
</ul></li>
</ul>
</section>
<section id="raster" class="level3">
<h3 class="anchored" data-anchor-id="raster">Raster</h3>
<p>Raster data represents the world using a continuous grid of cells where each cell has a single value. These values could be continuous such as elevation or precipitation or categorical such as land cover or soil type.</p>
<p>Typically regular cells are square in shape but they can be rotated and sheared. Rectilinear and curvilinear shapes are also possible, depending on the spatial region of interest and CRS.</p>
<p><em>Be aware that high resolution raster data involves a large number of small cells. This can slow down the computations and visualizations.</em></p>
<p>Many raster file formats exist. One of the most popular is GeoTIFF (.tif or .tiff). More complex raster formats include NetCDF (.nc) and HDF (.hdf). To work with raster data in R, you’ll use the raster, terra, and the stars packages. If you are interested in learning more, check out <a href="https://r-spatial.github.io/stars/" class="uri">https://r-spatial.github.io/stars/</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop to Reflect
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>If you haven’t yet, check in with your community around you. How could you support their learning?</p>
<p>Share with them an spatial data idea or topic that is confusing/challenging to you and ask them what topic they find most interesting/cool/connects with other courses?</p>
</div>
</div>
</div>
</section>
</section>
<section id="working-with-spatial-data-in-r" class="level2">
<h2 class="anchored" data-anchor-id="working-with-spatial-data-in-r">Working with Spatial Data in R</h2>
<section id="read-in-data-to-r" class="level3">
<h3 class="anchored" data-anchor-id="read-in-data-to-r">Read in data to R</h3>
<p>For each file format, we need use a different function to read in the data. See the examples below for reading in GeoJSON, csv, and shapefiles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in GeoJSON file</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>hex_spatial <span class="ot">&lt;-</span> geojsonio<span class="sc">::</span><span class="fu">geojson_read</span>(<span class="st">"data/us_states_hexgrid.geojson"</span>, <span class="at">what =</span> <span class="st">'sp'</span>) </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in CSV File</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>pop_growth <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">'data/apportionment.csv'</span>) <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Shapefiles</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>mn_cities <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">'data/shp_loc_pop_centers'</span>) <span class="co">#shp file/folder</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>mn_water <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">'data/shp_water_lakes_rivers'</span>) <span class="co">#shp file/folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-classes-in-r" class="level3">
<h3 class="anchored" data-anchor-id="data-classes-in-r">Data classes in R</h3>
<p>When data is read it, an R data object is created of a default class. Notice the classes of the R objects we read in. Also, notice that an object may have multiple classes, which indicate the type of structure it has and how functions may interact with the object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(hex_spatial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SpatialPolygonsDataFrame"
attr(,"package")
[1] "sp"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pop_growth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mn_cities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mn_water)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p><strong>Older R Spatial classes</strong></p>
<p>In the <code>sp</code> package, there are many spatial classes that hold slightly different data. All <code>Spatial*</code> classes have a bounding box (bbox) and a CRS.</p>
<ul>
<li><code>SpatialPoints</code>, <code>SpatialLines</code>, and <code>SpatialPolygons</code> provide structure to hold the basic spatial geometries of points, lines, and polygons.</li>
<li><code>Spatial*DataFrame</code> extends the geometry classes to a data.frame-like object with non-spatial attribute data.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial,<span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class "SpatialPolygonsDataFrame"
Slot "data":
  cartodb_id          created_at          updated_at label bees iso3166_2
1       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
            google_name
1 Maine (United States)

Slot "polygons":
[[1]]
An object of class "Polygons"
Slot "Polygons":
[[1]]
An object of class "Polygon"
Slot "labpt":
[1] -72.62574  53.45575

Slot "area":
[1] 15.28454

Slot "hole":
[1] FALSE

Slot "ringDir":
[1] 1

Slot "coords":
          [,1]     [,2]
[1,] -72.62574 55.31320
[2,] -69.90286 54.40843
[3,] -69.90286 52.53744
[4,] -72.62574 51.57081
[5,] -75.34861 52.53744
[6,] -75.34861 54.40843
[7,] -72.62574 55.31320



Slot "plotOrder":
[1] 1

Slot "labpt":
[1] -72.62574  53.45575

Slot "ID":
[1] "1"

Slot "area":
[1] 15.28454



Slot "plotOrder":
[1] 1

Slot "bbox":
        min       max
x -75.34861 -69.90286
y  51.57081  55.31320

Slot "proj4string":
Coordinate Reference System:
Deprecated Proj.4 representation: +proj=longlat +datum=WGS84 +no_defs 
WKT2 2019 representation:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]] </code></pre>
</div>
</div>
</section>
<section id="exercise-5" class="level3">
<h3 class="anchored" data-anchor-id="exercise-5">Exercise</h3>
<p>Based on the summary of <code>hex_spatial</code>, what are the following:</p>
<ul>
<li>CRS:</li>
<li>BBOX (extent):</li>
<li>Geometry type:</li>
</ul>
<details>
<summary>
Solution
</summary>
<ul>
<li>CRS: EPSG:4326 (+proj=longlat +datum=WGS84 +no_defs)</li>
<li>BBOX: x -113.47 -69.90; y 30.54 55.31</li>
<li>Geometry type: Polygons</li>
</ul>
</details>
<p><strong>Newer R Spatial classes</strong></p>
<p>The community is moving away from using older <code>sp</code> classes to <code>sf</code> classes. It is useful for you to know that the older versions exist but stick with the <code>sf</code> classes.</p>
<ul>
<li><code>sfc</code> objects are modern, general versions of the spatial geometries from the <code>sp</code> package with a bbox, CRS, and many geometries available.</li>
<li><code>sf</code> objects are data.frame-like objects with a geometry column of class <code>sfc</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mn_cities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1081 features and 8 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 190832.6 ymin: 4816672 xmax: 747463.4 ymax: 5468045
Projected CRS: NAD83 / UTM zone 15N
# A tibble: 1,081 × 9
      GNIS Name        CTU_Type County      FIPS_Code Sym_Class Population Notes
     &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;
 1 2393879 Ada         City     Norman Cou… 27107001… County S…       1681 &lt;NA&gt; 
 2 2393881 Adams       City     Mower Coun… 27099001… Small Ci…        742 &lt;NA&gt; 
 3 2393884 Adrian      City     Nobles Cou… 27105002… Small Ci…       1278 &lt;NA&gt; 
 4 2393887 Afton       City     Washington… 27163003… Small Ci…       2932 &lt;NA&gt; 
 5 2393894 Aitkin      City     Aitkin Cou… 27001004… County S…       2279 &lt;NA&gt; 
 6 2393895 Akeley      City     Hubbard Co… 27057004… Small Ci…        397 &lt;NA&gt; 
 7 2393898 Albany      City     Stearns Co… 27145006… Small Ci…       2618 &lt;NA&gt; 
 8 2393902 Albert Lea  City     Freeborn C… 27047006… County S…      17843 &lt;NA&gt; 
 9 2393903 Alberta     City     Stevens Co… 27149006… Small Ci…        122 &lt;NA&gt; 
10 2393904 Albertville City     Wright Cou… 27171007… Small Ci…       7226 &lt;NA&gt; 
# ℹ 1,071 more rows
# ℹ 1 more variable: geometry &lt;POINT [m]&gt;</code></pre>
</div>
</div>
</section>
<section id="exercise-6" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6">Exercise</h3>
<p>Based on the summary of <code>mn_cities</code>, what are the following:</p>
<ul>
<li>CRS:</li>
<li>BBOX:</li>
<li>Geometry type:</li>
</ul>
<details>
<summary>
Solution
</summary>
<ul>
<li>CRS: NAD83 / UTM zone 15N</li>
<li>BBOX: xmin: 190800 ymin: 4817000 xmax: 747500 ymax: 5468000</li>
<li>Geometry type: Points</li>
</ul>
</details>
<p><strong>Data Frames - Fortified Spatial Data</strong></p>
<p>Data.frames or tbl (tibbles) are standard data formats that are not specific to spatial data. Our <code>pop_growth</code> data doesn’t include any coordinate information, so it can be stored simply as a <code>data.frame</code> (<code>tbl</code>, <code>tbl_df</code>, and <code>spec_tbl_df</code> are all sub classes of <code>data.frame</code>).</p>
<p>You may come across <code>data.frames</code> that contain spatial coordinate information, so let’s see what that might look like. We can <code>fortify</code> our <code>sp</code> object to make it a data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Spatial*DataFrame to Data Frame</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_df <span class="ot">&lt;-</span> <span class="fu">fortify</span>(hex_spatial)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(hex_spatial_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
</section>
<section id="exercise-7" class="level3">
<h3 class="anchored" data-anchor-id="exercise-7">Exercise</h3>
<p>What are the variables in <code>hex_spatial_df</code>? Compare the first seven rows with the first spatial polygon of <code>hex_spatial</code>. Now describe the meaning of the variables in <code>hex_spatial_df</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial_df,<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       long      lat order  hole piece id group
1 -72.62574 55.31320     1 FALSE     1  1   1.1
2 -69.90286 54.40843     2 FALSE     1  1   1.1
3 -69.90286 52.53744     3 FALSE     1  1   1.1
4 -72.62574 51.57081     4 FALSE     1  1   1.1
5 -75.34861 52.53744     5 FALSE     1  1   1.1
6 -75.34861 54.40843     6 FALSE     1  1   1.1
7 -72.62574 55.31320     7 FALSE     1  1   1.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>hex_spatial<span class="sc">@</span>polygons[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class "Polygons"
Slot "Polygons":
[[1]]
An object of class "Polygon"
Slot "labpt":
[1] -72.62574  53.45575

Slot "area":
[1] 15.28454

Slot "hole":
[1] FALSE

Slot "ringDir":
[1] 1

Slot "coords":
          [,1]     [,2]
[1,] -72.62574 55.31320
[2,] -69.90286 54.40843
[3,] -69.90286 52.53744
[4,] -72.62574 51.57081
[5,] -75.34861 52.53744
[6,] -75.34861 54.40843
[7,] -72.62574 55.31320



Slot "plotOrder":
[1] 1

Slot "labpt":
[1] -72.62574  53.45575

Slot "ID":
[1] "1"

Slot "area":
[1] 15.28454</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>ANSWER:</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<blockquote class="blockquote">
<p>Variables: long, lat, order, hole, piece, id, group</p>
</blockquote>
<blockquote class="blockquote">
<p><code>long</code> and <code>lat</code> provide the x and y coordinates of the polygon for a particlar region or area <code>id</code>.</p>
</blockquote>
<blockquote class="blockquote">
<p>The <code>order</code> is the order in which you connect the coordinate points to make a polygon.</p>
</blockquote>
<blockquote class="blockquote">
<p><code>hole</code> indicates whether or not it should be included or excluded in the region as a hold.</p>
</blockquote>
<blockquote class="blockquote">
<p><code>piece</code> indicates the number of the polygon for an individual area <code>id</code> this polygon is so that <code>group</code> is <code>id</code>.<code>piece</code>.</p>
</blockquote>
</details>
</section>
<section id="convert-data-class-types" class="level3">
<h3 class="anchored" data-anchor-id="convert-data-class-types">Convert data class types</h3>
<p>We can convert objects between these data classes with the following functions:</p>
<ul>
<li><p><code>fortify(x)</code>: <code>sp</code> object x to <code>data.frame</code></p></li>
<li><p><code>st_as_sf(x )</code>: <code>sp</code> object x to <code>sf</code></p></li>
<li><p><code>st_as_sf(x, coords = c("long", "lat"))</code>: <code>data.frame</code> x to <code>sf</code> as points</p></li>
<li><p>To convert a <code>data.frame</code> with columns of <code>long</code>, <code>lat</code>, and <code>group</code> containing polygon geometry information, you can use:</p></li>
</ul>
<pre><code>st_as_sf(x, coords = c("long", "lat")) %&gt;%
group_by(group) %&gt;%
  summarise(geometry = st_combine(geometry)) %&gt;%
  st_cast("POLYGON")</code></pre>
<p>We won’t often want to convert our data to a <code>Spatial*</code> class from <code>sp</code> package, so we’ll exclude that in this activity.</p>
</section>
<section id="exercise-8" class="level3">
<h3 class="anchored" data-anchor-id="exercise-8">Exercise</h3>
<p>Convert the <code>hex_spatial</code> data to an <code>sf</code> object called <code>hex_spatial_sf</code>. Complete these two ways</p>
<ol type="1">
<li><code>hex_spatial</code> directly to <code>hex_spatial_sf</code> AND</li>
<li><code>hex_spatial_df</code> to <code>hex_spatial_sf</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to SF from hex_spatial_df  </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial_df <span class="sc">%&gt;%</span> ???  </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to SF from hex_spatial</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial <span class="sc">%&gt;%</span> ???</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: &lt;text&gt;:6:0: unexpected end of input
4: # Convert to SF from hex_spatial
5: hex_spatial_sf &lt;- hex_spatial %&gt;% ???
  ^</code></pre>
</div>
</div>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert to SF from hex_spatial_df  </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial_df <span class="sc">%&gt;%</span> <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">geometry =</span> <span class="fu">st_combine</span>(geometry)) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert to SF from hex_spatial</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial <span class="sc">%&gt;%</span> <span class="fu">st_as_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</section>
</section>
</section>
<section id="spatial-maps" class="level1">
<h1>Spatial Maps</h1>
<section id="hexbin-choropleth" class="level2">
<h2 class="anchored" data-anchor-id="hexbin-choropleth">Hexbin Choropleth</h2>
<p>Data Source: <a href="https://r-graph-gallery.com/328-hexbin-map-of-the-usa.html" class="uri">https://r-graph-gallery.com/328-hexbin-map-of-the-usa.html</a></p>
<p>In this example, we’ll create an alternative choropleth map. Instead of using the actual geo-political boundaries, we will use hexagons to represent the U.S. states and maintain their relative directional position to each together. This approach results in each state having the same area in the graphic so that large regions don’t dominate the visual story.</p>
<section id="exercise-9" class="level3">
<h3 class="anchored" data-anchor-id="exercise-9">Exercise</h3>
<p>Describe what the following code chunks are doing. Be sure to consider the class of the data object, what the data object looks like to start, and what it looks like at the end of the chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk A</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_df  <span class="ot">&lt;-</span> hex_spatial_df <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hex_spatial)) , </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="fu">str_replace</span>(hex_spatial<span class="sc">$</span>google_name,<span class="st">' </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)'</span>,<span class="st">''</span>), </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">abbr =</span> hex_spatial<span class="sc">$</span>iso3166_2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk A):</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Chunk A</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial_df) <span class="co">#start with data frame of 357 rows and 7 columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       long      lat order  hole piece id group
1 -72.62574 55.31320     1 FALSE     1  1   1.1
2 -69.90286 54.40843     2 FALSE     1  1   1.1
3 -69.90286 52.53744     3 FALSE     1  1   1.1
4 -72.62574 51.57081     4 FALSE     1  1   1.1
5 -75.34861 52.53744     5 FALSE     1  1   1.1
6 -75.34861 54.40843     6 FALSE     1  1   1.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>hex_spatial_df  <span class="ot">&lt;-</span> hex_spatial_df <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>( <span class="co">#left join, a mutating join, a dataset with information from hex_spatial</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hex_spatial)) , <span class="co">#Create a data frame with variables id (1,2,3...), name (defined as the google_name from hex_spatial after removing "(United States)"), and abbr (the state abbreviation in hex_spatial as variable iso3166_2)</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="fu">str_replace</span>(hex_spatial<span class="sc">$</span>google_name,<span class="st">' </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)'</span>,<span class="st">''</span>), </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">abbr =</span> hex_spatial<span class="sc">$</span>iso3166_2))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial_df) <span class="co">#end with data frame of 357 rows and 9 columns (new: name and abbr)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       long      lat order  hole piece id group  name abbr
1 -72.62574 55.31320     1 FALSE     1  1   1.1 Maine   ME
2 -69.90286 54.40843     2 FALSE     1  1   1.1 Maine   ME
3 -69.90286 52.53744     3 FALSE     1  1   1.1 Maine   ME
4 -72.62574 51.57081     4 FALSE     1  1   1.1 Maine   ME
5 -75.34861 52.53744     5 FALSE     1  1   1.1 Maine   ME
6 -75.34861 54.40843     6 FALSE     1  1   1.1 Maine   ME</code></pre>
</div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Chunk B</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial_sf <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_replace</span>(google_name,<span class="st">' </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)'</span>,<span class="st">''</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">abbr =</span> iso3166_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk B):</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Chunk B</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial_sf) <span class="co">#start with sf object with 51 regions and 7 variables/features</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 7 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -113.4688 ymin: 30.53798 xmax: -69.90286 ymax: 55.3132
Geodetic CRS:  WGS 84
  cartodb_id          created_at          updated_at label bees iso3166_2
1       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
2       1217 2015-05-13 17:24:35 2015-10-05 11:00:16  R.I. 47.8        RI
3       1218 2015-05-13 17:25:00 2015-10-05 11:00:16   Vt. 33.9        VT
4        231 2015-05-13 17:02:22 2015-10-05 11:00:16 Okla. 63.4        OK
5        244 2015-05-13 17:02:22 2015-10-05 11:00:16  N.C. 41.5        NC
6        259 2015-05-13 17:02:22 2015-10-05 11:00:16   Va. 45.6        VA
                     google_name                       geometry
1          Maine (United States) POLYGON ((-72.62574 55.3132...
2   Rhode Island (United States) POLYGON ((-72.62574 49.5743...
3        Vermont (United States) POLYGON ((-80.79436 52.5374...
4       Oklahoma (United States) POLYGON ((-110.746 35.79821...
5 North Carolina (United States) POLYGON ((-91.68585 39.5301...
6       Virginia (United States) POLYGON ((-88.96298 43.0717...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial_sf <span class="sc">%&gt;%</span> <span class="co">#Create new variables: name (defined as the google_name after removing "(United States)"), and abbr (the state abbreviation from variable iso3166_2)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_replace</span>(google_name,<span class="st">' </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)'</span>,<span class="st">''</span>),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">abbr =</span> iso3166_2)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial_sf) <span class="co">#ends with sf object with 51 regions and 9 variables/features</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 9 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -113.4688 ymin: 30.53798 xmax: -69.90286 ymax: 55.3132
Geodetic CRS:  WGS 84
  cartodb_id          created_at          updated_at label bees iso3166_2
1       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
2       1217 2015-05-13 17:24:35 2015-10-05 11:00:16  R.I. 47.8        RI
3       1218 2015-05-13 17:25:00 2015-10-05 11:00:16   Vt. 33.9        VT
4        231 2015-05-13 17:02:22 2015-10-05 11:00:16 Okla. 63.4        OK
5        244 2015-05-13 17:02:22 2015-10-05 11:00:16  N.C. 41.5        NC
6        259 2015-05-13 17:02:22 2015-10-05 11:00:16   Va. 45.6        VA
                     google_name                       geometry           name
1          Maine (United States) POLYGON ((-72.62574 55.3132...          Maine
2   Rhode Island (United States) POLYGON ((-72.62574 49.5743...   Rhode Island
3        Vermont (United States) POLYGON ((-80.79436 52.5374...        Vermont
4       Oklahoma (United States) POLYGON ((-110.746 35.79821...       Oklahoma
5 North Carolina (United States) POLYGON ((-91.68585 39.5301... North Carolina
6       Virginia (United States) POLYGON ((-88.96298 43.0717...       Virginia
  abbr
1   ME
2   RI
3   VT
4   OK
5   NC
6   VA</code></pre>
</div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Chunk C</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>hex_growth_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hex_spatial_df, pop_growth, <span class="at">by =</span> <span class="st">'name'</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>hex_growth_sf <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hex_spatial_sf, pop_growth, <span class="at">by =</span> <span class="st">'name'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk C):</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Chunk C</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>hex_growth_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hex_spatial_df, pop_growth, <span class="at">by =</span> <span class="st">'name'</span>) <span class="co"># add in pop_growth variables to data frame using left join; in the process duplicate the geometry for each region for each year</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_growth_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       long     lat order  hole piece id group  name abbr geography_type year
1 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1910
2 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1920
3 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1930
4 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1940
5 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1950
6 -72.62574 55.3132     1 FALSE     1  1   1.1 Maine   ME          State 1960
  resident_population percent_change_in_resident_population
1              742371                                   6.9
2              768014                                   3.5
3              797423                                   3.8
4              847226                                   6.2
5              913774                                   7.9
6              969265                                   6.1
  resident_population_density resident_population_density_rank
1                        24.1                               33
2                        24.9                               34
3                        25.9                               36
4                        27.5                               36
5                        29.6                               37
6                        31.4                               38
  number_of_representatives change_in_number_of_representatives
1                         4                                   0
2                         4                                   0
3                         3                                  -1
4                         3                                   0
5                         3                                   0
6                         2                                  -1
  average_apportionment_population_per_representative
1                                              185593
2                                              192004
3                                              265806
4                                              282409
5                                              304591
6                                              484633</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(hex_growth_df) <span class="co">#end with data frame of 4284 rows and 18 variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4284   18</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>hex_growth_sf <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hex_spatial_sf, pop_growth, <span class="at">by =</span> <span class="st">'name'</span>) <span class="co"># add in pop_growth variables to sf object using left join; in the process duplicate the geometry for each region for each year </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_growth_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 18 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -75.34861 ymin: 51.57081 xmax: -69.90286 ymax: 55.3132
Geodetic CRS:  WGS 84
  cartodb_id          created_at          updated_at label bees iso3166_2
1       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
2       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
3       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
4       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
5       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
6       1219 2015-05-13 17:26:15 2015-10-05 11:00:16 Maine 60.5        ME
            google_name  name abbr geography_type year resident_population
1 Maine (United States) Maine   ME          State 1910              742371
2 Maine (United States) Maine   ME          State 1920              768014
3 Maine (United States) Maine   ME          State 1930              797423
4 Maine (United States) Maine   ME          State 1940              847226
5 Maine (United States) Maine   ME          State 1950              913774
6 Maine (United States) Maine   ME          State 1960              969265
  percent_change_in_resident_population resident_population_density
1                                   6.9                        24.1
2                                   3.5                        24.9
3                                   3.8                        25.9
4                                   6.2                        27.5
5                                   7.9                        29.6
6                                   6.1                        31.4
  resident_population_density_rank number_of_representatives
1                               33                         4
2                               34                         4
3                               36                         3
4                               36                         3
5                               37                         3
6                               38                         2
  change_in_number_of_representatives
1                                   0
2                                   0
3                                  -1
4                                   0
5                                   0
6                                  -1
  average_apportionment_population_per_representative
1                                              185593
2                                              192004
3                                              265806
4                                              282409
5                                              304591
6                                              484633
                        geometry
1 POLYGON ((-72.62574 55.3132...
2 POLYGON ((-72.62574 55.3132...
3 POLYGON ((-72.62574 55.3132...
4 POLYGON ((-72.62574 55.3132...
5 POLYGON ((-72.62574 55.3132...
6 POLYGON ((-72.62574 55.3132...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(hex_growth_sf) <span class="co">#end with sf object of 612 region/year combinations and 19 variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 612  19</code></pre>
</div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk D</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>centers <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rgeos<span class="sc">::</span><span class="fu">gCentroid</span>(hex_spatial,<span class="at">byid =</span> <span class="cn">TRUE</span>), </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">abbr =</span> hex_spatial<span class="sc">$</span>iso3166_2)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>hex_growth_df <span class="sc">%&gt;%</span> </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">group =</span> group, <span class="at">fill =</span> percent_change_in_resident_population)) <span class="sc">+</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> centers, <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> abbr), <span class="at">color =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span> </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk D):</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk D</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>centers <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rgeos<span class="sc">::</span><span class="fu">gCentroid</span>(hex_spatial,<span class="at">byid =</span> <span class="cn">TRUE</span>), <span class="co"># Create data frame of the center of each region and the state abbreviation</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">abbr =</span> hex_spatial<span class="sc">$</span>iso3166_2)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>hex_growth_df <span class="sc">%&gt;%</span> </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> <span class="co"># focus only on the data from 2020</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span> <span class="co"># create frame of longitude and latitude</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">group =</span> group, <span class="at">fill =</span> percent_change_in_resident_population)) <span class="sc">+</span>  <span class="co"># add hex polygons defined by x and y but grouped according to group and color filled by the percent_change in resident population</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> centers, <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> abbr), <span class="at">color =</span> <span class="st">'white'</span>) <span class="sc">+</span> <span class="co"># add text at the centers of the polygons and add text labels from the abbr variable in the centers data we created</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span>  <span class="co"># change legend label</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>) <span class="co"># remove the background theme and move the legend to the bottom right</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk E</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>hex_growth_sf <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> percent_change_in_resident_population)) <span class="sc">+</span> </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>( <span class="fu">aes</span>(<span class="at">label =</span> abbr), <span class="at">color =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span> </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk E):</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk E</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>hex_growth_sf <span class="sc">%&gt;%</span>  <span class="co"># start with sf object</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span> <span class="co">#filter to focus on data from 2020</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> percent_change_in_resident_population)) <span class="sc">+</span> <span class="co"># plot the sf geometry (polygons) and fill color according to percent change in population</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>( <span class="fu">aes</span>(<span class="at">label =</span> abbr), <span class="at">color =</span> <span class="st">'white'</span>) <span class="sc">+</span> <span class="co"># add text labels to the sf geometry regions using abbr for the text</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span> <span class="co"># Change legend label</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>) <span class="co"># remove the background theme and move the legend to the bottom right </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</details>
</section>
<section id="exercise-10" class="level3">
<h3 class="anchored" data-anchor-id="exercise-10">Exercise</h3>
<p>Using the hexbin spatial boundaires and the <code>pop_growth</code> data, make the following updates to the choropleth graphic:</p>
<ul>
<li>Change the outcome variable (different year or variable).</li>
<li>Change the fill scale to be more meaningful and effective.</li>
<li>Make one more update beyond the fill color to improve the effectiveness of the graphic.</li>
</ul>
<p>Make the graphic twice, once with <code>geom_polygon()</code> and once with <code>geom_sf()</code>.</p>
</section>
<section id="bonus-challenge" class="level3">
<h3 class="anchored" data-anchor-id="bonus-challenge">Bonus Challenge</h3>
<p>Find external state-level data online, read it into R, join it, and create a U.S. state hexbin map displaying that new state-level outcome.</p>
</section>
</section>
<section id="mn-citycounty-example" class="level2">
<h2 class="anchored" data-anchor-id="mn-citycounty-example">MN City/County example</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stop to Reflect
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>When looking through cod examples, notice familiar functions and syntax patterns. Also, notice new functions and try figure out what they are doing. Add comments to code so that you can come back to examples when you need them.</p>
</div>
</div>
</div>
<section id="unify-crs" class="level3">
<h3 class="anchored" data-anchor-id="unify-crs">Unify CRS</h3>
<p>To demonstrate other spatial geometries beyond polygons (the hexagons in the last example were spatial polygons), we’ll walk through create a map of MN with different layers of information (city point locations, county polygon boundaries, rivers as lines and polygons, and a raster elevation map). To add all of this information on one map, we need to ensure that the CRS is the same for all spatial datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check CRS</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_cities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD83 / UTM zone 15N 
  wkt:
PROJCRS["NAD83 / UTM zone 15N",
    BASEGEOGCRS["NAD83",
        DATUM["North American Datum 1983",
            ELLIPSOID["GRS 1980",6378137,298.257222101,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4269]],
    CONVERSION["UTM zone 15N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-93,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",26915]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check CRS</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_water)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD83 / UTM zone 15N 
  wkt:
PROJCRS["NAD83 / UTM zone 15N",
    BASEGEOGCRS["NAD83",
        DATUM["North American Datum 1983",
            ELLIPSOID["GRS 1980",6378137,298.257222101,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4269]],
    CONVERSION["UTM zone 15N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-93,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",26915]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#transform CRS of water to the same of the cities</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>mn_water <span class="ot">&lt;-</span> mn_water <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(mn_cities))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load country boundaries data as sf object</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>mn_counties <span class="ot">&lt;-</span> <span class="fu">us_counties</span>(<span class="at">resolution =</span> <span class="st">"high"</span>, <span class="at">states =</span> <span class="st">"Minnesota"</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">#remove duplicate column names</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>names_counties <span class="ot">&lt;-</span> <span class="fu">names</span>(mn_counties)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mn_counties)[names_counties <span class="sc">==</span> <span class="st">'state_name'</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"state_name1"</span>, <span class="st">"state_name2"</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co">#check CRS</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the CRS of county data to the more local CRS of the cities</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>mn_counties <span class="ot">&lt;-</span> mn_counties <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(mn_cities))</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD83 / UTM zone 15N 
  wkt:
PROJCRS["NAD83 / UTM zone 15N",
    BASEGEOGCRS["NAD83",
        DATUM["North American Datum 1983",
            ELLIPSOID["GRS 1980",6378137,298.257222101,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4269]],
    CONVERSION["UTM zone 15N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-93,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    ID["EPSG",26915]]</code></pre>
</div>
</div>
</section>
<section id="initial-map-counties-and-cities" class="level3">
<h3 class="anchored" data-anchor-id="initial-map-counties-and-cities">Initial Map: Counties and Cities</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="co">#plot frame</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="co">#county boundary layer</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="co">#city point layer</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="st">'wheat'</span>, <span class="at">color =</span> <span class="st">"tan"</span>) <span class="sc">+</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Population <span class="sc">&gt;=</span> <span class="dv">10000</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Population,<span class="at">size =</span> Population), <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span> <span class="co">#cities layer</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span> <span class="co">#continuous (gradient) color scale</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Minnesota Cities with Population &gt;= 10,000"</span>) <span class="sc">+</span> </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co">#move legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="updated-map-counties-and-cities-plus-elevation" class="level3">
<h3 class="anchored" data-anchor-id="updated-map-counties-and-cities-plus-elevation">Updated Map: Counties and Cities plus Elevation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>elevation <span class="ot">&lt;-</span> elevatr<span class="sc">::</span><span class="fu">get_elev_raster</span>(mn_counties, <span class="at">z =</span> <span class="dv">5</span>, <span class="at">clip =</span> <span class="st">'bbox'</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">crs</span>(elevation) <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(mn_counties)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert to Data Frame for plotting</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>elev_df <span class="ot">&lt;-</span> elevation <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(elev_df) <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">'x'</span>,<span class="st">'y'</span>,<span class="st">'value'</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> elev_df, <span class="fu">aes</span>(<span class="at">x =</span> x,<span class="at">y =</span> y,<span class="at">fill =</span> value)) <span class="sc">+</span> <span class="co"># adding the elevation as first (bottom) layer</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Population <span class="sc">&gt;=</span> <span class="dv">10000</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Population,<span class="at">size =</span> Population), <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span> <span class="co">#cities layer</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span> <span class="co">#continuous (gradient) color scale</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">'darkgreen'</span>,<span class="at">high =</span> <span class="st">'white'</span>, <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Minnesota Cities with Population &gt;= 10,000"</span>) <span class="sc">+</span> </span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co">#move legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="zoom-to-twin-cities-map" class="level3">
<h3 class="anchored" data-anchor-id="zoom-to-twin-cities-map">Zoom to Twin Cities Map</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>Seven_countyarea <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(mn_counties <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Anoka"</span>, <span class="st">"Hennepin"</span>, <span class="st">"Ramsey"</span>, <span class="st">"Dakota"</span>, <span class="st">"Carver"</span>, <span class="st">"Washington"</span>, <span class="st">"Scott"</span>)))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>elevation <span class="ot">&lt;-</span> elevatr<span class="sc">::</span><span class="fu">get_elev_raster</span>(mn_counties <span class="sc">%&gt;%</span> <span class="fu">st_crop</span>(Seven_countyarea), <span class="at">z =</span> <span class="dv">9</span>, <span class="at">clip =</span> <span class="st">'bbox'</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">crs</span>(elevation) <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(mn_counties)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert to Data Frame for plotting</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>elev_df <span class="ot">&lt;-</span> elevation <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(elev_df) <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">'x'</span>,<span class="st">'y'</span>,<span class="st">'value'</span>)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> elev_df, <span class="fu">aes</span>(<span class="at">x =</span> x,<span class="at">y =</span> y,<span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="co"># county boundary layer</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_water, <span class="at">fill =</span> <span class="st">'lightsteelblue1'</span>,<span class="at">color =</span> <span class="st">'lightsteelblue1'</span>) <span class="sc">+</span> <span class="co"># added a river/lake layer</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Population <span class="sc">&gt;=</span> <span class="dv">10000</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Population,<span class="at">size =</span> Population)) <span class="sc">+</span> <span class="co">#cities layer</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> Seven_countyarea[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)],<span class="at">ylim =</span> Seven_countyarea[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)]) <span class="sc">+</span> <span class="co"># crop map to coordinates of seven county area</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">'magma'</span>) <span class="sc">+</span> <span class="co">#continuous (gradient) color scale</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">'darkgreen'</span>,<span class="at">high =</span> <span class="st">'white'</span>) <span class="sc">+</span> <span class="co">#continuous (gradient) fill scale</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Twin Cities with Population &gt;= 10,000"</span>) <span class="sc">+</span> </span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  <span class="co">#remove legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-adv-maps_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="twin-cities-leaflet" class="level3">
<h3 class="anchored" data-anchor-id="twin-cities-leaflet">Twin Cities Leaflet</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>mn_counties_leaf <span class="ot">&lt;-</span> mn_counties <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="dv">4326</span>) <span class="co">#Leaflet expects this CRS for vectors</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>mn_cities_leaf <span class="ot">&lt;-</span> mn_cities <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="dv">4326</span>) <span class="co">#Leaflet expects this CRS for vectors</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>Cities_per_County <span class="ot">&lt;-</span> <span class="fu">st_join</span>(mn_cities_leaf, mn_counties_leaf) <span class="sc">%&gt;%</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> <span class="co">#removes geometry - makes the following calculation more efficient </span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(name) </span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>mn_counties_leaf <span class="sc">%&gt;%</span> </span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Anoka"</span>, <span class="st">"Hennepin"</span>, <span class="st">"Ramsey"</span>, <span class="st">"Dakota"</span>, <span class="st">"Carver"</span>, <span class="st">"Washington"</span>, <span class="st">"Scott"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Cities_per_County) <span class="sc">%&gt;%</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"CartoDB.Positron"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolygons</span>(<span class="at">color =</span> <span class="st">"#444444"</span>, <span class="at">weight =</span> <span class="dv">1</span>, <span class="at">smoothFactor =</span> <span class="fl">0.5</span>,</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="fl">1.0</span>, <span class="at">fillOpacity =</span> <span class="fl">0.5</span>, <span class="at">fillColor =</span> <span class="sc">~</span><span class="fu">colorQuantile</span>(<span class="st">"YlOrRd"</span>, n)(n), <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">bringToFront =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircles</span>(<span class="at">data =</span> mn_cities_leaf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(County <span class="sc">%in%</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">"Anoka"</span>, <span class="st">"Hennepin"</span>, <span class="st">"Ramsey"</span>, <span class="st">"Dakota"</span>, <span class="st">"Carver"</span>, <span class="st">"Washington"</span>, <span class="st">"Scott"</span>),<span class="st">'County'</span>)), <span class="at">color =</span> <span class="st">"#444444"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a6fbf6a1969247e2c214" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a6fbf6a1969247e2c214">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolygons","args":[[[[{"lng":[-93.911401,-93.91024,-93.90673700000001,-93.902861,-93.900374,-93.898619,-93.89855799999999,-93.89948699999999,-93.898617,-93.896665,-93.89259800000001,-93.891649,-93.891097,-93.891677,-93.893508,-93.895613,-93.899489,-93.90029800000001,-93.899123,-93.89787200000001,-93.894728,-93.891356,-93.891066,-93.892882,-93.89565899999999,-93.897719,-93.90042,-93.901366,-93.900907,-93.898869,-93.89512499999999,-93.894291,-93.895644,-93.894988,-93.892791,-93.89271400000001,-93.895702,-93.897689,-93.90034799999999,-93.901888,-93.902828,-93.900947,-93.897346,-93.89473700000001,-93.891755,-93.89146100000001,-93.889664,-93.887495,-93.884657,-93.882384,-93.881789,-93.88230799999999,-93.88076700000001,-93.87718099999999,-93.87623499999999,-93.876586,-93.87812700000001,-93.87789800000002,-93.875243,-93.87263400000001,-93.87268,-93.87144300000001,-93.868921,-93.86502500000002,-93.861318,-93.86051500000001,-93.86001899999999,-93.857263,-93.855693,-93.854055,-93.85388399999999,-93.85517299999999,-93.858358,-93.85844900000001,-93.85767800000001,-93.85049100000001,-93.848508,-93.842983,-93.841249,-93.842467,-93.845366,-93.84604299999999,-93.844443,-93.84090999999999,-93.839206,-93.838224,-93.836536,-93.83203,-93.817995,-93.815516,-93.814666,-93.80845600000001,-93.80312000000001,-93.79901100000001,-93.794619,-93.79294300000001,-93.792433,-93.790874,-93.787925,-93.782731,-93.778728,-93.77652999999999,-93.77415000000001,-93.77238,-93.772105,-93.773523,-93.77245600000001,-93.768691,-93.76573399999999,-93.763662,-93.76679300000001,-93.772507,-93.768039,-93.76356800000001,-93.762332,-93.76142,-93.75832600000001,-93.755735,-93.755366,-93.759013,-93.76000500000002,-93.75995500000001,-93.75714600000001,-93.75530500000001,-93.747339,-93.73774100000001,-93.73021799999999,-93.728983,-93.727934,-93.725461,-93.722067,-93.72080400000002,-93.715401,-93.715282,-93.71923800000002,-93.72127,-93.720913,-93.71913000000001,-93.71511099999999,-93.71086099999999,-93.70672999999999,-93.70159200000001,-93.698273,-93.68879100000001,-93.68427200000001,-93.679896,-93.67894,-93.67808100000001,-93.67763600000001,-93.674949,-93.672004,-93.66796100000001,-93.662162,-93.659904,-93.65825599999999,-93.65733900000001,-93.655835,-93.653372,-93.65154099999999,-93.650656,-93.64913,-93.643764,-93.642267,-93.639433,-93.635936,-93.630994,-93.63009599999999,-93.62962,-93.626913,-93.62312799999999,-93.61814099999999,-93.618708,-93.62264,-93.62523400000001,-93.62651700000001,-93.626735,-93.62465400000001,-93.62615099999999,-93.62916199999999,-93.632132,-93.63271400000001,-93.632677,-93.631218,-93.62894300000001,-93.62890899999999,-93.631542,-93.630334,-93.62403,-93.622432,-93.62153499999999,-93.62151799999999,-93.61895199999999,-93.616671,-93.614321,-93.611834,-93.60983400000001,-93.60862,-93.60976700000001,-93.61283400000002,-93.617097,-93.621967,-93.622214,-93.621735,-93.61573,-93.61373399999999,-93.60703400000001,-93.601034,-93.595634,-93.594234,-93.595493,-93.59961300000001,-93.599143,-93.597894,-93.589934,-93.581721,-93.58125,-93.580499,-93.57866300000001,-93.573733,-93.566079,-93.563337,-93.555829,-93.553119,-93.55118299999999,-93.547316,-93.54356900000001,-93.540735,-93.540458,-93.530907,-93.52045,-93.520325,-93.518711,-93.513148,-93.511197,-93.50878400000001,-93.506308,-93.50517499999999,-93.503092,-93.501125,-93.499005,-93.49634,-93.49289899999999,-93.490549,-93.484736,-93.482974,-93.48229600000001,-93.481199,-93.48024599999999,-93.475712,-93.474035,-93.463207,-93.460829,-93.45792899999999,-93.455254,-93.450328,-93.4443,-93.442223,-93.440901,-93.439243,-93.429562,-93.419628,-93.41562800000001,-93.411784,-93.40591600000002,-93.403115,-93.398584,-93.39640799999999,-93.39100999999999,-93.387626,-93.385716,-93.384826,-93.38369,-93.380848,-93.38031700000002,-93.37765,-93.373801,-93.366208,-93.364949,-93.36331800000001,-93.358671,-93.3554,-93.354828,-93.351882,-93.35182500000001,-93.349917,-93.346902,-93.34484999999999,-93.339382,-93.33674499999999,-93.33505000000001,-93.329615,-93.329666,-93.329668,-93.32873499999999,-93.32872200000001,-93.328727,-93.32865200000001,-93.32852800000001,-93.328479,-93.328401,-93.323443,-93.318157,-93.31820399999999,-93.318212,-93.31824,-93.318371,-93.318353,-93.318353,-93.318556,-93.31870700000002,-93.308606,-93.27816900000001,-93.27806900000002,-93.27847300000001,-93.281521,-93.30090300000001,-93.312927,-93.314007,-93.325202,-93.326027,-93.34983699999999,-93.357704,-93.368089,-93.400469,-93.4027,-93.42266100000001,-93.442301,-93.443287,-93.52252799999999,-93.52432700000001,-93.540908,-93.54443999999999,-93.549368,-93.552114,-93.553037,-93.56147199999999,-93.573392,-93.584114,-93.58615000000002,-93.59792400000001,-93.602304,-93.625544,-93.64576200000002,-93.647037,-93.696691,-93.711679,-93.72837800000001,-93.76828800000001,-93.776053,-93.788315,-93.839197,-93.84968000000001,-93.910405,-93.911401],"lat":[44.54564400000002,44.548005,44.551088,44.552331,44.552018,44.55003499999999,44.54841,44.545474,44.54469,44.54469499999999,44.54562599999999,44.546191,44.548875,44.55221700000001,44.55368199999999,44.55436799999998,44.554475,44.55541300000001,44.55959399999999,44.562051,44.564454,44.565652,44.56659100000001,44.56862799999999,44.56962699999999,44.569207,44.569421,44.57088599999999,44.57209299999999,44.573342,44.574542,44.577901,44.58007899999999,44.58143,44.58362699999999,44.584985,44.58697899999999,44.58728899999998,44.58558,44.58555099999999,44.587065,44.588615,44.589269,44.59202500000001,44.594378,44.595979,44.59669999999998,44.595437,44.595063,44.596215,44.59799300000002,44.600343,44.600915,44.60028199999999,44.60138100000001,44.60305099999999,44.604356,44.60572200000001,44.606663,44.60621799999998,44.604501,44.602863,44.602443,44.604285,44.605418,44.60619799999998,44.609196,44.611614,44.614697,44.617139,44.618241,44.61921,44.61977,44.620754,44.62109499999998,44.62200600000001,44.62179299999999,44.617614,44.618565,44.62053800000001,44.62240000000001,44.624963,44.625663,44.624452,44.622319,44.61940899999999,44.618479,44.62165899999999,44.62901899999999,44.63298499999999,44.63331600000001,44.63329199999999,44.634638,44.63490999999999,44.633765,44.632395,44.63008399999999,44.62858899999999,44.63032900000001,44.63155200000001,44.63386700000001,44.63661299999999,44.637826,44.636422,44.634439,44.630849,44.63028800000001,44.631452,44.633218,44.63414600000001,44.63827399999999,44.63882900000001,44.64030300000001,44.63910099999999,44.637788,44.63498799999999,44.63458399999999,44.63490699999998,44.637483,44.639962,44.64116,44.64341099999999,44.64413800000001,44.64354900000001,44.645263,44.64617999999999,44.65308499999999,44.65613699999999,44.656364,44.65554600000001,44.654741,44.65488499999999,44.65736500000001,44.658688,44.66068499999999,44.662882,44.663952,44.66521699999999,44.66692399999999,44.66821,44.66860699999999,44.668595,44.66944599999999,44.677657,44.68278800000002,44.685815,44.68689,44.688001,44.691162,44.69265,44.69336,44.69525899999999,44.69637300000001,44.695542,44.693413,44.690994,44.68996199999999,44.69047599999999,44.69191800000001,44.694603,44.695046,44.692678,44.69279599999999,44.693292,44.69742900000001,44.69739000000001,44.69829,44.70131099999998,44.702398,44.705216,44.70709600000001,44.708524,44.711427,44.71406199999999,44.716042,44.718462,44.72386199999998,44.724355,44.723354,44.723534,44.724068,44.725844,44.728209,44.730209,44.73277299999999,44.738055,44.73951999999999,44.744766,44.74718099999999,44.74996199999999,44.753411,44.753154,44.75151799999999,44.74886500000001,44.74996199999999,44.752062,44.754203,44.755689,44.757362,44.75887099999999,44.76028099999999,44.761008,44.762862,44.76647799999999,44.767062,44.767562,44.769362,44.773762,44.77621499999999,44.77803999999999,44.780713,44.782715,44.782942,44.78366199999999,44.78250299999998,44.790819,44.79303399999999,44.794373,44.795762,44.79642400000001,44.796942,44.799561,44.79903,44.797369,44.795595,44.796963,44.79900000000001,44.804766,44.80489,44.805024,44.80197399999999,44.80262399999999,44.80461300000001,44.80496999999999,44.80497,44.80459399999999,44.80442199999999,44.804832,44.808831,44.810006,44.809167,44.804424,44.80451699999999,44.80744599999999,44.80738299999999,44.806225,44.804577,44.80425699999999,44.80434000000001,44.804907,44.806628,44.80596299999999,44.80336299999999,44.803186,44.803476,44.80539,44.807782,44.81212600000001,44.812944,44.809618,44.806863,44.80767199999999,44.80687399999999,44.804686,44.80278499999999,44.798527,44.79695700000001,44.79843,44.798463,44.7978,44.796963,44.792807,44.78569100000001,44.78538500000001,44.78548200000001,44.786599,44.78890100000001,44.789131,44.78887100000001,44.785913,44.785595,44.78578599999999,44.78989300000001,44.79006399999999,44.79133700000001,44.791041,44.78904299999999,44.786622,44.786386,44.786986,44.79108599999999,44.77948300000001,44.77844199999999,44.775823,44.76792500000001,44.75837,44.74642899999999,44.735703,44.73220000000001,44.71752900000001,44.71755499999999,44.717536,44.705978,44.702739,44.68840599999999,44.68794700000001,44.68136199999999,44.681286,44.65209099999999,44.63057800000001,44.63064199999999,44.630751,44.59459699999999,44.543957,44.543957,44.543991,44.543995,44.54386700000001,44.543871,44.54399899999999,44.54407,44.544006,44.543958,44.543818,44.543812,44.543781,44.543813,44.543835,44.54362799999998,44.543618,44.54355899999999,44.543559,44.543541,44.543542,44.54354499999999,44.54356,44.54357199999999,44.54361000000001,44.543611,44.54374399999999,44.543749,44.543818,44.54389700000001,44.54389700000001,44.543631,44.543437,44.54328,44.54323300000001,44.543241,44.543245,44.543091,44.543139,44.54316300000001,44.54564400000002]}]],[[{"lng":[-93.021395,-93.020352,-93.018382,-93.015473,-93.00711,-93.00510300000001,-93.004711,-93.005709,-93.011059,-93.011875,-93.011791,-93.01121500000001,-93.01003200000001,-93.00868,-93.008641,-93.00856400000001,-93.00842799999999,-93.00914,-93.010076,-93.01153100000001,-93.01263899999999,-93.01596600000001,-93.01604399999999,-93.01646599999999,-93.020044,-93.006773,-93.004424,-92.98419199999999,-92.98421,-92.984399,-92.984396,-92.98439399999999,-92.984441,-92.984459,-92.984459,-92.98450200000001,-92.98459700000001,-92.984561,-92.98466000000001,-92.984663,-92.984735,-92.98483299999999,-92.984763,-92.984706,-92.984703,-92.98470500000001,-92.984696,-92.984702,-92.98473799999999,-92.98474400000001,-92.98474400000001,-92.98474899999999,-92.98477699999999,-92.98476900000001,-92.98476599999999,-92.98477699999999,-92.984784,-92.984791,-92.98478900000001,-92.98478799999999,-92.984786,-92.98477100000001,-92.984758,-92.984763,-92.98476700000002,-92.98476700000002,-92.984763,-92.984803,-92.98482199999999,-92.984712,-92.984517,-92.984517,-92.984523,-92.984537,-92.984549,-92.984619,-92.989277,-93.00303700000001,-93.003849,-93.015525,-93.020518,-93.020404,-93.020421,-93.020308,-93.020212,-93.020112,-93.020106,-93.02006900000001,-93.019747,-93.019745,-93.019409,-93.019442,-93.01951099999999,-93.01956000000001,-93.019487,-93.01944,-93.002844,-92.98678200000001,-92.972013,-92.940871,-92.937427,-92.927324,-92.896838,-92.89290200000001,-92.825491,-92.815217,-92.814876,-92.80270400000001,-92.79471599999999,-92.745683,-92.74557465605891,-92.75081900000001,-92.75870999999999,-92.76101300000001,-92.76186800000001,-92.76186800000001,-92.760615,-92.758022,-92.752666,-92.75219106187841,-92.751659,-92.75170900000001,-92.7527810148657,-92.755199,-92.75890699999999,-92.760249,-92.757503,-92.757456,-92.75573199999999,-92.75393099999999,-92.75219199999999,-92.75170799999999,-92.7524096109935,-92.754008,-92.758008,-92.762108,-92.763908,-92.766932,-92.76740800000002,-92.76680800000001,-92.764872,-92.75739371476701,-92.752404,-92.75254200000001,-92.7547950068826,-92.756907,-92.757775,-92.757707,-92.75680699999999,-92.749427,-92.745694,-92.74566225357781,-92.7456602329204,-92.742925,-92.740611,-92.73952800000001,-92.73958399999999,-92.740509,-92.744938,-92.74674900000001,-92.75438699999999,-92.765602,-92.77401,-92.78471699593651,-92.791528,-92.7920208157134,-92.7922393698512,-92.7923099586037,-92.80085099999999,-92.80216299999999,-92.80291099999999,-92.803079,-92.8026220783989,-92.80205599999999,-92.80172249781501,-92.80170740226011,-92.79708100000002,-92.793282,-92.78791,-92.78633959047509,-92.78497505129489,-92.77881499999999,-92.77036200000001,-92.7647513581565,-92.76460400000001,-92.76206000000001,-92.761904,-92.762533,-92.7639894689741,-92.7674876022093,-92.768118,-92.7699977456939,-92.771231,-92.77083399999999,-92.7703223860245,-92.769049,-92.770346,-92.7703172883453,-92.770304,-92.7703010845831,-92.7697117600117,-92.76944500000002,-92.768545,-92.767218,-92.760701,-92.75927464412641,-92.7547308063032,-92.754603,-92.75330571365549,-92.7527173574593,-92.75080199999999,-92.75064500000001,-92.7523488197794,-92.75559183382251,-92.75755700000001,-92.75870100000002,-92.759556,-92.761341,-92.76472673099811,-92.7678473240376,-92.77310300000001,-92.774022,-92.77457099999999,-92.77490700000001,-92.773946,-92.769603,-92.764133,-92.763402,-92.763706,-92.76710199999999,-92.769102,-92.76909263335349,-92.7690904794773,-92.768574,-92.765278,-92.765278,-92.766102,-92.769367,-92.769745889795,-92.772266,-92.77266299999999,-92.771902,-92.77266299999999,-92.78043,-92.781498,-92.782963,-92.785206,-92.788776,-92.79603899999999,-92.800313,-92.80528700000001,-92.8061185426902,-92.807362,-92.80798799999999,-92.807317,-92.80455049202349,-92.804035,-92.80361198571811,-92.802875,-92.8025794058107,-92.808088,-92.812634,-92.82518399999999,-92.82654700000002,-92.829341,-92.836037,-92.84774899999999,-92.849934,-92.852896,-92.8553,-92.860923,-92.86661800000002,-92.872642,-92.87859,-92.882559,-92.883826,-92.886252,-92.892027,-92.89811899999999,-92.905102,-92.91331599999999,-92.919966,-92.925359,-92.928629,-92.93204000000001,-92.934989,-92.937473,-92.939733,-92.954078,-92.963848,-92.97479900000002,-92.981317,-92.98607100000001,-92.99155,-92.994771,-93.00072900000001,-93.005978,-93.01293200000001,-93.01596100000002,-93.017869,-93.019718,-93.02152100000001,-93.021395],"lat":[44.789707,44.794229,44.79849699999999,44.802625,44.81198799999999,44.813505,44.814873,44.81818,44.83354,44.836716,44.83737899999999,44.84190599999999,44.84598899999999,44.85204299999999,44.85307899999999,44.855157,44.858711,44.86184599999999,44.863787,44.866928,44.86910199999999,44.88282499999999,44.883133,44.884611,44.89074999999999,44.89076499999999,44.890767,44.89081400000001,44.89459399999998,44.91078599999999,44.911812,44.912521,44.919568,44.92790699999999,44.92802399999999,44.941422,44.94497400000001,44.94553400000001,44.948522,44.94899299999999,44.96325199999998,44.970473,44.97567600000001,44.97775599999999,44.98138700000001,44.98760499999999,44.992273,44.999563,45.00673499999999,45.00946499999999,45.010361,45.01397699999999,45.020009,45.021184,45.02931199999999,45.031818,45.03306599999999,45.034049,45.03541100000001,45.03578399999999,45.036495,45.05024299999999,45.05252999999999,45.053916,45.05747499999999,45.057592,45.05972,45.064736,45.06588499999999,45.075372,45.09665499999999,45.096734,45.097199,45.103049,45.115937,45.123622,45.12375999999999,45.123754,45.12375300000001,45.123796,45.12386599999999,45.13559700000002,45.144053,45.164118,45.174266,45.182081,45.182301,45.18387599999998,45.21074099999999,45.21089499999999,45.23389300000001,45.25092699999999,45.25808399999999,45.26865600000001,45.286403,45.296929,45.29686899999999,45.29681699999999,45.29666999999999,45.296446,45.296403,45.29627900000001,45.29625599999999,45.29621199999998,45.296336,45.29633200000001,45.29633,45.296231,45.296243,45.296042,45.2958435794944,45.29298,45.29096499999999,45.28902799999999,45.287013,45.284938,45.27882699999999,45.274822,45.269565,45.26784116798959,45.26590999999999,45.26166599999999,45.26015074231159,45.25673299999999,45.253407,45.24959999999999,45.238308,45.23052599999999,45.22594899999999,45.222905,45.22105099999999,45.21866599999999,45.21686621527751,45.21276599999999,45.209566,45.20716599999999,45.204866,45.195111,45.19016599999999,45.185466,45.18281199999999,45.17747619430279,45.17391599999999,45.17177199999999,45.16836229473848,45.165166,45.16051899999998,45.155466,45.15186599999999,45.13811699999999,45.12311200000001,45.12307538097781,45.1230730501798,45.119918,45.11845399999999,45.11651500000001,45.115598,45.11339600000001,45.10830899999999,45.107051,45.103146,45.09573000000001,45.089138,45.08333710386841,45.079647,45.0791094116909,45.0788710017819,45.07879399999999,45.06947699999999,45.06755499999999,45.065403,45.060978,45.05939016393749,45.057423,45.05696883370779,45.0569482764446,45.050648,45.047178,45.043516,45.04279269648161,45.0421642132902,45.03932699999999,45.033803,45.0288958808052,45.02876699999999,45.02432000000001,45.022467,45.02055099999999,45.0175686939682,45.0104058198988,45.009115,45.004443110365,45.001378,44.994131,44.9924296327403,44.988195,44.98332700000002,44.9803464568039,44.978967,44.97894386333329,44.974267,44.97214999999999,44.969839,44.96808399999998,44.964979,44.9628242623307,44.9559600717719,44.95576699999999,44.95092052115459,44.94872250537301,44.941567,44.937299,44.930869003046,44.9186302846844,44.91121400000001,44.908979,44.907857,44.90690399999998,44.9053101560503,44.9038411266625,44.901367,44.90008300000001,44.898084,44.89279699999999,44.88999699999999,44.88296699999999,44.875905,44.87416699999999,44.872129,44.866767,44.862167,44.8620286468251,44.86199683227889,44.854368,44.84106999999999,44.837186,44.83496599999999,44.83179999999999,44.8313093645083,44.82804600000001,44.82633700000002,44.823067,44.821424,44.81258900000001,44.80940799999999,44.79813100000001,44.792303,44.78779399999999,44.782056,44.777379,44.76836099999999,44.76457317276709,44.758909,44.75147,44.75036399999999,44.74873629527649,44.74843300000001,44.74785463736969,44.74684700000001,44.7457971094334,44.74701,44.74725200000001,44.75024299999999,44.750429,44.75001,44.747368,44.746636,44.74652399999999,44.747151,44.74771499999999,44.755765,44.76028399999998,44.76745,44.772314,44.77410699999998,44.77439,44.77458699999999,44.774443,44.773683,44.77359899999999,44.77469499999999,44.77781399999999,44.780784,44.78141699999998,44.781095,44.779768,44.77801900000001,44.77567100000001,44.771154,44.770063,44.77231500000001,44.774325,44.77531199999999,44.77533099999999,44.77470100000001,44.77191400000001,44.77168499999999,44.773761,44.775564,44.778021,44.78172099999998,44.78675299999999,44.789707]}]],[[{"lng":[-93.76804300000001,-93.76794000000001,-93.767838,-93.76763200000001,-93.76754800000001,-93.767532,-93.76736699999999,-93.766868,-93.766845,-93.766813,-93.76671399999999,-93.76561700000001,-93.765023,-93.765748,-93.76554299999999,-93.76457600000001,-93.763488,-93.76221099999999,-93.761174,-93.761996,-93.764447,-93.764506,-93.76356500000001,-93.760588,-93.758478,-93.759327,-93.761127,-93.75976300000001,-93.758624,-93.76187400000001,-93.760019,-93.757953,-93.756581,-93.75247299999999,-93.752253,-93.750243,-93.749709,-93.74831,-93.745486,-93.741837,-93.739245,-93.737832,-93.73674400000002,-93.733857,-93.73323000000001,-93.72891799999999,-93.728882,-93.72959299999999,-93.72883,-93.72680699999999,-93.726316,-93.72581700000001,-93.724097,-93.720617,-93.71704800000001,-93.71250000000001,-93.712067,-93.70859299999999,-93.707441,-93.70457500000001,-93.70326799999999,-93.702409,-93.701154,-93.699181,-93.698639,-93.69685100000001,-93.694502,-93.68944999999999,-93.687454,-93.684048,-93.68131,-93.678713,-93.676267,-93.672341,-93.669858,-93.66607500000001,-93.662778,-93.66113199999999,-93.656931,-93.652157,-93.647747,-93.645168,-93.643154,-93.640514,-93.638622,-93.63839299999999,-93.639095,-93.63865300000001,-93.639427,-93.64009799999999,-93.64487800000001,-93.64719700000001,-93.651312,-93.65329199999999,-93.65667000000001,-93.658536,-93.658917,-93.657117,-93.654004,-93.649289,-93.647221,-93.645565,-93.645977,-93.645135,-93.64332899999999,-93.642132,-93.639951,-93.637129,-93.63457099999999,-93.633117,-93.63092,-93.62848700000001,-93.62475100000002,-93.623384,-93.62344400000001,-93.625916,-93.625911,-93.623925,-93.619456,-93.61621599999999,-93.614571,-93.612655,-93.61191700000001,-93.612573,-93.610879,-93.60875799999999,-93.607838,-93.605034,-93.604072,-93.601919,-93.60196000000001,-93.597863,-93.593912,-93.592645,-93.59252300000001,-93.594324,-93.59375900000001,-93.59384799999999,-93.592395,-93.59050000000001,-93.58947499999999,-93.586895,-93.583316,-93.579937,-93.575469,-93.569971,-93.56659999999999,-93.562718,-93.56152299999999,-93.561109,-93.559747,-93.55860699999999,-93.557059,-93.55508700000001,-93.552312,-93.548635,-93.547798,-93.542636,-93.539413,-93.53557000000001,-93.53410700000001,-93.534294,-93.533393,-93.531288,-93.528678,-93.52563600000001,-93.525244,-93.526588,-93.524558,-93.52212200000001,-93.521789,-93.521368,-93.51989500000001,-93.51931500000001,-93.51596499999999,-93.51533499999999,-93.51467000000001,-93.51596800000002,-93.51757500000001,-93.519948,-93.520574,-93.52243,-93.52207,-93.521653,-93.514032,-93.51219,-93.502681,-93.501598,-93.50023400000001,-93.496892,-93.492315,-93.487523,-93.48546899999999,-93.48174000000002,-93.47707,-93.47028,-93.466526,-93.464405,-93.460072,-93.457362,-93.45071799999999,-93.44405,-93.442249,-93.438824,-93.436539,-93.43317,-93.42773200000001,-93.42640900000002,-93.424915,-93.422453,-93.41849499999999,-93.415232,-93.412032,-93.407748,-93.395562,-93.39251,-93.39000799999999,-93.38682300000001,-93.379931,-93.37542999999999,-93.37330100000001,-93.35883,-93.354011,-93.34622899999999,-93.33784900000001,-93.330566,-93.328389,-93.323429,-93.319728,-93.31572800000001,-93.312128,-93.311604,-93.311544,-93.309055,-93.30909700000001,-93.308308,-93.30112800000001,-93.299165,-93.298986,-93.297128,-93.296092,-93.295957,-93.29479600000001,-93.29145800000002,-93.28794600000001,-93.284779,-93.283509,-93.28032700000001,-93.27836600000001,-93.279927,-93.28017699999999,-93.28022,-93.280126,-93.279026,-93.280815,-93.282094,-93.284068,-93.28522600000001,-93.282926,-93.28222599999999,-93.280826,-93.28342600000001,-93.272029,-93.26001599999999,-93.25991800000001,-93.249847,-93.247387,-93.24218399999999,-93.237106,-93.23457700000002,-93.226929,-93.219498,-93.21823000000001,-93.20809199999999,-93.207949,-93.207926,-93.207866,-93.207802,-93.20763599999999,-93.207638,-93.20760199999999,-93.20755800000001,-93.207587,-93.207649,-93.20767200000002,-93.207684,-93.20768700000001,-93.207702,-93.20772599999999,-93.207741,-93.20777,-93.207768,-93.207757,-93.203597,-93.202056,-93.200104,-93.200791,-93.20029599999999,-93.199811,-93.201359,-93.201207,-93.200367,-93.19873699999999,-93.194042,-93.192689,-93.190676,-93.19038500000001,-93.18738999999999,-93.181529,-93.177218,-93.177999,-93.177964,-93.178539,-93.17957699999999,-93.18263200000001,-93.182969,-93.179613,-93.178533,-93.178771,-93.181209,-93.18579800000001,-93.18788000000001,-93.189886,-93.193352,-93.197457,-93.199969,-93.20039300000001,-93.19794,-93.19728000000001,-93.1983,-93.203406,-93.20775600000002,-93.21143700000002,-93.216487,-93.221108,-93.221915,-93.21906300000002,-93.22052499999999,-93.22746100000001,-93.23089299999999,-93.23206500000001,-93.23492,-93.239351,-93.243184,-93.24684999999999,-93.249026,-93.251873,-93.25540599999999,-93.261714,-93.27246,-93.280817,-93.28236400000002,-93.28411800000001,-93.285301,-93.289828,-93.29000600000001,-93.290358,-93.294105,-93.29817799999999,-93.30473499999999,-93.314122,-93.31940700000001,-93.325729,-93.329589,-93.329615,-93.33505000000001,-93.33674499999999,-93.339382,-93.34484999999999,-93.346902,-93.349917,-93.35182500000001,-93.351882,-93.354828,-93.3554,-93.358671,-93.36331800000001,-93.364949,-93.366208,-93.373801,-93.37765,-93.38031700000002,-93.380848,-93.38369,-93.384826,-93.385716,-93.387626,-93.39100999999999,-93.39640799999999,-93.398584,-93.403115,-93.40591600000002,-93.411784,-93.41562800000001,-93.419628,-93.429562,-93.439243,-93.440901,-93.442223,-93.4443,-93.450328,-93.455254,-93.45792899999999,-93.460829,-93.463207,-93.474035,-93.475712,-93.48024599999999,-93.481199,-93.48229600000001,-93.482974,-93.484736,-93.490549,-93.49289899999999,-93.49634,-93.499005,-93.501125,-93.503092,-93.50517499999999,-93.506308,-93.50878400000001,-93.511197,-93.513148,-93.518711,-93.520325,-93.52045,-93.520679,-93.520831,-93.52090600000001,-93.520927,-93.520903,-93.52088999999999,-93.52085099999999,-93.52063200000001,-93.520715,-93.52063200000001,-93.52081,-93.520813,-93.520758,-93.520757,-93.520737,-93.520706,-93.523355,-93.540156,-93.545524,-93.552128,-93.570612,-93.58069200000001,-93.584254,-93.60315900000001,-93.60723900000001,-93.61713399999999,-93.61868800000001,-93.619743,-93.634896,-93.63724000000001,-93.64531700000001,-93.659305,-93.662384,-93.663597,-93.666523,-93.669107,-93.683722,-93.699336,-93.70607800000001,-93.706774,-93.749489,-93.76838499999999,-93.76804300000001],"lat":[44.905436,44.91265299999998,44.91981699999999,44.948765,44.97409799999999,44.977646,44.977964,45.028162,45.035568,45.05002300000001,45.060232,45.05968599999999,45.061718,45.06447599999999,45.06632799999999,45.06706000000001,45.067194,45.067748,45.068764,45.069739,45.070213,45.071054,45.07164800000001,45.07298,45.072909,45.074953,45.07362700000001,45.07729199999999,45.07777999999999,45.081244,45.082472,45.082816,45.080576,45.07950399999999,45.079433,45.079126,45.07905999999999,45.079097,45.080268,45.080153,45.080987,45.08270199999999,45.084158,45.087236,45.08744200000001,45.09001599999998,45.09337599999999,45.09744100000001,45.098245,45.09845200000001,45.10130500000001,45.10363,45.107704,45.11444399999999,45.11773000000001,45.122728,45.123154,45.12506199999999,45.12600100000001,45.13026,45.130983,45.13162499999999,45.135675,45.13739199999999,45.137782,45.139436,45.141343,45.143381,45.14507699999999,45.149995,45.15124999999999,45.150519,45.15104400000001,45.152363,45.15392400000001,45.15446,45.15331400000002,45.15332599999999,45.15543699999999,45.156593,45.158609,45.161561,45.16304900000001,45.164003,45.16562,45.167604,45.169236,45.17416099999998,45.17534899999999,45.17584900000001,45.179132,45.17973400000001,45.18252799999999,45.185973,45.188458,45.19149099999999,45.19355100000001,45.197532,45.198747,45.198877,45.199599,45.20167799999999,45.20244,45.204014,45.20443299999999,45.20708,45.2093,45.21015500000001,45.20919700000001,45.204815,45.20287,45.202406,45.202817,45.20393399999999,45.20549399999999,45.207427,45.20923000000001,45.209629,45.20902299999999,45.209624,45.21098599999999,45.21154900000001,45.21041600000001,45.209125,45.20812699999998,45.210188,45.21215999999999,45.21223000000001,45.212828,45.21017700000001,45.208081,45.207308,45.20908600000001,45.210741,45.212565,45.214876,45.21662399999999,45.21691,45.218402,45.218176,45.21480599999999,45.21467699999999,45.21636100000001,45.21710899999999,45.218574,45.21852299999999,45.22120799999999,45.223007,45.22458400000001,45.226995,45.22686400000001,45.22550200000001,45.22497099999999,45.226755,45.22697599999999,45.226456,45.22670999999999,45.232591,45.230973,45.23138599999999,45.23060599999999,45.22859400000001,45.22560299999999,45.22284199999999,45.22243,45.22496399999999,45.226221,45.22866299999999,45.231173,45.23227900000001,45.232475,45.23607999999999,45.238265,45.23848000000001,45.23846899999999,45.23866499999998,45.23992500000001,45.24147000000001,45.242175,45.242279,45.242442,45.244371,45.24568499999999,45.246618,45.246145,45.24568299999999,45.242224,45.24159400000001,45.24056499999999,45.234264,45.230144,45.226985,45.22567799999999,45.224971,45.22510799999998,45.22594200000001,45.225482,45.22462,45.221362,45.220139,45.219478,45.216632,45.21635799999999,45.21681599999999,45.21756700000001,45.21796,45.21556500000001,45.21490299999999,45.21409899999999,45.211423,45.205536,45.20066499999999,45.198164,45.19638699999999,45.19132200000001,45.18975,45.18763999999999,45.185657,45.18136400000001,45.178664,45.178169,45.17496499999999,45.170196,45.16016499999999,45.156156,45.15302700000001,45.151507,45.147465,45.145965,45.14536499999998,45.14416500000002,45.143817,45.14377799999999,45.140674,45.139356,45.13794599999999,45.131965,45.12914799999999,45.12889199999999,45.126965,45.12173599999999,45.11827299999999,45.114918,45.112257,45.110736,45.10860000000001,45.10779000000001,45.10576499999999,45.10303700000001,45.08996500000001,45.088967,45.08845100000001,45.08386499999999,45.08016500000001,45.07171600000001,45.069493,45.064933,45.058465,45.053465,45.05116500000001,45.04356499999999,45.03536499999999,45.035503,45.035544,45.03554400000001,45.035549,45.035553,45.03557899999999,45.03560600000001,45.035624,45.035671,45.035698,45.03569799999999,45.035744,45.02780200000001,45.02756099999999,45.024616,45.02058399999999,45.006205,45.00597700000001,45.000643,44.99168399999999,44.98807099999999,44.980331,44.97632599999999,44.974746,44.974285,44.97158699999999,44.96801,44.96460699999999,44.95966399999999,44.958426,44.95320899999999,44.950978,44.948376,44.94150599999999,44.934301,44.930709,44.926929,44.919764,44.917803,44.90962500000001,44.90776099999999,44.905414,44.904653,44.901217,44.89798700000001,44.89512,44.894259,44.89392800000001,44.89117599999999,44.88964099999999,44.888338,44.88825200000001,44.88712,44.885348,44.882748,44.88134,44.88016199999999,44.878055,44.876486,44.87500199999999,44.87153699999999,44.86920899999999,44.86711799999999,44.865505,44.86452299999998,44.862,44.860114,44.858164,44.852356,44.843626,44.83974199999999,44.83870599999999,44.838477,44.83695999999998,44.83223799999999,44.831053,44.829086,44.827482,44.826709,44.82461099999999,44.820199,44.817812,44.81594199999999,44.814463,44.811476,44.810607,44.809262,44.806874,44.80635399999999,44.80589599999998,44.80447299999999,44.80206700000001,44.80017700000001,44.80012899999999,44.800034,44.79902000000001,44.797425,44.79433,44.79247099999999,44.79281699999999,44.79266599999999,44.791099,44.79108599999999,44.786986,44.786386,44.786622,44.78904299999999,44.791041,44.79133700000001,44.79006399999999,44.78989300000001,44.78578599999999,44.785595,44.785913,44.78887100000001,44.789131,44.78890100000001,44.786599,44.78548200000001,44.78538500000001,44.78569100000001,44.792807,44.796963,44.7978,44.798463,44.79843,44.79695700000001,44.798527,44.80278499999999,44.804686,44.80687399999999,44.80767199999999,44.806863,44.809618,44.812944,44.81212600000001,44.807782,44.80539,44.803476,44.803186,44.80336299999999,44.80596299999999,44.806628,44.804907,44.80434000000001,44.80425699999999,44.804577,44.806225,44.80738299999999,44.80744599999999,44.80451699999999,44.804424,44.809167,44.810006,44.808831,44.804832,44.80442199999999,44.80459399999999,44.80497,44.80496999999999,44.80461300000001,44.80262399999999,44.80197399999999,44.805024,44.816779,44.82757099999999,44.84129799999999,44.847252,44.85117099999999,44.852835,44.85854,44.85852899999999,44.86218699999999,44.86410800000001,44.86433699999999,44.86607699999999,44.87747999999998,44.87796299999999,44.883194,44.89150200000001,44.891457,44.89120799999999,44.89117999999998,44.891168,44.89124399999999,44.89129599999998,44.89132799999999,44.891509,44.89151399999999,44.89143799999999,44.89142199999999,44.89141100000001,44.89106199999999,44.891062,44.891058,44.891032,44.891319,44.89143800000001,44.89133900000001,44.891342,44.89093400000001,44.891072,44.89066199999999,44.89066199999999,44.89067499999999,44.89086999999999,44.905436]}]],[[{"lng":[-93.22796700000001,-93.227789,-93.22769599999999,-93.21737899999999,-93.21360900000001,-93.212727,-93.20466999999999,-93.19882,-93.188706,-93.188413,-93.165192,-93.153392,-93.15007199999999,-93.14316599999999,-93.13908499999999,-93.12746799999999,-93.122094,-93.107016,-93.091539,-93.087165,-93.086861,-93.065596,-93.060934,-93.05677799999999,-93.055407,-93.04798000000001,-93.024716,-93.020518,-93.015525,-93.003849,-93.00303700000001,-92.989277,-92.984619,-92.984549,-92.984537,-92.984523,-92.984517,-92.984517,-92.984712,-92.98482199999999,-92.984803,-92.984763,-92.98476700000002,-92.98476700000002,-92.984763,-92.984758,-92.98477100000001,-92.984786,-92.98478799999999,-92.98478900000001,-92.984791,-92.984784,-92.98477699999999,-92.98476599999999,-92.98476900000001,-92.98477699999999,-92.98474899999999,-92.98474400000001,-92.98474400000001,-92.98473799999999,-92.984702,-92.984696,-92.98470500000001,-92.984703,-92.984706,-92.984763,-92.98483299999999,-92.984735,-92.984663,-92.98466000000001,-92.984561,-92.98459700000001,-92.98450200000001,-92.984459,-92.984459,-92.984441,-92.98439399999999,-92.984396,-92.984399,-92.98421,-92.98419199999999,-93.004424,-93.006773,-93.020044,-93.024607,-93.034733,-93.03693800000001,-93.042125,-93.045179,-93.051642,-93.059647,-93.065388,-93.07301200000001,-93.076465,-93.080674,-93.088016,-93.09090999999999,-93.09092800000001,-93.090935,-93.096041,-93.096024,-93.101812,-93.105835,-93.111282,-93.128629,-93.131941,-93.13367100000001,-93.136493,-93.138879,-93.13908499999999,-93.149109,-93.153032,-93.15389999999999,-93.156864,-93.16434599999999,-93.168176,-93.168919,-93.172102,-93.17568900000001,-93.178539,-93.177964,-93.177999,-93.177218,-93.181529,-93.18738999999999,-93.19038500000001,-93.190676,-93.192689,-93.194042,-93.19873699999999,-93.200367,-93.201207,-93.201359,-93.199811,-93.20029599999999,-93.200791,-93.200104,-93.202056,-93.203597,-93.207757,-93.207768,-93.20777,-93.207741,-93.20772599999999,-93.207702,-93.20768700000001,-93.207684,-93.20767200000002,-93.207649,-93.207587,-93.20755800000001,-93.20760199999999,-93.207638,-93.20763599999999,-93.207802,-93.207866,-93.207926,-93.207949,-93.20809199999999,-93.21823000000001,-93.219498,-93.226929,-93.226966,-93.227059,-93.22709,-93.227208,-93.22723499999999,-93.227237,-93.22735400000001,-93.227423,-93.227581,-93.22764100000002,-93.227682,-93.2277,-93.227734,-93.227734,-93.227755,-93.227828,-93.227844,-93.22784299999999,-93.2281,-93.22796700000001],"lat":[45.116218,45.11679699999999,45.124533,45.12446899999999,45.12445099999999,45.12445099999999,45.12440299999999,45.124396,45.124374,45.12437499999999,45.1243,45.124219,45.12421199999999,45.124217,45.12419199999999,45.124131,45.124129,45.124104,45.12406699999999,45.12404799999999,45.124049,45.124086,45.12410999999999,45.124008,45.124059,45.123992,45.12386,45.12386599999999,45.123796,45.12375300000001,45.123754,45.12375999999999,45.123622,45.115937,45.103049,45.097199,45.096734,45.09665499999999,45.075372,45.06588499999999,45.064736,45.05972,45.057592,45.05747499999999,45.053916,45.05252999999999,45.05024299999999,45.036495,45.03578399999999,45.03541100000001,45.034049,45.03306599999999,45.031818,45.02931199999999,45.021184,45.020009,45.01397699999999,45.010361,45.00946499999999,45.00673499999999,44.999563,44.992273,44.98760499999999,44.98138700000001,44.97775599999999,44.97567600000001,44.970473,44.96325199999998,44.94899299999999,44.948522,44.94553400000001,44.94497400000001,44.941422,44.92802399999999,44.92790699999999,44.919568,44.912521,44.911812,44.91078599999999,44.89459399999998,44.89081400000001,44.890767,44.89076499999999,44.89074999999999,44.89407400000001,44.89783099999998,44.89999899999999,44.905101,44.91230700000001,44.919502,44.91951499999999,44.919527,44.91956199999999,44.91958099999999,44.919615,44.919662,44.91966799999999,44.922206,44.923236,44.923287,44.919679,44.91972,44.91974799999999,44.919732,44.919648,44.91602499999999,44.910265,44.906102,44.904359,44.904227,44.897443,44.89360000000001,44.892898,44.89186499999999,44.89034000000001,44.888551,44.88820399999999,44.88739900000001,44.88740499999999,44.888338,44.88964099999999,44.89117599999999,44.89392800000001,44.894259,44.89512,44.89798700000001,44.901217,44.904653,44.905414,44.90776099999999,44.90962500000001,44.917803,44.919764,44.926929,44.930709,44.934301,44.94150599999999,44.948376,44.950978,44.95320899999999,44.958426,44.95966399999999,44.96460699999999,44.96801,44.97158699999999,44.974285,44.974746,44.97632599999999,44.980331,44.98807099999999,44.99168399999999,45.000643,45.00597700000001,45.006205,45.02058399999999,45.024616,45.02756099999999,45.02780200000001,45.035744,45.03569799999999,45.035698,45.035671,45.04024999999999,45.04993699999999,45.055873,45.06161899999999,45.06484200000001,45.065027,45.07147399999999,45.07514,45.08235199999999,45.085939,45.087744,45.09017699999998,45.09317799999999,45.093217,45.100407,45.107038,45.11135,45.114948,45.115548,45.116218]}]],[[{"lng":[-94.012361,-94.01236400000001,-94.012349,-94.012303,-94.012236,-94.007272,-93.889904,-93.86006500000001,-93.848744,-93.824714,-93.824534,-93.823714,-93.818532,-93.808358,-93.774833,-93.767532,-93.76754800000001,-93.76763200000001,-93.767838,-93.76794000000001,-93.76804300000001,-93.76838499999999,-93.749489,-93.706774,-93.70607800000001,-93.699336,-93.683722,-93.669107,-93.666523,-93.663597,-93.662384,-93.659305,-93.64531700000001,-93.63724000000001,-93.634896,-93.619743,-93.61868800000001,-93.61713399999999,-93.60723900000001,-93.60315900000001,-93.584254,-93.58069200000001,-93.570612,-93.552128,-93.545524,-93.540156,-93.523355,-93.520706,-93.520737,-93.520757,-93.520758,-93.520813,-93.52081,-93.52063200000001,-93.520715,-93.52063200000001,-93.52085099999999,-93.52088999999999,-93.520903,-93.520927,-93.52090600000001,-93.520831,-93.520679,-93.52045,-93.530907,-93.540458,-93.540735,-93.54356900000001,-93.547316,-93.55118299999999,-93.553119,-93.555829,-93.563337,-93.566079,-93.573733,-93.57866300000001,-93.580499,-93.58125,-93.581721,-93.589934,-93.597894,-93.599143,-93.59961300000001,-93.595493,-93.594234,-93.595634,-93.601034,-93.60703400000001,-93.61373399999999,-93.61573,-93.621735,-93.622214,-93.621967,-93.617097,-93.61283400000002,-93.60976700000001,-93.60862,-93.60983400000001,-93.611834,-93.614321,-93.616671,-93.61895199999999,-93.62151799999999,-93.62153499999999,-93.622432,-93.62403,-93.630334,-93.631542,-93.62890899999999,-93.62894300000001,-93.631218,-93.632677,-93.63271400000001,-93.632132,-93.62916199999999,-93.62615099999999,-93.62465400000001,-93.626735,-93.62651700000001,-93.62523400000001,-93.62264,-93.618708,-93.61814099999999,-93.62312799999999,-93.626913,-93.62962,-93.63009599999999,-93.630994,-93.635936,-93.639433,-93.642267,-93.643764,-93.64913,-93.650656,-93.65154099999999,-93.653372,-93.655835,-93.65733900000001,-93.65825599999999,-93.659904,-93.662162,-93.66796100000001,-93.672004,-93.674949,-93.67763600000001,-93.67808100000001,-93.67894,-93.679896,-93.68427200000001,-93.68879100000001,-93.698273,-93.70159200000001,-93.70672999999999,-93.71086099999999,-93.71511099999999,-93.71913000000001,-93.720913,-93.72127,-93.71923800000002,-93.715282,-93.715401,-93.72080400000002,-93.722067,-93.725461,-93.727934,-93.728983,-93.73021799999999,-93.73774100000001,-93.747339,-93.75530500000001,-93.75714600000001,-93.75995500000001,-93.76000500000002,-93.759013,-93.755366,-93.755735,-93.75832600000001,-93.76142,-93.762332,-93.76356800000001,-93.768039,-93.768176,-93.84961,-93.860229,-93.879653,-93.888831,-93.88878,-93.88863600000002,-93.94983999999999,-94.01049399999999,-94.010181,-94.010074,-94.01000000000001,-94.01002099999999,-94.01002099999999,-94.01004,-94.010042,-94.00997700000001,-94.009669,-94.009968,-94.00986400000001,-94.011805,-94.012269,-94.012497,-94.012361],"lat":[44.94957200000001,44.95310499999999,44.960511,44.97127199999998,44.978712,44.97862,44.978142,44.97791300000001,44.97846199999999,44.978262,44.978262,44.978261,44.97823399999999,44.97816799999999,44.977963,44.977646,44.97409799999999,44.948765,44.91981699999999,44.91265299999998,44.905436,44.89086999999999,44.89067499999999,44.89066199999999,44.89066199999999,44.891072,44.89093400000001,44.891342,44.89133900000001,44.89143800000001,44.891319,44.891032,44.891058,44.891062,44.89106199999999,44.89141100000001,44.89142199999999,44.89143799999999,44.89151399999999,44.891509,44.89132799999999,44.89129599999998,44.89124399999999,44.891168,44.89117999999998,44.89120799999999,44.891457,44.89150200000001,44.883194,44.87796299999999,44.87747999999998,44.86607699999999,44.86433699999999,44.86410800000001,44.86218699999999,44.85852899999999,44.85854,44.852835,44.85117099999999,44.847252,44.84129799999999,44.82757099999999,44.816779,44.805024,44.80489,44.804766,44.79900000000001,44.796963,44.795595,44.797369,44.79903,44.799561,44.796942,44.79642400000001,44.795762,44.794373,44.79303399999999,44.790819,44.78250299999998,44.78366199999999,44.782942,44.782715,44.780713,44.77803999999999,44.77621499999999,44.773762,44.769362,44.767562,44.767062,44.76647799999999,44.762862,44.761008,44.76028099999999,44.75887099999999,44.757362,44.755689,44.754203,44.752062,44.74996199999999,44.74886500000001,44.75151799999999,44.753154,44.753411,44.74996199999999,44.74718099999999,44.744766,44.73951999999999,44.738055,44.73277299999999,44.730209,44.728209,44.725844,44.724068,44.723534,44.723354,44.724355,44.72386199999998,44.718462,44.716042,44.71406199999999,44.711427,44.708524,44.70709600000001,44.705216,44.702398,44.70131099999998,44.69829,44.69739000000001,44.69742900000001,44.693292,44.69279599999999,44.692678,44.695046,44.694603,44.69191800000001,44.69047599999999,44.68996199999999,44.690994,44.693413,44.695542,44.69637300000001,44.69525899999999,44.69336,44.69265,44.691162,44.688001,44.68689,44.685815,44.68278800000002,44.677657,44.66944599999999,44.668595,44.66860699999999,44.66821,44.66692399999999,44.66521699999999,44.663952,44.662882,44.66068499999999,44.658688,44.65736500000001,44.65488499999999,44.654741,44.65554600000001,44.656364,44.65613699999999,44.65308499999999,44.64617999999999,44.645263,44.64354900000001,44.64413800000001,44.64341099999999,44.64116,44.639962,44.637483,44.63490699999998,44.63458399999999,44.63498799999999,44.637788,44.63910099999999,44.64030300000001,44.67352,44.673704,44.67359599999999,44.67347000000001,44.67340899999999,44.68042100000001,44.717044,44.71727,44.71746399999999,44.76796299999999,44.782377,44.79902499999999,44.803989,44.804053,44.833299,44.85513699999999,44.862297,44.878046,44.88144299999999,44.891898,44.89193099999999,44.906068,44.935298,44.94957200000001]}]],[[{"lng":[-93.512522,-93.512511,-93.51183399999999,-93.511077,-93.51126600000001,-93.510992,-93.510417,-93.51062,-93.51019700000001,-93.50999400000001,-93.509794,-93.509806,-93.509919,-93.51007,-93.449639,-93.367723,-93.347476,-93.34613,-93.34236799999999,-93.32702,-93.32186900000001,-93.306263,-93.265467,-93.255898,-93.235497,-93.183487,-93.16291699999999,-93.142242,-93.107814,-93.101328,-93.093271,-93.08324399999999,-93.06590799999999,-93.01956300000001,-93.01956300000001,-93.01894299999999,-93.018704,-93.01864500000002,-93.018413,-93.01858900000001,-93.019499,-93.019318,-93.01921900000001,-93.019628,-93.01944,-93.019487,-93.01956000000001,-93.01951099999999,-93.019442,-93.019409,-93.019745,-93.019747,-93.02006900000001,-93.020106,-93.020112,-93.020212,-93.020308,-93.020421,-93.020404,-93.020518,-93.024716,-93.04798000000001,-93.055407,-93.05677799999999,-93.060934,-93.065596,-93.086861,-93.087165,-93.091539,-93.107016,-93.122094,-93.12746799999999,-93.13908499999999,-93.14316599999999,-93.15007199999999,-93.153392,-93.165192,-93.188413,-93.188706,-93.19882,-93.20466999999999,-93.212727,-93.21360900000001,-93.21737899999999,-93.22769599999999,-93.227789,-93.22796700000001,-93.2281,-93.22784299999999,-93.227844,-93.227828,-93.227755,-93.227734,-93.227734,-93.2277,-93.227682,-93.22764100000002,-93.227581,-93.227423,-93.22735400000001,-93.227237,-93.22723499999999,-93.227208,-93.22709,-93.227059,-93.226966,-93.226929,-93.23457700000002,-93.237106,-93.24218399999999,-93.247387,-93.249847,-93.25991800000001,-93.26001599999999,-93.272029,-93.28342600000001,-93.280826,-93.28222599999999,-93.282926,-93.28522600000001,-93.284068,-93.282094,-93.280815,-93.279026,-93.280126,-93.28022,-93.28017699999999,-93.279927,-93.27836600000001,-93.28032700000001,-93.283509,-93.284779,-93.28794600000001,-93.29145800000002,-93.29479600000001,-93.295957,-93.296092,-93.297128,-93.298986,-93.299165,-93.30112800000001,-93.308308,-93.30909700000001,-93.309055,-93.311544,-93.311604,-93.312128,-93.31572800000001,-93.319728,-93.323429,-93.328389,-93.330566,-93.33784900000001,-93.34622899999999,-93.354011,-93.35883,-93.37330100000001,-93.37542999999999,-93.379931,-93.38682300000001,-93.39000799999999,-93.39251,-93.395562,-93.407748,-93.412032,-93.415232,-93.41849499999999,-93.422453,-93.424915,-93.42640900000002,-93.42773200000001,-93.43317,-93.436539,-93.438824,-93.442249,-93.44405,-93.45071799999999,-93.457362,-93.460072,-93.464405,-93.466526,-93.47028,-93.47707,-93.48174000000002,-93.48546899999999,-93.487523,-93.492315,-93.496892,-93.50023400000001,-93.501598,-93.502681,-93.51219,-93.512649,-93.512522],"lat":[45.25144,45.251791,45.27636,45.29633700000001,45.298157,45.299346,45.327457,45.328326,45.35611200000001,45.371694,45.38561300000001,45.38918699999999,45.39654299999999,45.414798,45.41373599999999,45.41369099999999,45.413558,45.413566,45.413577,45.413639,45.413651,45.413695,45.413698,45.41375899999999,45.4138,45.414078,45.414212,45.41364500000001,45.41364699999998,45.41365199999999,45.41377799999999,45.412725,45.41264999999999,45.41177,45.41148499999998,45.394538,45.385836,45.38273799999999,45.374965,45.36946199999998,45.342127,45.325746,45.31122799999999,45.30551799999999,45.296929,45.286403,45.26865600000001,45.25808399999999,45.25092699999999,45.23389300000001,45.21089499999999,45.21074099999999,45.18387599999998,45.182301,45.182081,45.174266,45.164118,45.144053,45.13559700000002,45.12386599999999,45.12386,45.123992,45.124059,45.124008,45.12410999999999,45.124086,45.124049,45.12404799999999,45.12406699999999,45.124104,45.124129,45.124131,45.12419199999999,45.124217,45.12421199999999,45.124219,45.1243,45.12437499999999,45.124374,45.124396,45.12440299999999,45.12445099999999,45.12445099999999,45.12446899999999,45.124533,45.11679699999999,45.116218,45.115548,45.114948,45.11135,45.107038,45.100407,45.093217,45.09317799999999,45.09017699999998,45.087744,45.085939,45.08235199999999,45.07514,45.07147399999999,45.065027,45.06484200000001,45.06161899999999,45.055873,45.04993699999999,45.04024999999999,45.035671,45.035624,45.03560600000001,45.03557899999999,45.035553,45.035549,45.03554400000001,45.035544,45.035503,45.03536499999999,45.04356499999999,45.05116500000001,45.053465,45.058465,45.064933,45.069493,45.07171600000001,45.08016500000001,45.08386499999999,45.08845100000001,45.088967,45.08996500000001,45.10303700000001,45.10576499999999,45.10779000000001,45.10860000000001,45.110736,45.112257,45.114918,45.11827299999999,45.12173599999999,45.126965,45.12889199999999,45.12914799999999,45.131965,45.13794599999999,45.139356,45.140674,45.14377799999999,45.143817,45.14416500000002,45.14536499999998,45.145965,45.147465,45.151507,45.15302700000001,45.156156,45.16016499999999,45.170196,45.17496499999999,45.178169,45.178664,45.18136400000001,45.185657,45.18763999999999,45.18975,45.19132200000001,45.19638699999999,45.198164,45.20066499999999,45.205536,45.211423,45.21409899999999,45.21490299999999,45.21556500000001,45.21796,45.21756700000001,45.21681599999999,45.21635799999999,45.216632,45.219478,45.220139,45.221362,45.22462,45.225482,45.22594200000001,45.22510799999998,45.224971,45.22567799999999,45.226985,45.230144,45.234264,45.24056499999999,45.24159400000001,45.242224,45.24568299999999,45.24669099999999,45.25144]}]],[[{"lng":[-93.329666,-93.329615,-93.329589,-93.325729,-93.31940700000001,-93.314122,-93.30473499999999,-93.29817799999999,-93.294105,-93.290358,-93.29000600000001,-93.289828,-93.285301,-93.28411800000001,-93.28236400000002,-93.280817,-93.27246,-93.261714,-93.25540599999999,-93.251873,-93.249026,-93.24684999999999,-93.243184,-93.239351,-93.23492,-93.23206500000001,-93.23089299999999,-93.22746100000001,-93.22052499999999,-93.21906300000002,-93.221915,-93.221108,-93.216487,-93.21143700000002,-93.20775600000002,-93.203406,-93.1983,-93.19728000000001,-93.19794,-93.20039300000001,-93.199969,-93.197457,-93.193352,-93.189886,-93.18788000000001,-93.18579800000001,-93.181209,-93.178771,-93.178533,-93.179613,-93.182969,-93.18263200000001,-93.17957699999999,-93.178539,-93.17568900000001,-93.172102,-93.168919,-93.168176,-93.16434599999999,-93.156864,-93.15389999999999,-93.153032,-93.149109,-93.13908499999999,-93.138879,-93.136493,-93.13367100000001,-93.131941,-93.128629,-93.111282,-93.105835,-93.101812,-93.096024,-93.096041,-93.090935,-93.09092800000001,-93.09090999999999,-93.088016,-93.080674,-93.076465,-93.07301200000001,-93.065388,-93.059647,-93.051642,-93.045179,-93.042125,-93.03693800000001,-93.034733,-93.024607,-93.020044,-93.01646599999999,-93.01604399999999,-93.01596600000001,-93.01263899999999,-93.01153100000001,-93.010076,-93.00914,-93.00842799999999,-93.00856400000001,-93.008641,-93.00868,-93.01003200000001,-93.01121500000001,-93.011791,-93.011875,-93.011059,-93.005709,-93.004711,-93.00510300000001,-93.00711,-93.015473,-93.018382,-93.020352,-93.021395,-93.02152100000001,-93.019718,-93.017869,-93.01596100000002,-93.01293200000001,-93.005978,-93.00072900000001,-92.994771,-92.99155,-92.98607100000001,-92.981317,-92.97479900000002,-92.963848,-92.954078,-92.939733,-92.937473,-92.934989,-92.93204000000001,-92.928629,-92.925359,-92.919966,-92.91331599999999,-92.905102,-92.89811899999999,-92.892027,-92.886252,-92.883826,-92.882559,-92.87859,-92.872642,-92.86661800000002,-92.860923,-92.8553,-92.852896,-92.849934,-92.84774899999999,-92.836037,-92.829341,-92.82654700000002,-92.82518399999999,-92.812634,-92.808088,-92.8025794058107,-92.802402,-92.78790600000001,-92.7765968317748,-92.766054,-92.75699,-92.7542,-92.75020000000001,-92.73725899999999,-92.73204200000001,-92.73241299999999,-92.732429,-92.73232200000001,-92.732043,-92.732428,-92.742682,-92.757344,-92.79258400000001,-92.792528,-92.792526,-92.79248800000001,-92.79249900000001,-92.792508,-92.79259999999999,-92.79531900000001,-92.80072,-92.89140000000002,-92.906448,-92.911832,-92.91380300000002,-92.918977,-92.918978,-92.918978,-92.91914800000001,-92.92220399999999,-92.922876,-92.924751,-92.93329300000002,-92.93807700000001,-92.94515699999999,-92.946517,-92.951363,-92.952685,-92.954826,-92.956354,-92.955141,-92.95684900000001,-92.95938099999999,-92.96231,-92.96448700000002,-92.973208,-92.976383,-92.98194100000001,-92.984914,-92.99862400000001,-93.003344,-93.007459,-93.013076,-93.01606099999999,-93.017917,-93.02319199999999,-93.023674,-93.025105,-93.026837,-93.03053300000001,-93.03300299999999,-93.03776999999999,-93.039339,-93.039715,-93.03992700000001,-93.03940299999999,-93.039485,-93.100154,-93.129791,-93.13066999999999,-93.14594100000001,-93.151774,-93.152124,-93.152485,-93.15660800000001,-93.15973099999999,-93.16057600000001,-93.16597,-93.166101,-93.17778000000001,-93.18085500000001,-93.185838,-93.187781,-93.211044,-93.21586600000001,-93.221305,-93.23388700000001,-93.239311,-93.26490700000001,-93.27404400000002,-93.28168599999999,-93.281593,-93.281521,-93.27847300000001,-93.27806900000002,-93.27816900000001,-93.308606,-93.31870700000002,-93.318556,-93.318353,-93.318353,-93.318371,-93.31824,-93.318212,-93.31820399999999,-93.318157,-93.323443,-93.328401,-93.328479,-93.32852800000001,-93.32865200000001,-93.328727,-93.32872200000001,-93.32873499999999,-93.329668,-93.329666],"lat":[44.77948300000001,44.79108599999999,44.791099,44.79266599999999,44.79281699999999,44.79247099999999,44.79433,44.797425,44.79902000000001,44.800034,44.80012899999999,44.80017700000001,44.80206700000001,44.80447299999999,44.80589599999998,44.80635399999999,44.806874,44.809262,44.810607,44.811476,44.814463,44.81594199999999,44.817812,44.820199,44.82461099999999,44.826709,44.827482,44.829086,44.831053,44.83223799999999,44.83695999999998,44.838477,44.83870599999999,44.83974199999999,44.843626,44.852356,44.858164,44.860114,44.862,44.86452299999998,44.865505,44.86711799999999,44.86920899999999,44.87153699999999,44.87500199999999,44.876486,44.878055,44.88016199999999,44.88134,44.882748,44.885348,44.88712,44.88825200000001,44.888338,44.88740499999999,44.88739900000001,44.88820399999999,44.888551,44.89034000000001,44.89186499999999,44.892898,44.89360000000001,44.897443,44.904227,44.904359,44.906102,44.910265,44.91602499999999,44.919648,44.919732,44.91974799999999,44.91972,44.919679,44.923287,44.923236,44.922206,44.91966799999999,44.919662,44.919615,44.91958099999999,44.91956199999999,44.919527,44.91951499999999,44.919502,44.91230700000001,44.905101,44.89999899999999,44.89783099999998,44.89407400000001,44.89074999999999,44.884611,44.883133,44.88282499999999,44.86910199999999,44.866928,44.863787,44.86184599999999,44.858711,44.855157,44.85307899999999,44.85204299999999,44.84598899999999,44.84190599999999,44.83737899999999,44.836716,44.83354,44.81818,44.814873,44.813505,44.81198799999999,44.802625,44.79849699999999,44.794229,44.789707,44.78675299999999,44.78172099999998,44.778021,44.775564,44.773761,44.77168499999999,44.77191400000001,44.77470100000001,44.77533099999999,44.77531199999999,44.774325,44.77231500000001,44.770063,44.771154,44.77567100000001,44.77801900000001,44.779768,44.781095,44.78141699999998,44.780784,44.77781399999999,44.77469499999999,44.77359899999999,44.773683,44.774443,44.77458699999999,44.77439,44.77410699999998,44.772314,44.76745,44.76028399999998,44.755765,44.74771499999999,44.747151,44.74652399999999,44.746636,44.747368,44.75001,44.750429,44.75024299999999,44.74725200000001,44.74701,44.7457971094334,44.745167,44.737432,44.7333807383824,44.72960400000001,44.723829,44.72276699999999,44.72211999999999,44.71715500000001,44.71367063983209,44.679948,44.668775,44.636287,44.62949299999999,44.629485,44.62950099999999,44.62950199999999,44.62972199999999,44.600687,44.59882199999999,44.579517,44.565215,44.56463699999999,44.54297099999999,44.54266200000001,44.54319999999999,44.54327800000001,44.54326799999999,44.543266,44.54338599999999,44.54325,44.53290800000001,44.528792,44.51756899999999,44.51744599999999,44.51794,44.515521,44.512425,44.51142899999999,44.51279199999999,44.512572,44.507703,44.50697899999999,44.507025,44.50855599999999,44.510874,44.514552,44.51539,44.515787,44.514613,44.51469199999998,44.51704699999999,44.51865100000001,44.51882200000001,44.517561,44.51586099999999,44.516275,44.516018,44.515106,44.51503599999999,44.516188,44.51761200000001,44.51802,44.51622399999999,44.515398,44.51442500000001,44.51472099999999,44.515545,44.51251200000001,44.48643799999999,44.479056,44.471871,44.47174999999999,44.47124099999999,44.47114899999999,44.47129899999999,44.471359,44.47135799999999,44.471358,44.47134299999999,44.47133,44.471329,44.47134400000001,44.47134299999999,44.471329,44.47130999999999,44.471355,44.471373,44.47148099999999,44.471249,44.47138699999999,44.47168,44.47156099999999,44.471903,44.471788,44.47199800000001,44.486458,44.543957,44.543957,44.59459699999999,44.630751,44.63064199999999,44.63057800000001,44.65209099999999,44.681286,44.68136199999999,44.68794700000001,44.68840599999999,44.702739,44.705978,44.717536,44.71755499999999,44.71752900000001,44.73220000000001,44.735703,44.74642899999999,44.75837,44.76792500000001,44.775823,44.77844199999999,44.77948300000001]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#444444","weight":1,"opacity":1,"fill":true,"fillColor":["#FFFFB2","#E31A1C","#E31A1C","#FECC5C","#FFFFB2","#FD8D3C","#FD8D3C"],"fillOpacity":0.5,"smoothFactor":0.5,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"color":"white","weight":2,"bringToFront":true}]},{"method":"addCircles","args":[[44.90278077160372,45.23332863318971,45.19778045484481,44.73193964531183,45.05028188686183,45.02139068146756,44.62277990600146,45.4038913377956,45.06111209643089,45.16082890723997,44.84082924580828,45.07610926514652,45.09417219810582,44.76777839654412,44.76361156206362,45.16305945759713,45.18889206872614,44.86222111732461,44.78943999960301,45.14861045386917,44.71722014179064,44.77166936502991,45.04082823869766,45.26855500025184,45.17554760012633,45.09527976095055,44.8277820058786,45.0327810474579,45.24389073944403,44.92972121879176,45.08999807567681,44.80416951851269,45.31943982926527,44.85471974735684,44.88972189070137,44.56689569971468,44.90332960360271,44.99167033465402,44.64028160539139,45.27889078116789,45.08611128373506,45.05750037400293,45.00972117041016,45.0844391146905,45.10333038987304,44.91500171491995,45.25028202237078,44.73332864305424,44.61028060198309,44.74333107512349,45.05333054718731,44.9259319996351,45.15999869000696,45.02528045008984,44.84806093701072,44.66693801187552,44.99583210027908,44.92082859919324,44.9563888218411,44.94805852942093,44.64971975008463,44.95082972036789,44.99860964749737,45.14250024005083,44.91610951874809,45.16027958565104,45.0269415908028,44.98667094638279,45.05474569995761,45.0697190542687,45.072498048181,45.00722030582062,45.008701961774,45.19915524149073,44.88499938699594,44.99528051899692,45.03528056754077,44.88721816795214,44.88361136339935,44.60056195909831,44.98000041706193,44.91332897307133,44.93971847742839,44.93832946228927,44.93667096341184,45.10500193659364,45.06555903598696,44.88416850426286,45.03805992602285,44.54333064752274,44.60138947114778,44.86638822613573,45.10277923168206,45.01249975751385,44.77360795865901,45.32805830345674,45.34083157901222,45.03139157917983,44.96306042315646,44.97138794443198,45.11944008023515,45.03582826267426,45.01056185756202,44.71332901271745,45.24610975235519,44.52597039969164,44.88333121868619,45.03222166922358,45.1888887049348,44.73944164905837,45.00610964922669,44.90509169975885,45.386937949405,44.94833118973273,44.91443936643339,44.95226323767234,44.84222158801165,44.77917087707345,45.25361205705003,44.79805798696243,45.07916778870374,44.90082885856199,44.8927816590602,45.10777997300017,44.93527916748347,45.05427254087103,44.87082895917656,44.90860903141756,45.05749920076491,44.67360837809525,44.8586081704229,44.85082822234007,44.96361166910925,44.97416787654,44.91611132578064,45.08472149150192,45.05417041320599,44.92389079964598,44.94693891809926,45.02056066573921,45.00754638541621,44.54388856375851,44.58721925101244,44.67443856972784,44.58721998402887,45.35693830503514,44.66162388735584,44.76917171316395,44.71417193988503,44.65278165023213,44.48388878292518,44.96339355611622,45.10246639986785,44.75405372423961,44.87788672272377,45.38203825589967],[-92.78333018267055,-93.29110982967548,-93.38693999465998,-93.21749990646589,-93.15638982591744,-92.78082985620817,-93.76833015497057,-93.26749991447453,-92.97583002662282,-93.23471985120334,-93.29805982714635,-93.33250008263856,-93.35611007271058,-93.27749993121535,-93.6255601986243,-93.05555989259337,-93.39721993595735,-93.53056000463059,-93.60194005327148,-93.15139007119664,-93.0344400185044,-93.78111016545722,-93.26278007089989,-93.08086700032614,-93.30946700043548,-93.54721981486209,-92.94361001017602,-93.35999986549476,-93.51472015887026,-93.52222009672488,-92.97221995040924,-93.16666996399466,-93.20221998969411,-93.47056006888232,-93.34971981517138,-93.33764799969136,-93.56610998659175,-93.16611000633513,-93.14333007043808,-92.98500014432001,-93.26305987329123,-93.03221983966814,-93.34888999898861,-92.91028010272144,-93.69110984508639,-93.55306011878612,-93.24971992860259,-93.9669399212317,-93.00194003612623,-92.85221986749573,-93.24721988927406,-93.40584900029673,-92.99305980791394,-93.70722014931781,-93.04250011231389,-93.62666998213327,-92.87917006566305,-92.7666700037653,-92.76556001391893,-92.76389013318392,-93.24250010893836,-92.97639017401175,-93.20555989851577,-93.16305990354002,-93.12582988962626,-93.08860984178006,-93.08749984685801,-93.57139006014968,-93.63489299982204,-92.95138999919241,-93.45555991415951,-93.65555985527986,-93.03578802615023,-92.77069563610516,-93.88750000603177,-93.41527987370755,-93.58222019250653,-93.1641700337006,-93.13806004057116,-92.81277992840884,-93.26360989430358,-93.50306009702381,-93.57639009254312,-93.71750017525652,-93.66583006623601,-93.20832986767425,-93.20166983260694,-93.97027991077788,-93.38639008788927,-93.57582994558182,-92.93389014042621,-93.00028006946775,-93.07889015867555,-92.99167017327601,-93.92139000797222,-93.46999997670885,-93.32667011397518,-92.7927799705258,-92.96472018711114,-93.60416997389569,-93.40222000647921,-92.95417011910808,-93.45528002445795,-93.42249997841689,-93.45194006171614,-93.01959700023983,-93.28277985613012,-93.3383299442968,-93.55277993457325,-93.12556018725479,-93.15639013694762,-93.74735399956137,-93.359169986753,-93.3477798915999,-92.76556000080261,-93.10210533531408,-92.9911099303355,-93.33610983236525,-92.80555994575361,-93.52667012212584,-93.14693994954304,-93.58888989196485,-93.03471995753493,-93.23777998129107,-93.63194014247719,-92.82233641841466,-93.09833013984421,-93.59277995392675,-93.0736099087305,-92.96694011967281,-93.66138980679901,-93.78667000104511,-93.84693987806376,-93.50639012338475,-93.1013901899166,-93.00972017590232,-92.95638985389415,-92.95917005985793,-93.50388993906286,-93.21777993159897,-92.82250586671998,-93.15221995312385,-93.43999980922335,-93.37889016342066,-93.2177799708506,-93.11139008429538,-92.85331542744574,-92.90194003583994,-93.58806014094111,-93.50083002191575,-93.14277997696462,-92.82245835120268,-93.02744059948439,-93.45503313432125,-93.20852758372074,-93.09508728397438],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#444444","weight":5,"opacity":0.5,"fill":true,"fillColor":"#444444","fillOpacity":0.2},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null,null]}],"limits":{"lat":[44.47114899999999,45.414798],"lng":[-94.012497,-92.73204200000001]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="open-ended-exercise" class="level2">
<h2 class="anchored" data-anchor-id="open-ended-exercise">Open-ended Exercise</h2>
<p>The following exercises will use census tract <code>tidycensus</code> data for Ramsey and Hennepin county and <a href="data/Crash.csv">Crash.csv</a> (2019-2022) from the <a href="https://information.stpaul.gov/datasets/stpaul::pedestrian-and-bike-crash-dataset-/about">pedestrian/bike crash database</a> for St.&nbsp;Paul within Ramsey county in the Twin Cities. We provide several variables you can choose from in order to create maps that best fit your interest.</p>
<p>Load the data with the following code:</p>
<section id="exercise-joining-and-aggregation" class="level3">
<h3 class="anchored" data-anchor-id="exercise-joining-and-aggregation">Exercise: Joining and aggregation</h3>
<p><strong>Create a map of crashes per census tract in Ramsey county.</strong></p>
<p>First, transform the <code>crashes</code> data frame to a <code>sf</code> object have a point geometry using the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>crashes <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(crashes, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs =</span> <span class="st">"NAD83"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the CRS are the same for <code>census2020</code> and <code>crashes</code> using <code>st_crs()</code> and transform if needed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join the crashes and census dataset together and count the number of crashes per census tract. The function <code>st_join</code> can join to spatial data sets according to whether the spatial geometries of the right table intersect with the spatial geometries of the left table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>crashes_per_tract <span class="ot">&lt;-</span> <span class="fu">st_join</span>(??,??) <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> <span class="co">#removes geometry - makes the following calculation more efficient </span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Accident_Datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(??) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: &lt;text&gt;:1:32: unexpected ','
1: crashes_per_tract &lt;- st_join(??,
                                   ^</code></pre>
</div>
</div>
<p>Join the census data with <code>crashes_per_tract</code> and then use a filter of <code>n &gt; 0</code> to only keep the census tracts where crashes were recorded instead of all of Ramsey and Hennepin County.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>crashes_per_tract_geo <span class="ot">&lt;-</span> ??? <span class="sc">%&gt;%</span> <span class="co"># sf object with census geometry goes first</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(??, <span class="at">by =</span> ??) <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: &lt;text&gt;:1:30: unexpected SPECIAL
1: crashes_per_tract_geo &lt;- ??? %&gt;%
                                 ^</code></pre>
</div>
</div>
<p>Create the plot!!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(???) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"lightcyan"</span>, <span class="st">"lightcyan2"</span>, <span class="st">"lightskyblue3"</span>, <span class="st">"lightskyblue4"</span>))<span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Crashes"</span>, <span class="at">color =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Number of pedestrian/bike crashes per census tract"</span>) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercise-adding-layers" class="level3">
<h3 class="anchored" data-anchor-id="exercise-adding-layers">Exercise: Adding layers</h3>
<p><strong>Plot a variable of your choice for census tracts in Hennepin and Ramsey County and add roads to the map.</strong></p>
<p>Start by downloading a shape file. For example, you could search for “Minnesota roads shape file”. For this example, visit <a href="https://catalog.data.gov/dataset/tiger-line-shapefile-2019-state-minnesota-primary-and-secondary-roads-state-based-shapefile">this site</a> and download the Shapefile Zip File. Unzip the file and put the folder in the same location as this Rmd file.</p>
<p>Load in the shapefile using <code>st_read()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"tl_2019_27_prisecroads"</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> roads <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(census2020))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Start by using <code>st_crop()</code> to crop the roads map to the area we are interested in (Hennepin and Ramsey County).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>roads_sub <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(roads,<span class="fu">st_bbox</span>(census2020))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create the map!!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(??)<span class="sc">+</span> <span class="co">#put census tracts on map and fill by your variable of interest</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(?? ,<span class="at">fill =</span> <span class="st">"gray"</span>, <span class="at">color =</span> <span class="st">"gray"</span>, <span class="at">lwd =</span> <span class="fl">0.2</span>)<span class="sc">+</span> <span class="co">#roads data here</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(??)<span class="sc">+</span> <span class="co"># add labels to fit your variables </span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"lightcyan"</span>, <span class="st">"lightcyan2"</span>, <span class="st">"lightskyblue3"</span>, <span class="st">"lightskyblue4"</span>))<span class="sc">+</span> <span class="co"># change to preferred color palette</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title.position =</span> <span class="st">"plot"</span>, </span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>), </span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bonus-challenge-map-design-if-you-have-time" class="level3">
<h3 class="anchored" data-anchor-id="bonus-challenge-map-design-if-you-have-time">Bonus Challenge: Map design (if you have time)</h3>
<p><strong>Add some labels, a legend, a title, a scale bar, and credits to your map.</strong></p>
</section>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<ul>
<li>Spatial Data Science <a href="https://r-spatial.org/book/" class="uri">https://r-spatial.org/book/</a></li>
<li>Leaflet in R <a href="https://rstudio.github.io/leaflet/" class="uri">https://rstudio.github.io/leaflet/</a></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>