<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brianna Heggeseth (with contributions from Erin Franke and Vivian Powell)">

<title>STAT/COMP 212 - Topic 3: Advanced Spatial Visualizations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STAT/COMP 212</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./schedule.html" rel="" target="">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./activities.html" rel="" target="">
 <span class="menu-text">Activities</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./homework.html" rel="" target="">
 <span class="menu-text">Homework</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./project.html" rel="" target="">
 <span class="menu-text">Project</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-adv-maps.html">Topic 3: Advanced Spatial Visualizations</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introductions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic 1: Introductions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-adv-ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic 2: Advanced Data Visualization in ggplot2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-adv-maps.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Topic 3: Advanced Spatial Visualizations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-interactive-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic 4: Interactive visualization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-data-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic 5: Wrangling numerics, logicals, factors, and dates</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-functions-control-structs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic 6: Functions and control structures</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">Learning goals</a></li>
  <li><a href="#spatial-visualization-review" id="toc-spatial-visualization-review" class="nav-link" data-scroll-target="#spatial-visualization-review">Spatial Visualization Review</a></li>
  <li><a href="#where-next" id="toc-where-next" class="nav-link" data-scroll-target="#where-next">Where next?</a></li>
  <li><a href="#coordinate-reference-system" id="toc-coordinate-reference-system" class="nav-link" data-scroll-target="#coordinate-reference-system">Coordinate Reference System</a>
  <ul class="collapse">
  <li><a href="#ellipsoid" id="toc-ellipsoid" class="nav-link" data-scroll-target="#ellipsoid">Ellipsoid</a></li>
  <li><a href="#datum" id="toc-datum" class="nav-link" data-scroll-target="#datum">Datum</a>
  <ul class="collapse">
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise</a></li>
  </ul></li>
  <li><a href="#projection" id="toc-projection" class="nav-link" data-scroll-target="#projection">Projection</a>
  <ul class="collapse">
  <li><a href="#exercise-2" id="toc-exercise-2" class="nav-link" data-scroll-target="#exercise-2">Exercise</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3">Exercise</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#spatial-data" id="toc-spatial-data" class="nav-link" data-scroll-target="#spatial-data">Spatial Data</a>
  <ul class="collapse">
  <li><a href="#data-models" id="toc-data-models" class="nav-link" data-scroll-target="#data-models">Data Models</a>
  <ul class="collapse">
  <li><a href="#vector" id="toc-vector" class="nav-link" data-scroll-target="#vector">Vector</a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4">Exercise</a></li>
  <li><a href="#raster" id="toc-raster" class="nav-link" data-scroll-target="#raster">Raster</a></li>
  </ul></li>
  <li><a href="#working-with-spatial-data-in-r" id="toc-working-with-spatial-data-in-r" class="nav-link" data-scroll-target="#working-with-spatial-data-in-r">Working with Spatial Data in R</a>
  <ul class="collapse">
  <li><a href="#read-in-data-to-r" id="toc-read-in-data-to-r" class="nav-link" data-scroll-target="#read-in-data-to-r">Read in data to R</a></li>
  <li><a href="#data-classes-in-r" id="toc-data-classes-in-r" class="nav-link" data-scroll-target="#data-classes-in-r">Data classes in R</a></li>
  <li><a href="#exercise-5" id="toc-exercise-5" class="nav-link" data-scroll-target="#exercise-5">Exercise</a></li>
  <li><a href="#exercise-6" id="toc-exercise-6" class="nav-link" data-scroll-target="#exercise-6">Exercise</a></li>
  <li><a href="#exercise-7" id="toc-exercise-7" class="nav-link" data-scroll-target="#exercise-7">Exercise</a></li>
  <li><a href="#convert-data-class-types" id="toc-convert-data-class-types" class="nav-link" data-scroll-target="#convert-data-class-types">Convert data class types</a></li>
  <li><a href="#exercise-8" id="toc-exercise-8" class="nav-link" data-scroll-target="#exercise-8">Exercise</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#spatial-maps" id="toc-spatial-maps" class="nav-link" data-scroll-target="#spatial-maps">Spatial Maps</a>
  <ul class="collapse">
  <li><a href="#hexbin-choropleth" id="toc-hexbin-choropleth" class="nav-link" data-scroll-target="#hexbin-choropleth">Hexbin Choropleth</a>
  <ul class="collapse">
  <li><a href="#exercise-9" id="toc-exercise-9" class="nav-link" data-scroll-target="#exercise-9">Exercise</a></li>
  <li><a href="#exercise-10" id="toc-exercise-10" class="nav-link" data-scroll-target="#exercise-10">Exercise</a></li>
  <li><a href="#bonus-challenge" id="toc-bonus-challenge" class="nav-link" data-scroll-target="#bonus-challenge">Bonus Challenge</a></li>
  </ul></li>
  <li><a href="#mn-citycounty-example" id="toc-mn-citycounty-example" class="nav-link" data-scroll-target="#mn-citycounty-example">MN City/County example</a>
  <ul class="collapse">
  <li><a href="#unify-crs" id="toc-unify-crs" class="nav-link" data-scroll-target="#unify-crs">Unify CRS</a></li>
  <li><a href="#initial-map-counties-and-cities" id="toc-initial-map-counties-and-cities" class="nav-link" data-scroll-target="#initial-map-counties-and-cities">Initial Map: Counties and Cities</a></li>
  <li><a href="#updated-map-counties-and-cities-plus-elevation" id="toc-updated-map-counties-and-cities-plus-elevation" class="nav-link" data-scroll-target="#updated-map-counties-and-cities-plus-elevation">Updated Map: Counties and Cities plus Elevation</a></li>
  <li><a href="#zoom-to-twin-cities-map" id="toc-zoom-to-twin-cities-map" class="nav-link" data-scroll-target="#zoom-to-twin-cities-map">Zoom to Twin Cities Map</a></li>
  </ul></li>
  <li><a href="#open-ended-exercise" id="toc-open-ended-exercise" class="nav-link" data-scroll-target="#open-ended-exercise">Open-ended Exercise</a>
  <ul class="collapse">
  <li><a href="#exercise-joining-and-aggregation" id="toc-exercise-joining-and-aggregation" class="nav-link" data-scroll-target="#exercise-joining-and-aggregation">Exercise: Joining and aggregation</a></li>
  <li><a href="#exercise-adding-layers" id="toc-exercise-adding-layers" class="nav-link" data-scroll-target="#exercise-adding-layers">Exercise: Adding layers</a></li>
  <li><a href="#bonus-challenge-map-design-if-you-have-time" id="toc-bonus-challenge-map-design-if-you-have-time" class="nav-link" data-scroll-target="#bonus-challenge-map-design-if-you-have-time">Bonus Challenge: Map design (if you have time)</a></li>
  </ul></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Topic 3: Advanced Spatial Visualizations</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brianna Heggeseth (with contributions from Erin Franke and Vivian Powell) </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="learning-goals" class="level1">
<h1>Learning goals</h1>
<p>After this lesson, you should be able to:</p>
<ul>
<li>Understand the basics of a CRS (coordinate reference system)</li>
<li>Understand and recognize different spatial file types and data types in R</li>
<li>Implement some of the basic plotting with the <code>sf</code> package</li>
<li>Understand foundational ideas in working with spatial data (aggregating spatial point data to a spatial region, joining spatial data sets)</li>
</ul>
</section>
<section id="spatial-visualization-review" class="level1">
<h1>Spatial Visualization Review</h1>
<p>In STAT/COMP 112, you learned about basic spatial visualizations. To review,</p>
<ul>
<li><strong>Background Maps in ggplot</strong>. The <code>ggmap</code> package includes tools to create a plot with a map background. In particular, <code>get_stamenmap()</code> accesses map image tiles from Stamen Maps (<a href="http://maps.stamen.com/" class="uri">http://maps.stamen.com/</a>) based on a provided bounding box (bbox) and <code>ggmap()</code> can be used instead of <code>ggplot()</code> to use a background map image as the plotting frame.
<ul>
<li><a href="http://Openstreetmap.org" class="uri">http://Openstreetmap.org</a> is an excellent tool to find longitude/latitude values for a desired bbox.</li>
<li><em>Technical note: The bounding box of the ggmap object has a CRS of WGS84 (EPSG:4326), but the actual raster is in EPSG:3857. We’ll talk about CRS in this activity</em></li>
</ul></li>
<li><strong>Contour Plots</strong>. The <code>geom_density_2d()</code> function in <code>ggplot2</code> package displays contours of intensity of points in a spatial area.</li>
<li><strong>Choropleth</strong>. The <code>geom_map(data, map, aes(map_id))</code> function in <code>ggplot2</code> package displays choropleth maps (filled polygons/regions) based on a data frame of coordinates (long/x,lat/y,region/id) and an attribute data frame with properties for each region or id.</li>
<li><strong>Leaflet</strong>. The <code>leaflet</code> package in R provides access to the Leaflet javascript library (<a href="https://leafletjs.com/" class="uri">https://leafletjs.com/</a>) to create interactive maps. A basic map can be created with a data frame of coordinates and attributes (more advanced topics can be found at <a href="https://rstudio.github.io/leaflet/" class="uri">https://rstudio.github.io/leaflet/</a>):</li>
</ul>
<pre><code>leaflet(data) %&gt;% 
  addTiles() %&gt;% 
  addMarkers()</code></pre>
</section>
<section id="where-next" class="level1">
<h1>Where next?</h1>
<p>We used based mapping tools without thinking too much about the details of the maps. In order to create more advanced spatial visualizations, you need a foundation in spatial coordinate reference systems and how spatial data is often recorded and stored!</p>
</section>
<section id="coordinate-reference-system" class="level1">
<h1>Coordinate Reference System</h1>
<p>At the heart of every spatial visualization is a set of locations. One way to describe a location is in terms of coordinates and a coordinate reference system (known as CRS).</p>
<p>There are three main components to a CRS: ellipsoid, datum, and a projection.</p>
<section id="ellipsoid" class="level2">
<h2 class="anchored" data-anchor-id="ellipsoid">Ellipsoid</h2>
<p>While you might have learned that the Earth is a sphere, it is actually closer to an ellipsoid with a bulge at the equator. Additionally, the surface is irregular and not smooth. To define a CRS, we first need to choose a mathematical model represent a smooth approximation to the shape of the Earth. The common ellipsoid models are known as WGS84 and GRS80. See the illustration below of one ellipsoid model (shown in black) as compared to Earth’s true irregular surface (shown in red).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.icsm.gov.au/sites/default/files/inline-images/geocentric_0.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Illustration of ellipsoid model and Earth’s irregular surface, centered to have an overall best fit. Source: www.icsm.gov.au</figcaption>
</figure>
</div>
</section>
<section id="datum" class="level2">
<h2 class="anchored" data-anchor-id="datum">Datum</h2>
<p>Each ellipsoid model has different ways to position it self relative to Earth depending on the center or origin. Each potential position and reference frame for representing the position of locations on Earth is called a datum.</p>
<p>For example, two different datum for the same ellipsoid model can provide a more accurate fit or approximation of the Earth’s surface depending on the region of interest (South America v. North America). For example, the NAD83 datum is a good fit for the GRS80 ellipsoid in North America, but SIRGAS2000 is a better fit for the GRS80 ellipsoid in South America. The illustration below shows one datum in which the center of the ellipsoid does not coincide with the center of Earth’s mass. With this position of the ellipsoid, we gain a better fit for the southern half of the Earth.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.icsm.gov.au/sites/default/files/inline-images/regional_0.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Illustration of ellipsoid model and Earth’s irregular surface for a datum that better fits southern part (bottom right) of the Earth. Source: www.icsm.gov.au</figcaption>
</figure>
</div>
<p>It is useful to know that the Global Positioning System (GPS) uses the WGS84 ellipsoid model and a datum by the same name, which provides an overall best fit of the Earth.</p>
<p>If you have longitude and latitude coordinates for a location, it is important to know what datum and ellipsoid were used to define those positions.</p>
<p><em>Note: In practice, the horizontal distance between WGS84 and NAD83 coordinates is about 3-4 feet in the US, which may not be significant for most applications.</em></p>
<section id="exercise" class="level3">
<h3 class="anchored" data-anchor-id="exercise">Exercise</h3>
<p>Go to <a href="https://epsg.io/" class="uri">https://epsg.io/</a>. Search for a location important to you (state, country, etc.). Filter based on Datum (Geodetic) on the right. Click on one geodetic datum options for your region of interest (make sure your location is listed under Area of Use). Repeat for three locations.</p>
<p>Provide the region of interest (e.g.&nbsp;United States), the full datum name (e.g.&nbsp;North American Datum 1983), the shorthand name (e.g.&nbsp;NAD83, EPSG: 6269), and the ellipsoid (e.g.&nbsp;GRS 1980).</p>
<blockquote class="blockquote">
<p>Location 1:</p>
</blockquote>
<blockquote class="blockquote">
<p>Location 2:</p>
</blockquote>
<blockquote class="blockquote">
<p>Location 3:</p>
</blockquote>
</section>
<section id="exercise-1" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1">Exercise</h3>
<p>Let’s now practice specifying coordinates in a CRS.</p>
<p>For <em>geographic coordinate reference systems</em>, the coordinates of locations are specified by latitude (degrees north or south of the equator), longitude (degrees west or east of a prime meridian), and sometimes height.</p>
<p>Find the location of Macalester College (OLRI) in longitude and latitude degrees.</p>
<blockquote class="blockquote">
<p>Longitude:</p>
</blockquote>
<blockquote class="blockquote">
<p>Latitude:</p>
</blockquote>
<p>For <em>projected coordinate reference systems</em>, the coordinates of locations are typically specified by easting (x) and northing (y). Go to https://epsg.io/, find the location, and transform the longitude and latitude using the following projected CRS: EPSG:26993.</p>
<p>Find the location of Macalester College (OLRI) in northing and easting coordinates (in meters) for the CRS EPSG:26993.</p>
<blockquote class="blockquote">
<p>Easting:</p>
</blockquote>
<blockquote class="blockquote">
<p>Northing:</p>
</blockquote>
</section>
</section>
<section id="projection" class="level2">
<h2 class="anchored" data-anchor-id="projection">Projection</h2>
<p>Lastly, the Earth lives in a 3 dimensional (3D) world and most visualizations are on a 2 dimensional (2D) surface. We must choose a projection method to represent points, regions, and lines on Earth on a 2D map with distance units (typically meter, international foot, US survey foot). In that projection process, a 3D element will lose angle, area, and/or distance when projected onto a 2D surface, no matter which method is chosen.</p>
<p>For a good overview of common projection methods, see <a href="https://pubs.usgs.gov/gip/70047422/report.pdf" class="uri">https://pubs.usgs.gov/gip/70047422/report.pdf</a>.</p>
<p>One of the most commonly used projection is the Mercator projection which is a cylindrical map projection from the 1500’s. It became popular for navigation because it represented north as up and south as down everywhere and preserves local directions and shape. However, it inflates the size of regions far from the equator. Thus, Greenland, Antarctica, Canada, and Russia appear large relative to their actual land mass as compared to Central Africa. See the illustration below to compare the area/shape of the countries with the Mercator projection of the world (light blue) with the true areas/shapes (dark blue).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mercator.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><a href="./r/dataisbeautiful/comments/9nkg7k/map_projections_can_be_deceptive_oc/">Source</a>: <span class="citation" data-cites="neilrkaye">@neilrkaye</span></figcaption>
</figure>
</div>
<p>Below you can see four different world projections. Take note of what is lost in terms of angle, area, or distance in these projections.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in value[[3L]](cond): Failed to install the rnaturalearthdata package.
 Please try installing the package for yourself using the following command: 
 install.packages("rnaturalearthdata")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic Map w/ labels</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Longitude"</span>, <span class="at">y =</span> <span class="st">"Latitude"</span>, <span class="at">title =</span> <span class="st">"World Map - Mercator Projection"</span>, <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"("</span>, <span class="fu">length</span>(<span class="fu">unique</span>(world<span class="sc">$</span>name)), <span class="st">" countries)"</span>)) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'world' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +units=m +no_defs"</span>)  <span class="sc">+</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Lambert Azimuthal Equal-Area Projection"</span>, <span class="at">subtitle =</span> <span class="st">"Correctly represents area but not angles"</span>) <span class="sc">+</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'world' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=fouc"</span>) <span class="sc">+</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Foucaut Projection"</span>, <span class="at">subtitle =</span> <span class="st">"Correctly represents area, lots of distortion in high latitudes"</span>) <span class="sc">+</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'world' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=natearth2"</span>) <span class="sc">+</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Natural Earth II Projection"</span>, <span class="at">subtitle =</span> <span class="st">"Represents globe shape, distorted at high latitudes"</span>) <span class="sc">+</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'world' not found</code></pre>
</div>
</div>
<section id="exercise-2" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2">Exercise</h3>
<p>Create a world map with a different projection (beyond the four above). Go to https://proj.org/en/9.2/operations/projections/index.html and find another projection. Look for the <code>proj-string</code> and copy that to the <code>crs =</code> argument in <code>coord_sf()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#bada55"</span>) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=natearth2"</span>) <span class="sc">+</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"?? Projection"</span>, <span class="at">subtitle =</span> <span class="st">"??"</span>) <span class="sc">+</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'world' not found</code></pre>
</div>
</div>
<p>What is interesting, surprising, or different to you about the map of the Earth based on this projection?</p>
<blockquote class="blockquote">
<p>ANSWER:</p>
</blockquote>
</section>
<section id="exercise-3" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3">Exercise</h3>
<p>Talk with a neighbor about the projection they tried. What projection did they use and how is it different from the one you chose?</p>
<blockquote class="blockquote">
<p>ANSWER:</p>
</blockquote>
</section>
</section>
</section>
<section id="spatial-data" class="level1">
<h1>Spatial Data</h1>
<p>With a CRS (including a projection method) to collect and record location data in terms of longitude or easting (x) and latitude or northing (y) coordinates, we can now consider common models for storing spatial data on the computer. There are two main data models: vector and raster.</p>
<section id="data-models" class="level2">
<h2 class="anchored" data-anchor-id="data-models">Data Models</h2>
<section id="vector" class="level3">
<h3 class="anchored" data-anchor-id="vector">Vector</h3>
<p>Vector data represents the world as a set of spatial geometries that are defined in terms of location coordinates (with a specified CRS) with non-spatial attributes or properties.</p>
<p>The three basic geometries are</p>
<ul>
<li>Points: Locations defined based on a (x, y) coordinates.</li>
<li>Lines: A set of ordered points connected by straight lines.</li>
<li>Polygons: A set of ordered points connected by straight lines, first and last point are the same.</li>
</ul>
<p>For example, city locations can be represented with points, roads and rivers can be represented by lines, and geo-political boundaries and lakes can be represented by polygons.</p>
<p>Hundreds of file formats exist to store spatial vector data. A text file (such as .csv) can store the coordinates in two columns (x,y) in addition to a group id (needed for lines and polygons) plus attributes or properties in additional columns. Note that text files do not store the CRS. However, shapefiles (.shp) developed by ESRI is one of the most widely supported spatial vector file format (that includes the CRS). Additionally, GeoJSON (.geojson) and KML (.kml) are additional popular formats.</p>
</section>
<section id="exercise-4" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4">Exercise</h3>
<p>To create maps, we’ll need to have access to some spatial data.</p>
<p>Go to the following websites and download the vector data files indicated. Put all of the downloaded files/folders in same folder as this Rmd file.</p>
<ul>
<li>URL: <a href="https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map" class="uri">https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map</a>
<ul>
<li>Download File Type: GeoJSON</li>
<li>Name of File: <code>us_states_hexgrid.geojson</code></li>
</ul></li>
<li>URL: <a href="https://www2.census.gov/programs-surveys/decennial/2020/data/apportionment/apportionment.csv" class="uri">https://www2.census.gov/programs-surveys/decennial/2020/data/apportionment/apportionment.csv</a>
<ul>
<li>Download File Type: csv</li>
<li>Name of File: <code>apportionment.csv</code></li>
</ul></li>
<li>URL: <a href="https://gisdata.mn.gov/dataset/loc-pop-centers" class="uri">https://gisdata.mn.gov/dataset/loc-pop-centers</a>
<ul>
<li>Download File Type: shapefile (.shp)</li>
<li>Name of File: <code>shp_loc_pop_centers.zip</code> (unzip this file to get a folder with the name <code>shp_loc_pop_centers</code>)</li>
</ul></li>
<li>URL: <a href="https://gisdata.mn.gov/dataset/us-mn-state-metc-water-lakes-rivers" class="uri">https://gisdata.mn.gov/dataset/us-mn-state-metc-water-lakes-rivers</a>
<ul>
<li>Download File Type: shapefile (.shp)</li>
<li>Name of File: <code>shp_water_lakes_rivers.zip</code> (unzip this file to get a folder with the name <code>shp_water_lakes_rivers</code>)</li>
</ul></li>
</ul>
</section>
<section id="raster" class="level3">
<h3 class="anchored" data-anchor-id="raster">Raster</h3>
<p>Raster data represents the world using a continuous grid of cells where each cell has a single value. These values could be continuous such as elevation or precipitation or categorical such as land cover or soil type.</p>
<p>Typically regular cells are square in shape but they can be rotated and sheared. Rectilinear and curvilinear shapes are also possible, depending on the spatial region of interest and CRS.</p>
<p><em>Be aware that high resolution raster data involves a large number of small cells. This can slow down the computations and visualizations.</em></p>
<p>Many raster file formats exist. One of the most popular is GeoTIFF (.tif or .tiff). More complex raster formats include NetCDF (.nc) and HDF (.hdf). To work with raster data in R, you’ll use the raster, terra, and the stars packages. If you are interested in learning more, check out https://r-spatial.github.io/stars/.</p>
</section>
</section>
<section id="working-with-spatial-data-in-r" class="level2">
<h2 class="anchored" data-anchor-id="working-with-spatial-data-in-r">Working with Spatial Data in R</h2>
<section id="read-in-data-to-r" class="level3">
<h3 class="anchored" data-anchor-id="read-in-data-to-r">Read in data to R</h3>
<p>For each file format, we need use a different function to read in the data. See the examples below for reading in GeoJSON, csv, and shapefiles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in GeoJSON file</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>hex_spatial <span class="ot">&lt;-</span> geojsonio<span class="sc">::</span><span class="fu">geojson_read</span>(<span class="st">"us_states_hexgrid.geojson"</span>, <span class="at">what =</span> <span class="st">'sp'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: File does not exist. Create it, or fix the path.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in CSV File</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>pop_growth <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">'apportionment.csv'</span>) <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: 'apportionment.csv' does not exist in current working directory ('/Users/lesliemyint/Library/CloudStorage/GoogleDrive-lmyint@macalester.edu/My Drive/teaching/STAT212/2023_fall/212_fall_2023').</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in Shapefiles</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>mn_cities <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">'shp_loc_pop_centers'</span>) <span class="co">#shp file/folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: Cannot open "shp_loc_pop_centers"; The file doesn't seem to exist.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mn_water <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">'shp_water_lakes_rivers'</span>) <span class="co">#shp file/folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: Cannot open "shp_water_lakes_rivers"; The file doesn't seem to exist.</code></pre>
</div>
</div>
</section>
<section id="data-classes-in-r" class="level3">
<h3 class="anchored" data-anchor-id="data-classes-in-r">Data classes in R</h3>
<p>When data is read it, an R data object is created of a default class. Notice the classes of the R objects we read in. Also, notice that an object may have multiple classes, which indicate the type of structure it has and how functions may interact with the object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(hex_spatial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_spatial' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pop_growth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'pop_growth' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mn_cities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'mn_cities' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mn_water)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'mn_water' not found</code></pre>
</div>
</div>
<p><strong>Older R Spatial classes</strong></p>
<p>In the <code>sp</code> package, there are many spatial classes that hold slightly different data. All <code>Spatial*</code> classes have a bounding box (bbox) and a CRS.</p>
<ul>
<li><code>SpatialPoints</code>, <code>SpatialLines</code>, and <code>SpatialPolygons</code> provide structure to hold the basic spatial geometries of points, lines, and polygons.</li>
<li><code>Spatial*DataFrame</code> extends the geometry classes to a data.frame-like object with non-spatial attribute data.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_spatial' not found</code></pre>
</div>
</div>
</section>
<section id="exercise-5" class="level3">
<h3 class="anchored" data-anchor-id="exercise-5">Exercise</h3>
<p>Based on the summary of <code>hex_spatial</code>, what are the following:</p>
<ul>
<li>CRS:</li>
<li>BBOX (extent):</li>
<li>Geometry type:</li>
</ul>
<p><strong>Newer R Spatial classes</strong></p>
<p>The community is moving away from using older <code>sp</code> classes to <code>sf</code> classes. It is useful for you to know that the older versions exist but stick with the <code>sf</code> classes.</p>
<ul>
<li><code>sfc</code> objects are modern, general versions of the spatial geometries from the <code>sp</code> package with a bbox, CRS, and many geometries available.</li>
<li><code>sf</code> objects are data.frame-like objects with a geometry column of class <code>sfc</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>mn_cities</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'mn_cities' not found</code></pre>
</div>
</div>
</section>
<section id="exercise-6" class="level3">
<h3 class="anchored" data-anchor-id="exercise-6">Exercise</h3>
<p>Based on the summary of <code>mn_cities</code>, what are the following:</p>
<ul>
<li>CRS:</li>
<li>BBOX:</li>
<li>Geometry type:</li>
</ul>
<p><strong>Data Frames - Fortified Spatial Data</strong></p>
<p>Data.frames or tbl (tibbles) are standard data formats that are not specific to spatial data. Our <code>pop_growth</code> data doesn’t include any coordinate information, so it can be stored simply as a <code>data.frame</code> (<code>tbl</code>, <code>tbl_df</code>, and <code>spec_tbl_df</code> are all sub classes of <code>data.frame</code>).</p>
<p>You may come across <code>data.frames</code> that contain coordinate information, so let’s see what that might look like. We can <code>fortify</code> our <code>sp</code> object to make it a data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Spatial*DataFrame to Data Frame</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_df <span class="ot">&lt;-</span> <span class="fu">fortify</span>(hex_spatial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_spatial' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(hex_spatial_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_spatial_df' not found</code></pre>
</div>
</div>
</section>
<section id="exercise-7" class="level3">
<h3 class="anchored" data-anchor-id="exercise-7">Exercise</h3>
<p>What are the variables in <code>hex_spatial_df</code>? Compare the first seven rows with the first spatial polygon of <code>hex_spatial</code>. Now describe the meaning of the variables in <code>hex_spatial_df</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hex_spatial_df,<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_spatial_df' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>hex_spatial<span class="sc">@</span>polygons[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_spatial' not found</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>ANSWER:</p>
</blockquote>
</section>
<section id="convert-data-class-types" class="level3">
<h3 class="anchored" data-anchor-id="convert-data-class-types">Convert data class types</h3>
<p>We can convert objects between these data classes with the following functions:</p>
<ul>
<li><p><code>fortify(x)</code>: <code>sp</code> object x to <code>data.frame</code></p></li>
<li><p><code>st_as_sf(x )</code>: <code>sp</code> object x to <code>sf</code></p></li>
<li><p><code>st_as_sf(x, coords = c("long", "lat"))</code>: <code>data.frame</code> x to <code>sf</code> as points</p></li>
<li><p>To convert a <code>data.frame</code> with columns of <code>long</code>, <code>lat</code>, and <code>group</code> containing polygon geometry information, you can use:</p></li>
</ul>
<pre><code>st_as_sf(x, coords = c("long", "lat")) %&gt;%
group_by(group) %&gt;%
  summarise(geometry = st_combine(geometry)) %&gt;%
  st_cast("POLYGON")</code></pre>
<p>We won’t often want to convert our data to a <code>Spatial*</code> class from <code>sp</code> package, so we’ll exclude that in this activity.</p>
</section>
<section id="exercise-8" class="level3">
<h3 class="anchored" data-anchor-id="exercise-8">Exercise</h3>
<p>Convert the <code>hex_spatial</code> data to an <code>sf</code> object called <code>hex_spatial_sf</code>. Complete these two ways</p>
<ol type="1">
<li><code>hex_spatial</code> directly to <code>hex_spatial_sf</code> AND</li>
<li><code>hex_spatial_df</code> to <code>hex_spatial_sf</code>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to SF from hex_spatial_df  </span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial_df <span class="sc">%&gt;%</span> ???  </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to SF from hex_spatial</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial <span class="sc">%&gt;%</span> ???</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: &lt;text&gt;:6:0: unexpected end of input
4: # Convert to SF from hex_spatial
5: hex_spatial_sf &lt;- hex_spatial %&gt;% ???
  ^</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="spatial-maps" class="level1">
<h1>Spatial Maps</h1>
<section id="hexbin-choropleth" class="level2">
<h2 class="anchored" data-anchor-id="hexbin-choropleth">Hexbin Choropleth</h2>
<p>Source: <a href="https://r-graph-gallery.com/328-hexbin-map-of-the-usa.html" class="uri">https://r-graph-gallery.com/328-hexbin-map-of-the-usa.html</a></p>
<p>In this example, we’ll create an alternative choropleth map. Instead of using the actual geo-political boundaries, we will use hexagons to represent the U.S. states and maintain their relative directional position to each together. This approach results in each state having the same area in the graphic so that large regions don’t dominate the visual story.</p>
<section id="exercise-9" class="level3">
<h3 class="anchored" data-anchor-id="exercise-9">Exercise</h3>
<p>Describe what the following code chunks are doing. Be sure to consider the class of the data object, what the data object looks like to start, and what it looks like at the end of the chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk A</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_df  <span class="ot">&lt;-</span> hex_spatial_df <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hex_spatial)) , </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="fu">str_replace</span>(hex_spatial<span class="sc">$</span>google_name,<span class="st">' </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)'</span>,<span class="st">''</span>), </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">abbr =</span> hex_spatial<span class="sc">$</span>iso3166_2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_spatial_df' not found</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk A):</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk B</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>hex_spatial_sf <span class="ot">&lt;-</span> hex_spatial_sf <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_replace</span>(google_name,<span class="st">' </span><span class="sc">\\</span><span class="st">(United States</span><span class="sc">\\</span><span class="st">)'</span>,<span class="st">''</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">abbr =</span> iso3166_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_spatial_sf' not found</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk B):</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk C</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>hex_growth_df <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hex_spatial_df, pop_growth, <span class="at">by =</span> <span class="st">'name'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_spatial_df' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>hex_growth_sf <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hex_spatial_sf, pop_growth, <span class="at">by =</span> <span class="st">'name'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_spatial_sf' not found</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk C):</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk D</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>centers <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rgeos<span class="sc">::</span><span class="fu">gCentroid</span>(hex_spatial,<span class="at">byid =</span> <span class="cn">TRUE</span>), </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">abbr =</span> hex_spatial<span class="sc">$</span>iso3166_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'row.names': object 'hex_spatial' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>hex_growth_df <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">group =</span> group, <span class="at">fill =</span> percent_change_in_resident_population)) <span class="sc">+</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> centers, <span class="fu">aes</span>( <span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> abbr), <span class="at">color =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span> </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_growth_df' not found</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk D):</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chunk E</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>hex_growth_sf <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> percent_change_in_resident_population)) <span class="sc">+</span> </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_text</span>( <span class="fu">aes</span>(<span class="at">label =</span> abbr), <span class="at">color =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'Population Change (%)'</span>) <span class="sc">+</span> </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'bottom'</span>, <span class="at">legend.justification =</span> <span class="st">'right'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'hex_growth_sf' not found</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>ANSWER (Chunk E):</p>
</blockquote>
</section>
<section id="exercise-10" class="level3">
<h3 class="anchored" data-anchor-id="exercise-10">Exercise</h3>
<p>Using the hexbin spatial boundaires and the pop_growth data, make the following updates to the choropleth graphic:</p>
<ul>
<li>Change the outcome variable (different year or variable).</li>
<li>Change the fill scale to be more meaningful and effective.</li>
<li>Make one more update beyond the fill color to improve the effectiveness of the graphic.</li>
</ul>
<p>Make the graphic twice, once with <code>geom_polygon()</code> and once with <code>geom_sf()</code>.</p>
</section>
<section id="bonus-challenge" class="level3">
<h3 class="anchored" data-anchor-id="bonus-challenge">Bonus Challenge</h3>
<p>Find external state-level data online, read it into R, join it, and create a U.S. state hexbin map displaying that new state-level outcome.</p>
</section>
</section>
<section id="mn-citycounty-example" class="level2">
<h2 class="anchored" data-anchor-id="mn-citycounty-example">MN City/County example</h2>
<section id="unify-crs" class="level3">
<h3 class="anchored" data-anchor-id="unify-crs">Unify CRS</h3>
<p>To demonstrate other spatial geometries beyond polygons (the hexagons in the last example were spatial polygons), we’ll walk through create a map of MN with different layers of information (city point locations, county polygon boundaries, rivers as lines and polygons, and a raster elevation map). To add all of this information on one map, we need to ensure that the CRS is the same for all spatial datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check CRS</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_cities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'mn_cities' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check CRS</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_water)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'mn_water' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#transform CRS of water to the same of the cities</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>mn_water <span class="ot">&lt;-</span> mn_water <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(mn_cities))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'mn_water' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load country boundaries data as sf object</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>mn_counties <span class="ot">&lt;-</span> <span class="fu">us_counties</span>(<span class="at">resolution =</span> <span class="st">"high"</span>, <span class="at">states =</span> <span class="st">"Minnesota"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">#remove duplicate column names</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>names_counties <span class="ot">&lt;-</span> <span class="fu">names</span>(mn_counties)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mn_counties)[names_counties <span class="sc">==</span> <span class="st">'state_name'</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"state_name1"</span>, <span class="st">"state_name2"</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co">#check CRS</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the CRS of county data to the more local CRS of the cities</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>mn_counties <span class="ot">&lt;-</span> mn_counties <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(mn_cities))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'mn_cities' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(mn_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
</section>
<section id="initial-map-counties-and-cities" class="level3">
<h3 class="anchored" data-anchor-id="initial-map-counties-and-cities">Initial Map: Counties and Cities</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="co">#plot frame</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="co">#county boundary layer</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="co">#city point layer</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'mn_cities' not found</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="st">'wheat'</span>, <span class="at">color =</span> <span class="st">"tan"</span>) <span class="sc">+</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Population <span class="sc">&gt;=</span> <span class="dv">10000</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Population,<span class="at">size =</span> Population), <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span> <span class="co">#cities layer</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span> <span class="co">#continuous (gradient) color scale</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Minnesota Cities with Population &gt;= 10,000"</span>) <span class="sc">+</span> </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co">#move legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'mn_cities' not found</code></pre>
</div>
</div>
</section>
<section id="updated-map-counties-and-cities-plus-elevation" class="level3">
<h3 class="anchored" data-anchor-id="updated-map-counties-and-cities-plus-elevation">Updated Map: Counties and Cities plus Elevation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>elevation <span class="ot">&lt;-</span> elevatr<span class="sc">::</span><span class="fu">get_elev_raster</span>(mn_counties, <span class="at">z =</span> <span class="dv">5</span>, <span class="at">clip =</span> <span class="st">'bbox'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in loadNamespace(x): there is no package called 'rgdal'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">crs</span>(elevation) <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(mn_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'elevation' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert to Data Frame for plotting</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>elev_df <span class="ot">&lt;-</span> elevation <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'as.data.frame': object 'elevation' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(elev_df) <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">'x'</span>,<span class="st">'y'</span>,<span class="st">'value'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'elev_df' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> elev_df, <span class="fu">aes</span>(<span class="at">x =</span> x,<span class="at">y =</span> y,<span class="at">fill =</span> value)) <span class="sc">+</span> <span class="co"># adding the elevation as first (bottom) layer</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Population <span class="sc">&gt;=</span> <span class="dv">10000</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Population,<span class="at">size =</span> Population), <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span> <span class="co">#cities layer</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span> <span class="co">#continuous (gradient) color scale</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">'darkgreen'</span>,<span class="at">high =</span> <span class="st">'white'</span>, <span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Minnesota Cities with Population &gt;= 10,000"</span>) <span class="sc">+</span> </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co">#move legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'elev_df' not found</code></pre>
</div>
</div>
</section>
<section id="zoom-to-twin-cities-map" class="level3">
<h3 class="anchored" data-anchor-id="zoom-to-twin-cities-map">Zoom to Twin Cities Map</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>Seven_countyarea <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(mn_counties <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Anoka"</span>, <span class="st">"Hennepin"</span>, <span class="st">"Ramsey"</span>, <span class="st">"Dakota"</span>, <span class="st">"Carver"</span>, <span class="st">"Washington"</span>, <span class="st">"Scott"</span>)))</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>elevation <span class="ot">&lt;-</span> elevatr<span class="sc">::</span><span class="fu">get_elev_raster</span>(mn_counties <span class="sc">%&gt;%</span> <span class="fu">st_crop</span>(Seven_countyarea), <span class="at">z =</span> <span class="dv">9</span>, <span class="at">clip =</span> <span class="st">'bbox'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'addAttrToGeom': conversion from feature type sfc_GEOMETRY to sp is not supported</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">crs</span>(elevation) <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(mn_counties)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'elevation' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert to Data Frame for plotting</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>elev_df <span class="ot">&lt;-</span> elevation <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'as.data.frame': object 'elevation' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(elev_df) <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">'x'</span>,<span class="st">'y'</span>,<span class="st">'value'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: object 'elev_df' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> elev_df, <span class="fu">aes</span>(<span class="at">x =</span> x,<span class="at">y =</span> y,<span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_counties, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="co"># county boundary layer</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_water, <span class="at">fill =</span> <span class="st">'lightsteelblue1'</span>,<span class="at">color =</span> <span class="st">'lightsteelblue1'</span>) <span class="sc">+</span> <span class="co"># added a river/lake layer</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mn_cities <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Population <span class="sc">&gt;=</span> <span class="dv">10000</span>), <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Population,<span class="at">size =</span> Population)) <span class="sc">+</span> <span class="co">#cities layer</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> Seven_countyarea[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)],<span class="at">ylim =</span> Seven_countyarea[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)]) <span class="sc">+</span> <span class="co"># crop map to coordinates of seven county area</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">'magma'</span>) <span class="sc">+</span> <span class="co">#continuous (gradient) color scale</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">'darkgreen'</span>,<span class="at">high =</span> <span class="st">'white'</span>) <span class="sc">+</span> <span class="co">#continuous (gradient) fill scale</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Twin Cities with Population &gt;= 10,000"</span>) <span class="sc">+</span> </span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  <span class="co">#remove legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'elev_df' not found</code></pre>
</div>
</div>
</section>
</section>
<section id="open-ended-exercise" class="level2">
<h2 class="anchored" data-anchor-id="open-ended-exercise">Open-ended Exercise</h2>
<p>The following exercises will use census tract <code>tidycensus</code> data for Ramsey and Hennepin county and <a href="https://information.stpaul.gov/datasets/stpaul::pedestrian-and-bike-crash-dataset-/about">pedestrian/bike crash data</a> (2019-2022) for St.&nbsp;Paul within Ramsey county in the Twin Cities. We provide several variables you can choose from in order to create maps that best fit your interest.</p>
<p>Load the data with the following code:</p>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error: 'Crash.csv' does not exist in current working directory ('/Users/lesliemyint/Library/CloudStorage/GoogleDrive-lmyint@macalester.edu/My Drive/teaching/STAT212/2023_fall/212_fall_2023').</code></pre>
</div>
</div>
<section id="exercise-joining-and-aggregation" class="level3">
<h3 class="anchored" data-anchor-id="exercise-joining-and-aggregation">Exercise: Joining and aggregation</h3>
<p><strong>Create a map of crashes per census tract in Ramsey county.</strong></p>
<p>First, transform the <code>crashes</code> data frame to a <code>sf</code> object have a point geometry using the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>crashes <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(crashes, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>), <span class="at">crs =</span> <span class="st">"NAD83"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'crashes' not found</code></pre>
</div>
</div>
<p>Check the CRS are the same for <code>census2020</code> and <code>crashes</code> using <code>st_crs()</code> and transform if needed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join the crashes and census dataset together and count the number of crashes per census tract. The function <code>st_join</code> can join to spatial data sets according to whether the spatial geometries of the right table intersect with the spatial geometries of the left table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>crashes_per_tract <span class="ot">&lt;-</span> <span class="fu">st_join</span>(??,??) <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> <span class="co">#removes geometry - makes the following calculation more efficient </span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Accident_Datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(??) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: &lt;text&gt;:1:32: unexpected ','
1: crashes_per_tract &lt;- st_join(??,
                                   ^</code></pre>
</div>
</div>
<p>Join the census data with <code>crashes_per_tract</code> and then use a filter of <code>n &gt; 0</code> to only keep the census tracts where crashes were recorded instead of all of Ramsey and Hennepin County.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>crashes_per_tract_geo <span class="ot">&lt;-</span> ??? <span class="sc">%&gt;%</span> <span class="co"># sf object with census geometry goes first</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(??, <span class="at">by =</span> ??) <span class="sc">%&gt;%</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: &lt;text&gt;:1:30: unexpected SPECIAL
1: crashes_per_tract_geo &lt;- ??? %&gt;%
                                 ^</code></pre>
</div>
</div>
<p>Create the plot!!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(???) <span class="sc">+</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">"lightcyan"</span>, <span class="st">"lightcyan2"</span>, <span class="st">"lightskyblue3"</span>, <span class="st">"lightskyblue4"</span>))<span class="sc">+</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Crashes"</span>, <span class="at">color =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Number of pedestrian/bike crashes per census tract"</span>) <span class="sc">+</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_map</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: &lt;text&gt;:2:14: unexpected ')'
1: ggplot() +
2:   geom_sf(???)
                ^</code></pre>
</div>
</div>
</section>
<section id="exercise-adding-layers" class="level3">
<h3 class="anchored" data-anchor-id="exercise-adding-layers">Exercise: Adding layers</h3>
<p><strong>Plot a variable of your choice for census tracts in Hennepin and Ramsey County and add roads to the map.</strong></p>
<p>Start by downloading a shape file. For example, you could search for “Minnesota roads shape file”. For this example, visit <a href="https://catalog.data.gov/dataset/tiger-line-shapefile-2019-state-minnesota-primary-and-secondary-roads-state-based-shapefile">this site</a> and download the Shapefile Zip File. Unzip the file and put the folder in the same location as this Rmd file.</p>
<p>Load in the shapefile using <code>st_read()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">"tl_2019_27_prisecroads"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: Cannot open "tl_2019_27_prisecroads"; The file doesn't seem to exist.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">&lt;-</span> roads <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(census2020))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'roads' not found</code></pre>
</div>
</div>
<p>Start by using <code>st_crop()</code> to crop the roads map to the area we are interested in (Hennepin and Ramsey County).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>roads_sub <span class="ot">&lt;-</span> <span class="fu">st_crop</span>(roads,<span class="fu">st_bbox</span>(census2020))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'roads' not found</code></pre>
</div>
</div>
<p>Create the map!!</p>
<div class="cell">
<pre class="relipsoi cell-code"><code>ggplot() +
  geom_sf(??)+ #put census tracts on map and fill by your variable of interest
  geom_sf(?? ,fill = "gray", color = "gray", lwd = 0.2)+ #roads data here
  labs(??)+ # add labels to fit your variables 
  scale_fill_gradientn(colours = c("lightcyan", "lightcyan2", "lightskyblue3", "lightskyblue4"))+ # change to preferred color palette
  theme_classic()+
  theme(axis.line = element_blank(), 
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        legend.position = "bottom", 
        plot.title.position = "plot", 
        plot.title = element_text(size = 8), 
        plot.subtitle = element_text(size = 8))</code></pre>
</div>
</section>
<section id="bonus-challenge-map-design-if-you-have-time" class="level3">
<h3 class="anchored" data-anchor-id="bonus-challenge-map-design-if-you-have-time">Bonus Challenge: Map design (if you have time)</h3>
<p><strong>Add some labels, a legend, a title, a scale bar, and credits to your map.</strong></p>
</section>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<ul>
<li>Spatial Data Science <a href="https://r-spatial.org/book/" class="uri">https://r-spatial.org/book/</a></li>
<li>Leaflet in R <a href="https://rstudio.github.io/leaflet/" class="uri">https://rstudio.github.io/leaflet/</a></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>